<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>MyBatisç¬”è®° | twintea's blogğŸ£</title><meta name="author" content="ğŸ¤twinteağŸ¥"><meta name="copyright" content="ğŸ¤twinteağŸ¥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MyBatisç¬”è®°1.ç®€ä»‹MyBatisæ˜¯ä»€ä¹ˆ MyBatis æ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ã€‚ MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚ MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„XMLæˆ–æ³¨è§£ç”¨äºé…ç½®å’ŒåŸå§‹æ˜ å°„ï¼Œå°†æ¥å£å’ŒJavaçš„POJOï¼ˆ Plain Old Java Objectsï¼Œæ™®é€šçš„Javaå¯¹è±¡ï¼‰æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•  MyBat"><meta property="og:type" content="article"><meta property="og:title" content="MyBatisç¬”è®°"><meta property="og:url" content="https://blog.twintea.top/posts/93fcac00.html"><meta property="og:site_name" content="twintea&#39;s blogğŸ£"><meta property="og:description" content="MyBatisç¬”è®°1.ç®€ä»‹MyBatisæ˜¯ä»€ä¹ˆ MyBatis æ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ã€‚ MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚ MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„XMLæˆ–æ³¨è§£ç”¨äºé…ç½®å’ŒåŸå§‹æ˜ å°„ï¼Œå°†æ¥å£å’ŒJavaçš„POJOï¼ˆ Plain Old Java Objectsï¼Œæ™®é€šçš„Javaå¯¹è±¡ï¼‰æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•  MyBat"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://static-bed.twintea.top/wallpaper/%E5%A3%81%E7%BA%B8%E7%94%B5%E8%84%917.jpg"><meta property="article:published_time" content="2022-01-28T08:56:00.000Z"><meta property="article:modified_time" content="2023-03-12T22:00:00.000Z"><meta property="article:author" content="ğŸ¤twinteağŸ¥"><meta property="article:tag" content="Mybatis"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://static-bed.twintea.top/wallpaper/%E5%A3%81%E7%BA%B8%E7%94%B5%E8%84%917.jpg"><link rel="shortcut icon" href="https://www.emojiall.com/en/header-svg/%F0%9F%90%A3.svg"><link rel="canonical" href="https://blog.twintea.top/posts/93fcac00.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},noticeOutdate:{limitDay:500,position:"top",messagePrev:"It has been",messageNext:"days since the last update, the content of the article may be outdated."},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:{limitCount:50,languages:{author:"ä½œè€…: ğŸ¤twinteağŸ¥",link:"é“¾æ¥: ",source:"æ¥æº: twintea's blogğŸ£",info:"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“",cht_to_chs:"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“",day_to_night:"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"top-right"},source:{justifiedGallery:{js:"https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js",css:"https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,percent:{toc:!0,rightside:!1}}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"MyBatisç¬”è®°",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-12 22:00:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.getCSS=(e,t=!1)=>new Promise(((o,n)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=e,t&&(a.id=t),a.onerror=n,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,o())},document.head.appendChild(a)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=(new Date).getHours();void 0===t?o<=6||o>=18?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode();const n=saveToLocal.get("aside-status");void 0!==n&&("hide"===n?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"></head><body><link rel="stylesheet" href="/css/progress_bar.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/avatar.jfif" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://static-bed.twintea.top/wallpaper/å£çº¸ç”µè„‘7.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="twintea's blogğŸ£"><span class="site-name">twintea's blogğŸ£</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MyBatisç¬”è®°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-01-28T08:56:00.000Z" title="å‘è¡¨äº 2022-01-28 08:56:00">2022-01-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-03-12T22:00:00.000Z" title="æ›´æ–°äº 2023-03-12 22:00:00">2023-03-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Mybatis/">Mybatis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">24.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>112åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="MyBatisç¬”è®°"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MyBatisç¬”è®°"><a href="#MyBatisç¬”è®°" class="headerlink" title="MyBatisç¬”è®°"></a>MyBatisç¬”è®°</h1><h2 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1.ç®€ä»‹"></a>1.ç®€ä»‹</h2><h3 id="MyBatisæ˜¯ä»€ä¹ˆ"><a href="#MyBatisæ˜¯ä»€ä¹ˆ" class="headerlink" title="MyBatisæ˜¯ä»€ä¹ˆ"></a>MyBatisæ˜¯ä»€ä¹ˆ</h3><ul><li>MyBatis æ˜¯æ”¯æŒå®šåˆ¶åŒ– SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„çš„ä¼˜ç§€çš„<strong>æŒä¹…å±‚æ¡†æ¶</strong>ã€‚</li><li>MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚</li><li>MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„XMLæˆ–æ³¨è§£ç”¨äºé…ç½®å’ŒåŸå§‹æ˜ å°„ï¼Œå°†æ¥å£å’ŒJavaçš„POJOï¼ˆ Plain Old Java Objectsï¼Œæ™®é€šçš„Javaå¯¹è±¡ï¼‰æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•</li></ul><h3 id="MyBatiså†å²"><a href="#MyBatiså†å²" class="headerlink" title="MyBatiså†å²"></a>MyBatiså†å²</h3><ul><li>åŸæ˜¯Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®iBatis, 2010å¹´6æœˆè¿™ä¸ªé¡¹ç›®ç”±Apache Software Foundation è¿ç§»åˆ°äº†Google Codeï¼Œéšç€å¼€å‘å›¢é˜Ÿè½¬æŠ•Google Codeæ——ä¸‹ï¼Œ iBatis3.xæ­£å¼æ›´åä¸ºMyBatis ï¼Œä»£ç äº2013å¹´11æœˆè¿ç§»åˆ°Githubï¼ˆä¸‹è½½åœ°å€è§åï¼‰ã€‚</li><li>iBatisä¸€è¯æ¥æºäºâ€œinternetâ€å’Œâ€œabatisâ€çš„ç»„åˆï¼Œæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æŒä¹…å±‚æ¡†æ¶ã€‚ iBatisæä¾›çš„æŒä¹…å±‚æ¡†æ¶åŒ…æ‹¬SQL Mapså’ŒData Access Objectsï¼ˆDAOï¼‰</li></ul><h3 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MyBatisï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MyBatisï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MyBatisï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MyBatisï¼Ÿ</h3><ul><li>JDBC<ul><li>SQLå¤¹åœ¨Javaä»£ç å—é‡Œï¼Œè€¦åˆåº¦é«˜å¯¼è‡´ç¡¬ç¼–ç å†…ä¼¤</li><li>ç»´æŠ¤ä¸æ˜“ä¸”å®é™…å¼€å‘éœ€æ±‚ä¸­sqlæ˜¯æœ‰å˜åŒ–ï¼Œé¢‘ç¹ä¿®æ”¹çš„æƒ…å†µå¤šè§</li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/01.png"></p><ul><li>Hibernateå’ŒJPA<br>â€“ é•¿éš¾å¤æ‚SQLï¼Œå¯¹äºHibernateè€Œè¨€å¤„ç†ä¹Ÿä¸å®¹æ˜“<br>â€“ å†…éƒ¨è‡ªåŠ¨ç”Ÿäº§çš„SQLï¼Œä¸å®¹æ˜“åšç‰¹æ®Šä¼˜åŒ–ã€‚<br>â€“ åŸºäºå…¨æ˜ å°„çš„å…¨è‡ªåŠ¨æ¡†æ¶ï¼Œå¤§é‡å­—æ®µçš„POJOè¿›è¡Œéƒ¨åˆ†æ˜ å°„æ—¶æ¯”è¾ƒå›°éš¾ï¼Œå¯¼è‡´æ•°æ®åº“æ€§èƒ½ä¸‹é™ã€‚</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/02.png"></p><ul><li>MyBatisæ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨åŒ–çš„æŒä¹…åŒ–å±‚æ¡†æ¶ã€‚<ul><li>å¯¹å¼€å‘äººå‘˜è€Œè¨€ï¼Œæ ¸å¿ƒsqlè¿˜æ˜¯éœ€è¦è‡ªå·±ä¼˜åŒ–</li><li>sqlå’Œjavaç¼–ç åˆ†å¼€ï¼ŒåŠŸèƒ½è¾¹ç•Œæ¸…æ™°ï¼Œä¸€ä¸ªä¸“æ³¨ä¸šåŠ¡ã€ä¸€ä¸ªä¸“æ³¨æ•°æ®ã€‚</li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/03.png"></p><h2 id="2-ä¸‹è½½"><a href="#2-ä¸‹è½½" class="headerlink" title="2.ä¸‹è½½"></a>2.ä¸‹è½½</h2><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">MyBatisä¸‹è½½</a></p><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/index.html">MyBatiså®˜ç½‘</a></p><h2 id="3-HelloWorld"><a href="#3-HelloWorld" class="headerlink" title="3.HelloWorld"></a>3.HelloWorld</h2><ul><li>åœ¨MySQLæ•°æ®åº“åˆ›å»ºä¸€æ•°æ®åº“å®ä¾‹<code>learnmybatis</code>ï¼Œåœ¨å…¶åˆ›å»ºä¸€å¼ è¡¨</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee(</span><br><span class="line">	id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	last_name <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">	gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	email <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>å†æ’è¿›ä¸€æ¡éšæ„æ•°æ®ï¼Œç”¨äºæµ‹è¯•</p><ul><li>åˆ›å»ºMavenå·¥ç¨‹ï¼Œæ·»åŠ ä¾èµ–</li></ul><p><a href="pom.xml">pom.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºå¯¹åº”çš„JavaBean</li></ul><p><a href="src/main/java/com/lun/c01/helloworld/bean/Employee.java">Employee.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//getter and setter and toString()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºmybatisé…ç½®æ–‡ä»¶ï¼Œsqlæ˜ å°„æ–‡ä»¶<ul><li>MyBatis çš„å…¨å±€é…ç½®æ–‡ä»¶åŒ…å«äº†å½±å“ MyBatis è¡Œä¸ºç”šæ·±çš„è®¾ç½®ï¼ˆ settingsï¼‰å’Œå±æ€§ï¼ˆ propertiesï¼‰ä¿¡æ¯ã€å¦‚æ•°æ®åº“è¿æ¥æ± ä¿¡æ¯ç­‰ã€‚æŒ‡å¯¼ç€MyBatisè¿›è¡Œå·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥å‚ç…§å®˜æ–¹æ–‡ä»¶çš„é…ç½®ç¤ºä¾‹ã€‚</li><li>æ˜ å°„æ–‡ä»¶çš„ä½œç”¨å°±ç›¸å½“äºæ˜¯å®šä¹‰Daoæ¥å£çš„å®ç°ç±»å¦‚ä½•å·¥ä½œã€‚è¿™ä¹Ÿæ˜¯<strong>æˆ‘ä»¬ä½¿ç”¨MyBatisæ—¶ç¼–å†™çš„æœ€å¤šçš„æ–‡ä»¶</strong>ã€‚</li></ul></li></ul><p>mybatiså…¨å±€é…ç½®æ–‡ä»¶</p><p><a href="src/main/resources/c01/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta"> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/learnmybatis?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>serverTimezone=CTT&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- å°†æˆ‘ä»¬å†™å¥½çš„sqlæ˜ å°„æ–‡ä»¶ï¼ˆEmployeeMapper.xmlï¼‰ä¸€å®šè¦æ³¨å†Œåˆ°å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆmybatis-config.xmlï¼‰ä¸­ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;c01/EmployeeMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>sqlæ˜ å°„æ–‡ä»¶</strong></p><p><a href="src/main/resources/c01/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;abc&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">namespace:åç§°ç©ºé—´;é€šå¸¸æŒ‡å®šä¸ºæ¥å£çš„å…¨ç±»å</span></span><br><span class="line"><span class="comment">idï¼šå”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">resultTypeï¼šè¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">#&#123;id&#125;ï¼šä»ä¼ é€’è¿‡æ¥çš„å‚æ•°ä¸­å–å‡ºidå€¼</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">public Employee getEmpById(Integer id);</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><p><a href="src/test/java/com/lun/c01/helloworld/HelloWorldTest.java">HelloWorldTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> SqlSessionFactory <span class="title function_">getSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;c01/mybatis-config.xml&quot;</span>;</span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 1ã€æ ¹æ®xmlé…ç½®æ–‡ä»¶ï¼ˆå…¨å±€é…ç½®æ–‡ä»¶ï¼‰åˆ›å»ºä¸€ä¸ªSqlSessionFactoryå¯¹è±¡ æœ‰æ•°æ®æºä¸€äº›è¿è¡Œç¯å¢ƒä¿¡æ¯</span></span><br><span class="line"><span class="comment">	 * 2ã€sqlæ˜ å°„æ–‡ä»¶ï¼›é…ç½®äº†æ¯ä¸€ä¸ªsqlï¼Œä»¥åŠsqlçš„å°è£…è§„åˆ™ç­‰ã€‚ </span></span><br><span class="line"><span class="comment">	 * 3ã€å°†sqlæ˜ å°„æ–‡ä»¶æ³¨å†Œåœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">	 * 4ã€å†™ä»£ç ï¼š</span></span><br><span class="line"><span class="comment">	 * 		1ï¼‰ã€æ ¹æ®å…¨å±€é…ç½®æ–‡ä»¶å¾—åˆ°SqlSessionFactoryï¼›</span></span><br><span class="line"><span class="comment">	 * 		2ï¼‰ã€ä½¿ç”¨sqlSessionå·¥å‚ï¼Œè·å–åˆ°sqlSessionå¯¹è±¡ä½¿ç”¨ä»–æ¥æ‰§è¡Œå¢åˆ æ”¹æŸ¥</span></span><br><span class="line"><span class="comment">	 * 			ä¸€ä¸ªsqlSessionå°±æ˜¯ä»£è¡¨å’Œæ•°æ®åº“çš„ä¸€æ¬¡ä¼šè¯ï¼Œç”¨å®Œå…³é—­</span></span><br><span class="line"><span class="comment">	 * 		3ï¼‰ã€ä½¿ç”¨sqlçš„å”¯ä¸€æ ‡å¿—æ¥å‘Šè¯‰MyBatisæ‰§è¡Œå“ªä¸ªsqlã€‚sqléƒ½æ˜¯ä¿å­˜åœ¨sqlæ˜ å°„æ–‡ä»¶ä¸­çš„ã€‚</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2ã€è·å–sqlSessionå®ä¾‹ï¼Œèƒ½ç›´æ¥æ‰§è¡Œå·²ç»æ˜ å°„çš„sqlè¯­å¥</span></span><br><span class="line">		<span class="comment">// sqlçš„å”¯ä¸€æ ‡è¯†ï¼šstatement Unique identifier matching the statement to use.</span></span><br><span class="line">		<span class="comment">// æ‰§è¡Œsqlè¦ç”¨çš„å‚æ•°ï¼šparameter A parameter object to pass to the statement.</span></span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> openSession.selectOne(</span><br><span class="line">					<span class="string">&quot;abc.getEmpById&quot;</span>, <span class="number">1</span>);</span><br><span class="line">			System.out.println(employee);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-æ¥å£å¼ç¼–ç¨‹"><a href="#4-æ¥å£å¼ç¼–ç¨‹" class="headerlink" title="4.æ¥å£å¼ç¼–ç¨‹"></a>4.æ¥å£å¼ç¼–ç¨‹</h2><p><strong>æ—¥åä¸»è¦ç”¨æ¥å£å¼ç¼–ç¨‹</strong></p><p>HelloWorld-æ¥å£å¼ç¼–ç¨‹</p><ul><li>åˆ›å»ºä¸€ä¸ªDaoæ¥å£</li></ul><p><a href="src/main/java/com/lun/c01/helloworld/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.lun.c01.helloworld.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹Mapperæ–‡ä»¶ï¼ˆå‘½åç©ºé—´ï¼Œidï¼ŒreturnTypeï¼‰</li></ul><p><a href="src/main/java/com/lun/c01/helloworld/dao/EmployeeMapper.java">EmployeeMapper2.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c01.helloworld.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">namespace:åç§°ç©ºé—´;æŒ‡å®šä¸ºæ¥å£çš„å…¨ç±»å</span></span><br><span class="line"><span class="comment">idï¼šå”¯ä¸€æ ‡è¯†</span></span><br><span class="line"><span class="comment">resultTypeï¼šè¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">#&#123;id&#125;ï¼šä»ä¼ é€’è¿‡æ¥çš„å‚æ•°ä¸­å–å‡ºidå€¼</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">public Employee getEmpById(Integer id);</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><p><a href="src/test/java/com/lun/c01/helloworld/HelloWorldTest.java">HelloWorldTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="comment">// 1ã€è·å–sqlSessionFactoryå¯¹è±¡</span></span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line">	<span class="comment">// 2ã€è·å–sqlSessionå¯¹è±¡</span></span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 3ã€è·å–æ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">		<span class="comment">//ä¼šä¸ºæ¥å£è‡ªåŠ¨çš„åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å»æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ–¹æ³•</span></span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">		<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">		System.out.println(mapper.getClass());</span><br><span class="line">		System.out.println(employee);</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-å°ç»“-1"><a href="#5-å°ç»“-1" class="headerlink" title="5.å°ç»“(1)"></a>5.å°ç»“(1)</h2><ol><li>æ¥å£å¼ç¼–ç¨‹<ul><li>åŸç”Ÿï¼š Dao &#x3D;&#x3D;&#x3D;&#x3D;&gt; DaoImpl</li><li>mybatisï¼š Mapper &#x3D;&#x3D;&#x3D;&#x3D;&gt; xxMapper.xml</li></ul></li><li>SqlSessionä»£è¡¨å’Œæ•°æ®åº“çš„ä¸€æ¬¡ä¼šè¯ï¼›ç”¨å®Œå¿…é¡»å…³é—­ï¼›</li><li>SqlSessionå’Œconnectionä¸€æ ·å¥¹éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨ã€‚æ¯æ¬¡ä½¿ç”¨éƒ½åº”è¯¥å»è·å–æ–°çš„å¯¹è±¡ã€‚</li><li>mapperæ¥å£æ²¡æœ‰å®ç°ç±»ï¼Œä½†æ˜¯mybatisä¼šä¸ºè¿™ä¸ªæ¥å£ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚<br>ï¼ˆå°†æ¥å£å’Œxmlè¿›è¡Œç»‘å®šï¼‰<code>EmployeeMapper empMapper = sqlSession.getMapper(EmployeeMapper.class);</code></li><li>ä¸¤ä¸ªé‡è¦çš„é…ç½®æ–‡ä»¶ï¼š<ul><li>mybatisçš„å…¨å±€é…ç½®æ–‡ä»¶ï¼šåŒ…å«æ•°æ®åº“è¿æ¥æ± ä¿¡æ¯ï¼Œäº‹åŠ¡ç®¡ç†å™¨ä¿¡æ¯ç­‰â€¦ç³»ç»Ÿè¿è¡Œç¯å¢ƒä¿¡æ¯</li><li>sqlæ˜ å°„æ–‡ä»¶ï¼šä¿å­˜äº†æ¯ä¸€ä¸ªsqlè¯­å¥çš„æ˜ å°„ä¿¡æ¯ï¼šå°†sqlæŠ½å–å‡ºæ¥ã€‚</li></ul></li></ol><h2 id="6-å…¨å±€é…ç½®æ–‡ä»¶-å¼•å…¥dtdçº¦æŸ"><a href="#6-å…¨å±€é…ç½®æ–‡ä»¶-å¼•å…¥dtdçº¦æŸ" class="headerlink" title="6.å…¨å±€é…ç½®æ–‡ä»¶-å¼•å…¥dtdçº¦æŸ"></a>6.å…¨å±€é…ç½®æ–‡ä»¶-å¼•å…¥dtdçº¦æŸ</h2><h3 id="MyBatis-å…¨å±€é…ç½®æ–‡ä»¶"><a href="#MyBatis-å…¨å±€é…ç½®æ–‡ä»¶" class="headerlink" title="MyBatis-å…¨å±€é…ç½®æ–‡ä»¶"></a>MyBatis-å…¨å±€é…ç½®æ–‡ä»¶</h3><p>MyBatis çš„é…ç½®æ–‡ä»¶åŒ…å«äº†å½±å“ MyBatis è¡Œä¸ºç”šæ·±çš„è®¾ç½®ï¼ˆ settingsï¼‰å’Œå±æ€§ï¼ˆ propertiesï¼‰ä¿¡æ¯ã€‚æ–‡æ¡£çš„é¡¶å±‚ç»“æ„å¦‚ä¸‹ï¼š</p><ul><li>configuration é…ç½®<ul><li>properties å±æ€§</li><li>settings è®¾ç½®</li><li>typeAliases ç±»å‹å‘½å</li><li>typeHandlers ç±»å‹å¤„ç†å™¨</li><li>objectFactory å¯¹è±¡å·¥å‚</li><li>plugins æ’ä»¶</li><li>environments ç¯å¢ƒ<ul><li>environment ç¯å¢ƒå˜é‡<ul><li>transactionManager äº‹åŠ¡ç®¡ç†å™¨</li><li>dataSource æ•°æ®æº</li></ul></li></ul></li><li>databaseIdProvider æ•°æ®åº“å‚å•†æ ‡è¯†</li><li>mappers æ˜ å°„å™¨</li></ul></li></ul><h3 id="å¼•å…¥dtdçº¦æŸ"><a href="#å¼•å…¥dtdçº¦æŸ" class="headerlink" title="å¼•å…¥dtdçº¦æŸ"></a>å¼•å…¥dtdçº¦æŸ</h3><p>æœ‰æ—¶Eclipseåœ¨ç¼–è¾‘å…¨å±€xmlæˆ–æ˜ å°„xmlæ—¶æ²¡æœ‰ç¼–è¾‘æç¤ºï¼Œè¿™æ—¶å¯æ‰‹åŠ¨å¯¼å…¥dtdï¼Œå¯¼å…¥åæ‰æœ‰ç¼–è¾‘æç¤º</p><p>dtdæ–‡ä»¶åœ¨Mybatisçš„JaråŒ…çš„org&#x2F;apache&#x2F;ibatis&#x2F;builder&#x2F;xmlï¼Œå¯¼å…¥å‰éœ€Mybatisçš„JaråŒ…ä¸­çš„dtdå­˜æ”¾åˆ°æœ¬åœ°ç›®å½•</p><p>è®¾ç½®è·¯å¾„ï¼šWindow -&gt; Preferences -&gt; XML -&gt; XML Catalog -&gt; Add Catalog Entry -&gt;Set URL key and DTD local location</p><h2 id="7-å…¨å±€é…ç½®æ–‡ä»¶-properties-å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶"><a href="#7-å…¨å±€é…ç½®æ–‡ä»¶-properties-å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶" class="headerlink" title="7.å…¨å±€é…ç½®æ–‡ä»¶-properties-å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶"></a>7.å…¨å±€é…ç½®æ–‡ä»¶-properties-å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html">å®˜æ–¹æ–‡æ¡£</a></p><p><a href="src/main/resources/c02/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		1ã€mybatiså¯ä»¥ä½¿ç”¨propertiesæ¥å¼•å…¥å¤–éƒ¨propertiesé…ç½®æ–‡ä»¶çš„å†…å®¹ï¼›</span></span><br><span class="line"><span class="comment">		resourceï¼šå¼•å…¥ç±»è·¯å¾„ä¸‹çš„èµ„æº</span></span><br><span class="line"><span class="comment">		urlï¼šå¼•å…¥ç½‘ç»œè·¯å¾„æˆ–è€…ç£ç›˜è·¯å¾„ä¸‹çš„èµ„æº</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span> =<span class="string">&quot;dbconfig.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="/LearnMybatis/src/main/resources/c02/dbconfig.properties">dbconfig.properties</a></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/learnmybatis?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=CTT</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><p>å¦‚æœå±æ€§åœ¨ä¸åªä¸€ä¸ªåœ°æ–¹è¿›è¡Œäº†é…ç½®ï¼Œé‚£ä¹ˆ MyBatis å°†æŒ‰ç…§ä¸‹é¢çš„é¡ºåºæ¥åŠ è½½ï¼š</p><ul><li>åœ¨ properties å…ƒç´ ä½“å†…æŒ‡å®šçš„å±æ€§é¦–å…ˆè¢«è¯»å–ã€‚</li><li>ç„¶åæ ¹æ® properties å…ƒç´ ä¸­çš„ resource å±æ€§è¯»å–ç±»è·¯å¾„ä¸‹å±æ€§æ–‡ä»¶æˆ–æ ¹<br>æ® url å±æ€§æŒ‡å®šçš„è·¯å¾„è¯»å–å±æ€§æ–‡ä»¶ï¼Œå¹¶è¦†ç›–å·²è¯»å–çš„åŒåå±æ€§ã€‚</li><li>æœ€åè¯»å–ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’çš„å±æ€§ï¼Œå¹¶è¦†ç›–å·²è¯»å–çš„åŒåå±æ€§ã€‚</li></ul><h2 id="8-å…¨å±€é…ç½®æ–‡ä»¶-settings-è¿è¡Œæ—¶è¡Œä¸ºè®¾ç½®"><a href="#8-å…¨å±€é…ç½®æ–‡ä»¶-settings-è¿è¡Œæ—¶è¡Œä¸ºè®¾ç½®" class="headerlink" title="8.å…¨å±€é…ç½®æ–‡ä»¶-settings-è¿è¡Œæ—¶è¡Œä¸ºè®¾ç½®"></a>8.å…¨å±€é…ç½®æ–‡ä»¶-settings-è¿è¡Œæ—¶è¡Œä¸ºè®¾ç½®</h2><p>è¿™æ˜¯ MyBatis ä¸­æä¸ºé‡è¦çš„è°ƒæ•´è®¾ç½®ï¼Œå®ƒä»¬ä¼šæ”¹å˜MyBatis çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚</p><p><a href="src/main/resources/c02/mybatis-config2.xml">mybatis-config2.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		2ã€settingsåŒ…å«å¾ˆå¤šé‡è¦çš„è®¾ç½®é¡¹</span></span><br><span class="line"><span class="comment">		setting:ç”¨æ¥è®¾ç½®æ¯ä¸€ä¸ªè®¾ç½®é¡¹</span></span><br><span class="line"><span class="comment">			nameï¼šè®¾ç½®é¡¹å</span></span><br><span class="line"><span class="comment">			valueï¼šè®¾ç½®é¡¹å–å€¼</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>è®¾ç½®å‚æ•°</th><th>æè¿°</th><th>æœ‰æ•ˆå€¼</th><th>é»˜è®¤å€¼</th></tr></thead><tbody><tr><td>cacheEnabled</td><td>è¯¥é…ç½®å½±å“çš„æ‰€æœ‰æ˜ å°„å™¨ä¸­é…ç½®çš„ç¼“å­˜çš„å…¨å±€å¼€å…³ã€‚</td><td>true&#x2F;false</td><td>TRUE</td></tr><tr><td>lazyLoadingEnabled</td><td>å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ã€‚æ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ã€‚ç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½®fetchTypeå±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚</td><td>true&#x2F;false</td><td>FALSE</td></tr><tr><td>useColumnLabel</td><td>ä½¿ç”¨åˆ—æ ‡ç­¾ä»£æ›¿åˆ—åã€‚ä¸åŒçš„é©±åŠ¨åœ¨è¿™æ–¹é¢ä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼Œå…·ä½“å¯å‚è€ƒç›¸å…³é©±åŠ¨æ–‡æ¡£æˆ–é€šè¿‡æµ‹è¯•è¿™ä¸¤ç§ä¸åŒçš„æ¨¡å¼æ¥è§‚å¯Ÿæ‰€ç”¨é©±åŠ¨çš„ç»“æœã€‚</td><td>true&#x2F;false</td><td>TRUE</td></tr><tr><td>defaultStatementTimeout</td><td>è®¾ç½®è¶…æ—¶æ—¶é—´,å®ƒå†³å®šé©±åŠ¨ç­‰å¾…æ•°æ®åº“å“åº”çš„ç§’æ•°ã€‚</td><td>Any positive integer</td><td>Not Set (null)</td></tr><tr><td>mapUnderscoreToCamelCase</td><td>æ˜¯å¦å¼€å¯è‡ªåŠ¨é©¼å³°å‘½åè§„åˆ™( camel case )æ˜ å°„å³ä»ç»å…¸æ•°æ®åº“åˆ—åA_ COLUMNåˆ°ç»å…¸Javaå±æ€§åaColumnçš„ç±»ä¼¼æ˜ å°„</td><td>true&#x2F;false</td><td>FALSE</td></tr></tbody></table><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#settings">æ›´å¤šè®¾ç½®</a></p><h2 id="9-å…¨å±€é…ç½®æ–‡ä»¶-typeAliases-åˆ«å"><a href="#9-å…¨å±€é…ç½®æ–‡ä»¶-typeAliases-åˆ«å" class="headerlink" title="9.å…¨å±€é…ç½®æ–‡ä»¶-typeAliases-åˆ«å"></a>9.å…¨å±€é…ç½®æ–‡ä»¶-typeAliases-åˆ«å</h2><p>ç±»å‹åˆ«åå¯ä¸º Java ç±»å‹è®¾ç½®ä¸€ä¸ªç¼©å†™åå­—ã€‚ å®ƒä»…ç”¨äº XML é…ç½®ï¼Œæ„åœ¨é™ä½å†—ä½™çš„å…¨é™å®šç±»åä¹¦å†™ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Blog&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Comment&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Comment&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Post&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Post&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Section&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Section&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Tag&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Tag&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å½“è¿™æ ·é…ç½®æ—¶ï¼ŒBlog å¯ä»¥ç”¨åœ¨ä»»ä½•ä½¿ç”¨ domain.blog.Blog çš„åœ°æ–¹ã€‚</p><p>ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåŒ…åï¼ŒMyBatis ä¼šåœ¨åŒ…åä¸‹é¢æœç´¢éœ€è¦çš„ Java Beanï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªåœ¨åŒ… domain.blog ä¸­çš„ Java Beanï¼Œåœ¨æ²¡æœ‰æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Bean çš„é¦–å­—æ¯å°å†™çš„éé™å®šç±»åæ¥ä½œä¸ºå®ƒçš„åˆ«åã€‚ æ¯”å¦‚ domain.blog.Author çš„åˆ«åä¸º authorï¼›è‹¥æœ‰æ³¨è§£ï¼Œåˆ™åˆ«åä¸ºå…¶æ³¨è§£å€¼ã€‚è§ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ MyBatiså·²ç»ä¸ºè®¸å¤šå¸¸è§çš„ Java ç±»å‹å†…å»º<br>äº†ç›¸åº”çš„ç±»å‹åˆ«åã€‚<strong>å®ƒä»¬éƒ½æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„</strong>ï¼Œæˆ‘ä»¬åœ¨èµ·<br>åˆ«åçš„æ—¶å€™åƒä¸‡ä¸è¦å ç”¨å·²æœ‰çš„åˆ«åã€‚</p><table><thead><tr><th>åˆ«å</th><th>æ˜ å°„çš„ç±»å‹</th><th>åˆ«å</th><th>æ˜ å°„çš„ç±»å‹</th><th>åˆ«å</th><th>æ˜ å°„çš„ç±»å‹</th><th></th></tr></thead><tbody><tr><td>_byte</td><td>byte</td><td>string</td><td>String</td><td>date</td><td>Date</td><td></td></tr><tr><td>_long</td><td>long</td><td>byte</td><td>Byte</td><td>decimal</td><td>BigDecimal</td><td></td></tr><tr><td>_short</td><td>short</td><td>long</td><td>Long</td><td>bigdecimal</td><td>BigDecimal</td><td></td></tr><tr><td>_int</td><td>int</td><td>short</td><td>Short</td><td>object</td><td>Object</td><td></td></tr><tr><td>_integer</td><td>int</td><td>int</td><td>Integer</td><td>map</td><td>Map</td><td></td></tr><tr><td>_double</td><td>double</td><td>integer</td><td>Integer</td><td>hashmap</td><td>HashMap</td><td></td></tr><tr><td>_float</td><td>float</td><td>double</td><td>Double</td><td>list</td><td>List</td><td></td></tr><tr><td>_boolean</td><td>boolean</td><td>float</td><td>Float</td><td>arraylist</td><td>ArrayList</td><td></td></tr><tr><td>-</td><td>-</td><td>boolean</td><td>Boolean</td><td>collection</td><td>Collection</td><td></td></tr><tr><td>-</td><td>-</td><td>-</td><td>-</td><td>iterator</td><td>Iterator</td><td></td></tr></tbody></table><p><a href="src/main/resources/c02/mybatis-config3.xml">mybatis-config3.xml</a></p><h2 id="10-å…¨å±€é…ç½®æ–‡ä»¶-typeHandlers-ç±»å‹å¤„ç†å™¨ç®€ä»‹"><a href="#10-å…¨å±€é…ç½®æ–‡ä»¶-typeHandlers-ç±»å‹å¤„ç†å™¨ç®€ä»‹" class="headerlink" title="10.å…¨å±€é…ç½®æ–‡ä»¶-typeHandlers-ç±»å‹å¤„ç†å™¨ç®€ä»‹"></a>10.å…¨å±€é…ç½®æ–‡ä»¶-typeHandlers-ç±»å‹å¤„ç†å™¨ç®€ä»‹</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">å®˜æ–¹æ–‡æ¡£</a></p><p>æ— è®ºæ˜¯ MyBatis åœ¨é¢„å¤„ç†è¯­å¥ï¼ˆ PreparedStatementï¼‰ä¸­è®¾ç½®ä¸€ä¸ªå‚æ•°æ—¶ï¼Œè¿˜æ˜¯ä»ç»“æœé›†ä¸­å–å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œéƒ½ä¼šç”¨ç±»å‹å¤„ç†å™¨å°†è·å–çš„å€¼ä»¥åˆé€‚çš„æ–¹å¼è½¬æ¢æˆ Java ç±»å‹ã€‚</p><table><thead><tr><th>ç±»å‹å¤„ç†å™¨</th><th>Java ç±»å‹</th><th>JDBC ç±»å‹</th></tr></thead><tbody><tr><td>BooleanTypeHandler</td><td>java.lang.Boolean, boolean</td><td>æ•°æ®åº“å…¼å®¹çš„ BOOLEAN</td></tr><tr><td>ByteTypeHandler</td><td>java.lang.Byte, byte</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– BYTE</td></tr><tr><td>ShortTypeHandler</td><td>java.lang.Short, short</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– SHORT INTEGER</td></tr><tr><td>IntegerTypeHandler</td><td>java.lang.Integer, int</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– INTEGER</td></tr><tr><td>LongTypeHandler</td><td>java.lang.Long, long</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– LONG INTEGER</td></tr><tr><td>FloatTypeHandler</td><td>java.lang.Float, float</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– FLOAT</td></tr><tr><td>DoubleTypeHandler</td><td>java.lang.Double, double</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– DOUBLE</td></tr><tr><td>BigDecimalTypeHandler</td><td>java.math.BigDecimal</td><td>æ•°æ®åº“å…¼å®¹çš„ NUMERIC æˆ– DECIMAL</td></tr><tr><td>StringTypeHandler</td><td>java.lang.String</td><td>CHAR, VARCHAR</td></tr></tbody></table><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">more</a></p><h3 id="æ—¥æœŸç±»å‹çš„å¤„ç†"><a href="#æ—¥æœŸç±»å‹çš„å¤„ç†" class="headerlink" title="æ—¥æœŸç±»å‹çš„å¤„ç†"></a>æ—¥æœŸç±»å‹çš„å¤„ç†</h3><ul><li>æ—¥æœŸå’Œæ—¶é—´çš„å¤„ç†ï¼Œ JDK1.8ä»¥å‰ä¸€ç›´æ˜¯ä¸ªå¤´ç–¼çš„é—®é¢˜ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨JSR310è§„èŒƒé¢†å¯¼è€…Stephen Colebourneåˆ›å»ºçš„Joda-Timeæ¥æ“ä½œã€‚ 1.8å·²ç»å®ç°å…¨éƒ¨çš„JSR310è§„èŒƒäº†ã€‚</li><li>æ—¥æœŸæ—¶é—´å¤„ç†ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MyBatisåŸºäºJSR310ï¼ˆ Date and Time APIï¼‰ç¼–å†™çš„å„ç§æ—¥æœŸæ—¶é—´ç±»å‹å¤„ç†å™¨ã€‚</li><li>MyBatis3.4ä»¥å‰çš„ç‰ˆæœ¬éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ³¨å†Œè¿™äº›å¤„ç†å™¨ï¼Œä»¥åçš„ç‰ˆæœ¬éƒ½æ˜¯è‡ªåŠ¨æ³¨å†Œçš„</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.InstantTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.LocalDateTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.LocalDateTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.LocalTime TypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.0ffsetDateTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.OffsetTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.ZonedDateTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.YearTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.MonthTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.YearMonthTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.JapaneseDateTypeHandler&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨"><a href="#è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨"></a>è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨</h3><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ç¤ºä¾‹</a></p><p>æˆ‘ä»¬å¯ä»¥é‡å†™ç±»å‹å¤„ç†å™¨æˆ–åˆ›å»ºè‡ªå·±çš„ç±»å‹å¤„ç†å™¨æ¥å¤„ç†ä¸æ”¯æŒçš„æˆ–éæ ‡å‡†çš„ç±»å‹ã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>å®ç°<code>org.apache.ibatis.type.TypeHandler</code>æ¥å£æˆ–è€…ç»§æ‰¿<code>org.apache.ibatis.type.BaseTypeHandler</code></li><li>æŒ‡å®šå…¶æ˜ å°„æŸä¸ªJDBCç±»å‹ï¼ˆå¯é€‰æ“ä½œï¼‰</li><li>åœ¨mybatiså…¨å±€é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œ</li></ol><h2 id="11-å…¨å±€é…ç½®æ–‡ä»¶-plugins-æ’ä»¶ç®€ä»‹"><a href="#11-å…¨å±€é…ç½®æ–‡ä»¶-plugins-æ’ä»¶ç®€ä»‹" class="headerlink" title="11.å…¨å±€é…ç½®æ–‡ä»¶-plugins-æ’ä»¶ç®€ä»‹"></a>11.å…¨å±€é…ç½®æ–‡ä»¶-plugins-æ’ä»¶ç®€ä»‹</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins">å®˜æ–¹æ–‡æ¡£</a></p><p>æ’ä»¶æ˜¯MyBatisæä¾›çš„ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ’ä»¶æ¥ä¿®æ”¹MyBatisçš„ä¸€äº›æ ¸å¿ƒè¡Œä¸ºã€‚ æ’ä»¶é€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå¯ä»¥ä»‹å…¥å››å¤§å¯¹è±¡çš„ä»»ä½•ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚</p><p>äº†è§£mybatisè¿è¡ŒåŸç†æ‰èƒ½æ›´å¥½å¼€å‘æ’ä»¶ã€‚</p><ul><li><code>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</code></li><li><code>ParameterHandler (getParameterObject, setParameters)</code></li><li><code>ResultSetHandler (handleResultSets, handleOutputParameters)</code></li><li><code>StatementHandler (prepare, parameterize, batch, update, query)</code></li></ul><h2 id="12-å…¨å±€é…ç½®æ–‡ä»¶-enviroments-è¿è¡Œç¯å¢ƒ"><a href="#12-å…¨å±€é…ç½®æ–‡ä»¶-enviroments-è¿è¡Œç¯å¢ƒ" class="headerlink" title="12.å…¨å±€é…ç½®æ–‡ä»¶-enviroments-è¿è¡Œç¯å¢ƒ"></a>12.å…¨å±€é…ç½®æ–‡ä»¶-enviroments-è¿è¡Œç¯å¢ƒ</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#environments">enviroments - å®˜æ–¹æ–‡æ¡£</a></p><ul><li>MyBatiså¯ä»¥é…ç½®å¤šç§ç¯å¢ƒï¼Œæ¯”å¦‚å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒéœ€è¦æœ‰ä¸åŒçš„é…ç½®ã€‚</li><li>æ¯ç§ç¯å¢ƒä½¿ç”¨ä¸€ä¸ªenvironmentæ ‡ç­¾è¿›è¡Œé…ç½®å¹¶æŒ‡å®šå”¯ä¸€æ ‡è¯†ç¬¦</li><li>å¯ä»¥é€šè¿‡environmentsæ ‡ç­¾ä¸­çš„defaultå±æ€§æŒ‡å®šä¸€ä¸ªç¯å¢ƒçš„æ ‡è¯†ç¬¦æ¥å¿«é€Ÿçš„åˆ‡æ¢ç¯å¢ƒ</li></ul><h3 id="environment-æŒ‡å®šå…·ä½“ç¯å¢ƒ"><a href="#environment-æŒ‡å®šå…·ä½“ç¯å¢ƒ" class="headerlink" title="environment-æŒ‡å®šå…·ä½“ç¯å¢ƒ"></a>environment-æŒ‡å®šå…·ä½“ç¯å¢ƒ</h3><ul><li>idï¼šæŒ‡å®šå½“å‰ç¯å¢ƒçš„å”¯ä¸€æ ‡è¯†</li><li>transactionManagerã€å’ŒdataSourceéƒ½å¿…é¡»æœ‰</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h4 id="transactionManager"><a href="#transactionManager" class="headerlink" title="transactionManager"></a>transactionManager</h4><ul><li>typeï¼š JDBC | MANAGED | è‡ªå®šä¹‰<ul><li>JDBCï¼šä½¿ç”¨äº† JDBC çš„æäº¤å’Œå›æ»šè®¾ç½®ï¼Œä¾èµ–äºä»æ•°æ®æºå¾—åˆ°çš„è¿æ¥æ¥ç®¡ç†äº‹åŠ¡èŒƒå›´ã€‚JdbcTransactionFactory</li><li>MANAGEDï¼šä¸æäº¤æˆ–å›æ»šä¸€ä¸ªè¿æ¥ã€è®©å®¹å™¨æ¥ç®¡ç†äº‹åŠ¡çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚ JEE åº”ç”¨æœåŠ¡å™¨çš„ä¸Šä¸‹æ–‡ï¼‰ã€‚ ManagedTransactionFactory</li><li>è‡ªå®šä¹‰ï¼šå®ç°TransactionFactoryæ¥å£ï¼Œ type&#x3D;å…¨ç±»å&#x2F;åˆ«å</li></ul></li></ul><h4 id="dataSource"><a href="#dataSource" class="headerlink" title="dataSource"></a>dataSource</h4><ul><li>typeï¼š UNPOOLED | POOLED | JNDI | è‡ªå®šä¹‰<ul><li>UNPOOLEDï¼šä¸ä½¿ç”¨è¿æ¥æ± ï¼Œ<br>UnpooledDataSourceFactory</li><li>POOLEDï¼šä½¿ç”¨è¿æ¥æ± ï¼Œ PooledDataSourceFactory</li><li>JNDIï¼š åœ¨EJB æˆ–åº”ç”¨æœåŠ¡å™¨è¿™ç±»å®¹å™¨ä¸­æŸ¥æ‰¾æŒ‡å®šçš„æ•°æ®æº</li><li>è‡ªå®šä¹‰ï¼šå®ç°DataSourceFactoryæ¥å£ï¼Œå®šä¹‰æ•°æ®æºçš„è·å–æ–¹å¼ã€‚</li></ul></li></ul><p><strong>å®é™…å¼€å‘ä¸­æˆ‘ä»¬ä½¿ç”¨Springç®¡ç†æ•°æ®æºï¼Œå¹¶è¿›è¡Œäº‹åŠ¡æ§åˆ¶çš„é…ç½®æ¥è¦†ç›–ä¸Šè¿°é…ç½®</strong>ã€‚</p><h2 id="13-å…¨å±€é…ç½®æ–‡ä»¶-databaseIdProvider-å¤šæ•°æ®åº“æ”¯æŒ"><a href="#13-å…¨å±€é…ç½®æ–‡ä»¶-databaseIdProvider-å¤šæ•°æ®åº“æ”¯æŒ" class="headerlink" title="13.å…¨å±€é…ç½®æ–‡ä»¶-databaseIdProvider-å¤šæ•°æ®åº“æ”¯æŒ"></a>13.å…¨å±€é…ç½®æ–‡ä»¶-databaseIdProvider-å¤šæ•°æ®åº“æ”¯æŒ</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider">databaseIdProvider - å®˜æ–¹æ–‡æ¡£</a></p><ul><li>MyBatis å¯ä»¥æ ¹æ®ä¸åŒçš„æ•°æ®åº“å‚å•†æ‰§è¡Œä¸åŒçš„è¯­å¥ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;SQL Server&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlserver&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DB2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Typeï¼š DB_VENDOR ä½¿ç”¨MyBatisæä¾›çš„VendorDatabaseIdProviderè§£ææ•°æ®åº“å‚å•†æ ‡è¯†ã€‚ä¹Ÿå¯ä»¥å®ç°DatabaseIdProvideræ¥å£æ¥è‡ªå®šä¹‰ã€‚</li><li>Property-nameï¼šæ•°æ®åº“å‚å•†æ ‡è¯†</li><li>Property-valueï¼šä¸ºæ ‡è¯†èµ·ä¸€ä¸ªåˆ«åï¼Œæ–¹ä¾¿SQLè¯­å¥ä½¿ç”¨databaseIdå±æ€§å¼•ç”¨</li></ul><p>DB_VENDOR - ä¼šé€šè¿‡ DatabaseMetaData#getDatabaseProductName() è¿”å›çš„å­—ç¬¦ä¸²è¿›è¡Œè®¾ç½®ã€‚ç”±äºé€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªå­—ç¬¦ä¸²éƒ½éå¸¸é•¿è€Œä¸”ç›¸åŒäº§å“çš„ä¸åŒç‰ˆæœ¬ä¼šè¿”å›ä¸åŒçš„å€¼ï¼Œæ‰€ä»¥<strong>æœ€å¥½é€šè¿‡è®¾ç½®å±æ€§åˆ«åæ¥ä½¿å…¶å˜çŸ­</strong></p><ul><li>databaseIdå±æ€§åœ¨æ˜ å°„xmlä½¿ç”¨</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">databaseId</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">	select * from employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">	select e.* from employee e where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>&lt;environments default=&quot;mysql&quot;&gt;</code>åˆ‡æ¢æ•°æ®åº“ï¼Œä¾¿èƒ½åˆ‡æ¢SQL</li></ul><p>MyBatisåŒ¹é…è§„åˆ™å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœæ²¡æœ‰é…ç½®databaseIdProvideræ ‡ç­¾ï¼Œé‚£ä¹ˆdatabaseId&#x3D;null</li><li>å¦‚æœé…ç½®äº†databaseIdProvideræ ‡ç­¾ï¼Œä½¿ç”¨æ ‡ç­¾é…ç½®çš„nameå»åŒ¹é…æ•°æ®åº“ä¿¡æ¯ï¼ŒåŒ¹é…ä¸Šè®¾ç½®databaseId&#x3D;é…ç½®æŒ‡å®šçš„å€¼ï¼Œå¦åˆ™ä¾æ—§ä¸ºnull</li><li>å¦‚æœdatabaseIdä¸ä¸ºnullï¼Œä»–åªä¼šæ‰¾åˆ°é…ç½®databaseIdçš„sqlè¯­å¥</li><li>MyBatis ä¼šåŠ è½½ä¸å¸¦ databaseId å±æ€§å’Œå¸¦æœ‰åŒ¹é…å½“å‰æ•°æ®åº“ databaseId å±æ€§çš„æ‰€æœ‰è¯­å¥ã€‚å¦‚æœåŒæ—¶æ‰¾åˆ°å¸¦æœ‰ databaseId å’Œä¸å¸¦ databaseId çš„ç›¸åŒè¯­å¥ï¼Œ åˆ™åè€…ä¼šè¢«èˆå¼ƒã€‚</li></ol><h2 id="14-å…¨å±€é…ç½®æ–‡ä»¶-mappers-sqlæ˜ å°„æ³¨å†Œ"><a href="#14-å…¨å±€é…ç½®æ–‡ä»¶-mappers-sqlæ˜ å°„æ³¨å†Œ" class="headerlink" title="14.å…¨å±€é…ç½®æ–‡ä»¶-mappers-sqlæ˜ å°„æ³¨å†Œ"></a>14.å…¨å±€é…ç½®æ–‡ä»¶-mappers-sqlæ˜ å°„æ³¨å†Œ</h2><p>æ—¢ç„¶ MyBatis çš„è¡Œä¸ºå·²ç»ç”±ä¸Šè¿°å…ƒç´ é…ç½®å®Œäº†ï¼Œæˆ‘ä»¬ç°åœ¨å°±è¦æ¥å®šä¹‰ SQL æ˜ å°„è¯­å¥äº†ã€‚ ä½†é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾åˆ°è¿™äº›è¯­å¥ã€‚ åœ¨è‡ªåŠ¨æŸ¥æ‰¾èµ„æºæ–¹é¢ï¼ŒJava å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥<strong>æœ€å¥½çš„åŠæ³•æ˜¯ç›´æ¥å‘Šè¯‰ MyBatis åˆ°å“ªé‡Œå»æ‰¾æ˜ å°„æ–‡ä»¶</strong>ã€‚ ä½ å¯ä»¥ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ï¼Œæˆ–å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆåŒ…æ‹¬ file:&#x2F;&#x2F;&#x2F; å½¢å¼çš„ URLï¼‰ï¼Œæˆ–ç±»åå’ŒåŒ…åç­‰ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨ç›¸å¯¹äºç±»è·¯å¾„çš„èµ„æºå¼•ç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨å®Œå…¨é™å®šèµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨æ˜ å°„å™¨æ¥å£å®ç°ç±»çš„å®Œå…¨é™å®šç±»å --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">æ³¨å†Œæ¥å£</span></span><br><span class="line"><span class="comment">classï¼šå¼•ç”¨ï¼ˆæ³¨å†Œï¼‰æ¥å£ï¼Œ</span></span><br><span class="line"><span class="comment">	1ã€æœ‰sqlæ˜ å°„æ–‡ä»¶ï¼Œæ˜ å°„æ–‡ä»¶åå¿…é¡»å’Œæ¥å£åŒåï¼Œå¹¶ä¸”æ”¾åœ¨ä¸æ¥å£åŒä¸€ç›®å½•ä¸‹ï¼›</span></span><br><span class="line"><span class="comment">	2ã€æ²¡æœ‰sqlæ˜ å°„æ–‡ä»¶ï¼Œæ‰€æœ‰çš„sqléƒ½æ˜¯åˆ©ç”¨æ³¨è§£å†™åœ¨æ¥å£ä¸Š;</span></span><br><span class="line"><span class="comment">	æ¨èï¼š</span></span><br><span class="line"><span class="comment">		æ¯”è¾ƒé‡è¦çš„ï¼Œå¤æ‚çš„Daoæ¥å£æˆ‘ä»¬æ¥å†™sqlæ˜ å°„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">		ä¸é‡è¦ï¼Œç®€å•çš„Daoæ¥å£ä¸ºäº†å¼€å‘å¿«é€Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£ï¼›</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å°†åŒ…å†…çš„æ˜ å°„å™¨æ¥å£å®ç°å…¨éƒ¨æ³¨å†Œä¸ºæ˜ å°„å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™äº›é…ç½®ä¼šå‘Šè¯‰ MyBatis å»å“ªé‡Œæ‰¾æ˜ å°„æ–‡ä»¶</p><h2 id="15-å°ç»“-2"><a href="#15-å°ç»“-2" class="headerlink" title="15.å°ç»“(2)"></a>15.å°ç»“(2)</h2><p>æ³¨æ„mybatiså…¨å±€é…ç½®æ–‡ä»¶ä¸­çš„æ ‡ç­¾é¡ºåºï¼Œéœ€è¦æŒ‰ä»¥ä¸‹é¡ºåºæ’åˆ—ï¼Œå¦åˆ™æŠ›å¼‚å¸¸</p><ul><li>configuration é…ç½®<ul><li>properties å±æ€§</li><li>settings è®¾ç½®</li><li>typeAliases ç±»å‹å‘½å</li><li>typeHandlers ç±»å‹å¤„ç†å™¨</li><li>objectFactory å¯¹è±¡å·¥å‚</li><li>plugins æ’ä»¶</li><li>environments ç¯å¢ƒ<ul><li>environment ç¯å¢ƒå˜é‡<ul><li>transactionManager äº‹åŠ¡ç®¡ç†å™¨</li><li>dataSource æ•°æ®æº</li></ul></li></ul></li><li>databaseIdProvider æ•°æ®åº“å‚å•†æ ‡è¯†</li><li>mappers æ˜ å°„å™¨</li></ul></li></ul><h2 id="16-æ˜ å°„æ–‡ä»¶-å¢åˆ æ”¹æŸ¥"><a href="#16-æ˜ å°„æ–‡ä»¶-å¢åˆ æ”¹æŸ¥" class="headerlink" title="16.æ˜ å°„æ–‡ä»¶-å¢åˆ æ”¹æŸ¥"></a>16.æ˜ å°„æ–‡ä»¶-å¢åˆ æ”¹æŸ¥</h2><p>æ˜ å°„æ–‡ä»¶æŒ‡å¯¼ç€MyBatiså¦‚ä½•è¿›è¡Œæ•°æ®åº“å¢åˆ æ”¹æŸ¥ï¼Œæœ‰ç€éå¸¸é‡è¦çš„æ„ä¹‰ï¼›</p><ul><li>cache â€“å‘½åç©ºé—´çš„äºŒçº§ç¼“å­˜é…ç½®</li><li>cache-ref â€“ å…¶ä»–å‘½åç©ºé—´ç¼“å­˜é…ç½®çš„å¼•ç”¨ã€‚</li><li>resultMap â€“ è‡ªå®šä¹‰ç»“æœé›†æ˜ å°„</li><li>parameterMap â€“ <strong>å·²åºŸå¼ƒ</strong>ï¼è€å¼é£æ ¼çš„å‚æ•°æ˜ å°„</li><li>sql â€“æŠ½å–å¯é‡ç”¨è¯­å¥å—ã€‚</li><li>insert â€“ æ˜ å°„æ’å…¥è¯­å¥</li><li>update â€“ æ˜ å°„æ›´æ–°è¯­å¥</li><li>delete â€“ æ˜ å°„åˆ é™¤è¯­å¥</li><li>select â€“ æ˜ å°„æŸ¥è¯¢è¯­å¥</li></ul><h3 id="CRUDåˆä½“éªŒ"><a href="#CRUDåˆä½“éªŒ" class="headerlink" title="CRUDåˆä½“éªŒ"></a>CRUDåˆä½“éªŒ</h3><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Long <span class="title function_">addEmp</span><span class="params">(Employee employee)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateEmp</span><span class="params">(Employee employee)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public void addEmp(Employee employee); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">		insert into employee(last_name,email,gender) </span><br><span class="line">		values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void updateEmp(Employee employee);  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmp&quot;</span>&gt;</span></span><br><span class="line">		update employee </span><br><span class="line">		set last_name=#&#123;lastName&#125;,email=#&#123;email&#125;,gender=#&#123;gender&#125;</span><br><span class="line">		where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void deleteEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteEmpById&quot;</span>&gt;</span></span><br><span class="line">		delete from employee where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCrud</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">newEmployee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="literal">null</span>,<span class="string">&quot;kuang&quot;</span>,<span class="string">&quot;kuang@163.com&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//å¢</span></span><br><span class="line">			<span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> mapper.addEmp(newEmployee);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//æŸ¥</span></span><br><span class="line">			System.out.println(<span class="string">&quot;After creating : &quot;</span> + mapper.getEmpById(newEmployee.getId()));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//æ”¹</span></span><br><span class="line">			newEmployee.setGender(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">			mapper.updateEmp(newEmployee);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//æŸ¥</span></span><br><span class="line">			System.out.println(<span class="string">&quot;After updating : &quot;</span> + mapper.getEmpById(newEmployee.getId()));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//åˆ </span></span><br><span class="line">			mapper.deleteEmpById(newEmployee.getId());</span><br><span class="line">			System.out.println(<span class="string">&quot;After deleting : &quot;</span> + mapper.getEmpById(newEmployee.getId()));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦å¤–"><a href="#å¦å¤–" class="headerlink" title="å¦å¤–"></a>å¦å¤–</h3><ol><li>mybatiså…è®¸å¢åˆ æ”¹ç›´æ¥å®šä¹‰ä»¥ä¸‹ç±»å‹è¿”å›å€¼<ul><li>Integerã€Longã€Booleanã€void</li></ul></li><li>æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æäº¤æ•°æ®<ul><li>sqlSessionFactory.openSession();&#x3D;&#x3D;&#x3D;ã€‹æ‰‹åŠ¨æäº¤</li><li>sqlSessionFactory.openSession(true);&#x3D;&#x3D;&#x3D;ã€‹è‡ªåŠ¨æäº¤</li></ul></li></ol><h2 id="17-æ˜ å°„æ–‡ä»¶-insert-è·å–è‡ªå¢ä¸»é”®çš„å€¼"><a href="#17-æ˜ å°„æ–‡ä»¶-insert-è·å–è‡ªå¢ä¸»é”®çš„å€¼" class="headerlink" title="17.æ˜ å°„æ–‡ä»¶-insert-è·å–è‡ªå¢ä¸»é”®çš„å€¼"></a>17.æ˜ å°„æ–‡ä»¶-insert-è·å–è‡ªå¢ä¸»é”®çš„å€¼</h2><ul><li>parameterTypeï¼šå‚æ•°ç±»å‹ï¼Œå¯ä»¥çœç•¥ï¼Œ</li><li>è·å–è‡ªå¢ä¸»é”®çš„å€¼ï¼š<ul><li>mysqlæ”¯æŒè‡ªå¢ä¸»é”®ï¼Œè‡ªå¢ä¸»é”®å€¼çš„è·å–ï¼Œmybatisä¹Ÿæ˜¯åˆ©ç”¨statement.getGenreatedKeys()ï¼›</li><li>useGeneratedKeys&#x3D;â€trueâ€ï¼›ä½¿ç”¨è‡ªå¢ä¸»é”®è·å–ä¸»é”®å€¼ç­–ç•¥</li><li>keyPropertyï¼›æŒ‡å®šå¯¹åº”çš„ä¸»é”®å±æ€§ï¼Œä¹Ÿå°±æ˜¯mybatisè·å–åˆ°ä¸»é”®å€¼ä»¥åï¼Œå°†è¿™ä¸ªå€¼å°è£…ç»™javaBeançš„å“ªä¸ªå±æ€§</li></ul></li></ul><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public void addEmp(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">	insert into employee(last_name,email,gender) </span><br><span class="line">	values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="18-æ˜ å°„æ–‡ä»¶-insert-Oracleä½¿ç”¨åºåˆ—ç”Ÿæˆä¸»é”®æ¼”ç¤º"><a href="#18-æ˜ å°„æ–‡ä»¶-insert-Oracleä½¿ç”¨åºåˆ—ç”Ÿæˆä¸»é”®æ¼”ç¤º" class="headerlink" title="18.æ˜ å°„æ–‡ä»¶-insert-Oracleä½¿ç”¨åºåˆ—ç”Ÿæˆä¸»é”®æ¼”ç¤º"></a>18.æ˜ å°„æ–‡ä»¶-insert-Oracleä½¿ç”¨åºåˆ—ç”Ÿæˆä¸»é”®æ¼”ç¤º</h2><ul><li>Oracleä¸æ”¯æŒè‡ªå¢ï¼›Oracleä½¿ç”¨åºåˆ—æ¥æ¨¡æ‹Ÿè‡ªå¢ï¼›</li><li>æ¯æ¬¡æ’å…¥çš„æ•°æ®çš„ä¸»é”®æ˜¯ä»åºåˆ—ä¸­æ‹¿åˆ°çš„å€¼ï¼›å¦‚ä½•è·å–åˆ°è¿™ä¸ªå€¼ï¼›</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ä»åºåˆ—è·å–æ–°ä¸»é”®å€¼</span><br><span class="line"><span class="keyword">select</span> employee_seq.nextval <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><h2 id="19-oracleä½¿ç”¨ï¼‰æ˜ å°„æ–‡ä»¶-insert-è·å–éè‡ªå¢ä¸»é”®çš„å€¼-selectKey"><a href="#19-oracleä½¿ç”¨ï¼‰æ˜ å°„æ–‡ä»¶-insert-è·å–éè‡ªå¢ä¸»é”®çš„å€¼-selectKey" class="headerlink" title="19.(oracleä½¿ç”¨ï¼‰æ˜ å°„æ–‡ä»¶-insert-è·å–éè‡ªå¢ä¸»é”®çš„å€¼-selectKey"></a>19.(oracleä½¿ç”¨ï¼‰æ˜ å°„æ–‡ä»¶-insert-è·å–éè‡ªå¢ä¸»é”®çš„å€¼-selectKey</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	keyProperty:æŸ¥å‡ºçš„ä¸»é”®å€¼å°è£…ç»™javaBeançš„å“ªä¸ªå±æ€§</span></span><br><span class="line"><span class="comment">	order=&quot;BEFORE&quot;:å½“å‰sqlåœ¨æ’å…¥sqlä¹‹å‰è¿è¡Œ</span></span><br><span class="line"><span class="comment">		   AFTERï¼šå½“å‰sqlåœ¨æ’å…¥sqlä¹‹åè¿è¡Œ</span></span><br><span class="line"><span class="comment">	resultType:æŸ¥å‡ºçš„æ•°æ®çš„è¿”å›å€¼ç±»å‹</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	BEFOREè¿è¡Œé¡ºåºï¼š</span></span><br><span class="line"><span class="comment">		å…ˆè¿è¡ŒselectKeyæŸ¥è¯¢idçš„sqlï¼›æŸ¥å‡ºidå€¼å°è£…ç»™javaBeançš„idå±æ€§</span></span><br><span class="line"><span class="comment">		åœ¨è¿è¡Œæ’å…¥çš„sqlï¼›å°±å¯ä»¥å–å‡ºidå±æ€§å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="comment">	AFTERè¿è¡Œé¡ºåºï¼š</span></span><br><span class="line"><span class="comment">		å…ˆè¿è¡Œæ’å…¥çš„sqlï¼ˆä»åºåˆ—ä¸­å–å‡ºæ–°å€¼ä½œä¸ºidï¼‰ï¼›</span></span><br><span class="line"><span class="comment">		å†è¿è¡ŒselectKeyæŸ¥è¯¢idçš„sqlï¼›</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- ç¼–å†™æŸ¥è¯¢ä¸»é”®çš„sqlè¯­å¥ --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- BEFORE--&gt;</span></span><br><span class="line">		select EMPLOYEES_SEQ.nextval from dual </span><br><span class="line">		<span class="comment">&lt;!-- AFTERï¼š</span></span><br><span class="line"><span class="comment">		 select EMPLOYEES_SEQ.currval from dual --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- æ’å…¥æ—¶çš„ä¸»é”®æ˜¯ä»åºåˆ—ä¸­æ‹¿åˆ°çš„ --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- BEFORE:--&gt;</span></span><br><span class="line">	insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span><br><span class="line">	values(#&#123;id&#125;,#&#123;lastName&#125;,#&#123;email<span class="comment">&lt;!-- ,jdbcType=NULL --&gt;</span>&#125;) </span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- AFTERï¼š</span></span><br><span class="line"><span class="comment">	insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span></span><br><span class="line"><span class="comment">	values(employees_seq.nextval,#&#123;lastName&#125;,#&#123;email&#125;) --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>selectKey å…ƒç´ çš„å±æ€§</strong></p><table><thead><tr><th>å±æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>keyProperty</td><td>selectKey è¯­å¥ç»“æœåº”è¯¥è¢«è®¾ç½®åˆ°çš„ç›®æ ‡å±æ€§ã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªå±æ€§åç§°ã€‚</td></tr><tr><td>keyColumn</td><td>è¿”å›ç»“æœé›†ä¸­ç”Ÿæˆåˆ—å±æ€§çš„åˆ—åã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œå¯ä»¥ç”¨é€—å·åˆ†éš”å¤šä¸ªå±æ€§åç§°ã€‚</td></tr><tr><td>resultType</td><td>ç»“æœçš„ç±»å‹ã€‚é€šå¸¸ MyBatis å¯ä»¥æ¨æ–­å‡ºæ¥ï¼Œä½†æ˜¯ä¸ºäº†æ›´åŠ å‡†ç¡®ï¼Œå†™ä¸Šä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚MyBatis å…è®¸å°†ä»»ä½•ç®€å•ç±»å‹ç”¨ä½œä¸»é”®çš„ç±»å‹ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ã€‚å¦‚æœç”Ÿæˆåˆ—ä¸æ­¢ä¸€ä¸ªï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŒ…å«æœŸæœ›å±æ€§çš„ Object æˆ– Mapã€‚</td></tr><tr><td>order</td><td>å¯ä»¥è®¾ç½®ä¸º BEFORE æˆ– AFTERã€‚å¦‚æœè®¾ç½®ä¸º BEFOREï¼Œé‚£ä¹ˆå®ƒé¦–å…ˆä¼šç”Ÿæˆä¸»é”®ï¼Œè®¾ç½® keyProperty å†æ‰§è¡Œæ’å…¥è¯­å¥ã€‚å¦‚æœè®¾ç½®ä¸º AFTERï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œæ’å…¥è¯­å¥ï¼Œç„¶åæ˜¯ selectKey ä¸­çš„è¯­å¥ - è¿™å’Œ Oracle æ•°æ®åº“çš„è¡Œä¸ºç›¸ä¼¼ï¼Œåœ¨æ’å…¥è¯­å¥å†…éƒ¨å¯èƒ½æœ‰åµŒå…¥ç´¢å¼•è°ƒç”¨ã€‚</td></tr><tr><td>statementType</td><td>å’Œå‰é¢ä¸€æ ·ï¼ŒMyBatis æ”¯æŒ STATEMENTï¼ŒPREPARED å’Œ CALLABLE ç±»å‹çš„æ˜ å°„è¯­å¥ï¼Œåˆ†åˆ«ä»£è¡¨ Statement, PreparedStatement å’Œ CallableStatement ç±»å‹ã€‚</td></tr></tbody></table><h2 id="20-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å•ä¸ªå‚æ•°-amp-å¤šä¸ªå‚æ•°-amp-å‘½åå‚æ•°"><a href="#20-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å•ä¸ªå‚æ•°-amp-å¤šä¸ªå‚æ•°-amp-å‘½åå‚æ•°" class="headerlink" title="20.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å•ä¸ªå‚æ•°&amp;å¤šä¸ªå‚æ•°&amp;å‘½åå‚æ•°"></a>20.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å•ä¸ªå‚æ•°&amp;å¤šä¸ªå‚æ•°&amp;å‘½åå‚æ•°</h2><ul><li>å•ä¸ªå‚æ•°ï¼šmybatisä¸ä¼šåšç‰¹æ®Šå¤„ç†ï¼Œ<ul><li><code>#&#123;å‚æ•°å/ä»»æ„å&#125;</code>ï¼šå–å‡ºå‚æ•°å€¼ã€‚</li></ul></li><li>å¤šä¸ªå‚æ•°ï¼šmybatisä¼šåšç‰¹æ®Šå¤„ç†ã€‚<ul><li>é€šå¸¸æ“ä½œï¼š<ul><li>æ–¹æ³•ï¼špublic Employee getEmpByIdAndLastName(Integer id,String lastName);</li><li>å–å€¼ï¼š<code>#&#123;id&#125;</code>,<code>#&#123;lastName&#125;</code></li></ul></li><li>ä¸Šè¿°æ“ä½œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š<code>org.apache.ibatis.binding.BindingException: Parameter &#39;id&#39; not found. Available parameters are [1, 0, param1, param2]</code></li><li>å¤šä¸ªå‚æ•°ä¼šè¢«å°è£…æˆ ä¸€ä¸ªmapï¼Œ<ul><li>keyï¼šparam1â€¦paramN,æˆ–è€…å‚æ•°çš„ç´¢å¼•ä¹Ÿå¯ä»¥</li><li>valueï¼šä¼ å…¥çš„å‚æ•°å€¼</li></ul></li><li><code>#&#123;&#125;</code>å°±æ˜¯ä»mapä¸­è·å–æŒ‡å®šçš„keyçš„å€¼ï¼›</li></ul></li><li>ã€å‘½åå‚æ•°ã€‘ï¼šæ˜ç¡®æŒ‡å®šå°è£…å‚æ•°æ—¶mapçš„keyï¼›@Param(â€œidâ€)<ul><li>å¤šä¸ªå‚æ•°ä¼šè¢«å°è£…æˆ ä¸€ä¸ªmapï¼Œ<ul><li>keyï¼šä½¿ç”¨@Paramæ³¨è§£æŒ‡å®šçš„å€¼</li><li>valueï¼šå‚æ•°å€¼</li></ul></li><li><code>#&#123;æŒ‡å®šçš„key&#125;</code>å–å‡ºå¯¹åº”çš„å‚æ•°å€¼</li></ul></li></ul><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParameters</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1. </span></span><br><span class="line">		<span class="comment">//å•ä¸ªå‚æ•°ï¼šmybatisä¸ä¼šåšç‰¹æ®Šå¤„ç†</span></span><br><span class="line">		System.out.println(mapper.getEmpById2(<span class="number">1</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.</span></span><br><span class="line">		<span class="comment">//å¤šä¸ªå‚æ•°ï¼Œæœªä½œå¤„ç† ï¼Œmapperç›´ç”¨#&#123;id&#125;,#&#123;lastName&#125;ä¼šæŠ›å¼‚å¸¸ </span></span><br><span class="line">		<span class="keyword">try</span> &#123;				</span><br><span class="line">			System.out.println(mapper.getEmpByIdAndLastName(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">			<span class="comment">//org.apache.ibatis.exceptions.PersistenceException: </span></span><br><span class="line">			<span class="comment">//### Error querying database.  Cause: org.apache.ibatis.binding.BindingException: Parameter &#x27;id&#x27; not found. Available parameters are [0, 1, param1, param2]</span></span><br><span class="line">			<span class="comment">//### Cause: org.apache.ibatis.binding.BindingException: Parameter &#x27;id&#x27; not found. Available parameters are [0, 1, param1, param2]</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(PersistenceException ex) &#123;</span><br><span class="line">			System.err.println(ex);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//å¤šä¸ªå‚æ•°ä¼šè¢«å°è£…æˆ ä¸€ä¸ªmap</span></span><br><span class="line">		<span class="comment">//keyï¼šparam1...paramN,æˆ–è€…å‚æ•°çš„ç´¢å¼•0, 1..ä¹Ÿå¯ä»¥(è¿™ç§æ–¹æ³•çš„å¯è¯»æ€§è¾ƒå·®)</span></span><br><span class="line">		<span class="comment">//valueï¼šä¼ å…¥çš„å‚æ•°å€¼</span></span><br><span class="line">		System.out.println(mapper.getEmpByIdAndLastName2(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">		System.out.println(mapper.getEmpByIdAndLastName3(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3. </span></span><br><span class="line">		<span class="comment">//ã€å‘½åå‚æ•°ã€‘ï¼šæ˜ç¡®æŒ‡å®šå°è£…å‚æ•°æ—¶mapçš„keyï¼›@Param(&quot;id&quot;)</span></span><br><span class="line">		System.out.println(mapper.getEmpByIdAndLastName4(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- å¤šä¸ªå‚æ•°ï¼Œä¸èƒ½ç›´å†™idæˆ–lastNameï¼Œå¦åˆ™æŠ›å‡º org.apache.ibatis.binding.BindingException: Parameter &#x27;id&#x27; not found. Available parameters are [1, 0, param1, param2]--&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from tbl_employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;0&#125; and last_name=#&#123;1&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName3&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;param1&#125; and last_name=#&#123;param2&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName4&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName</span><span class="params">(Integer id, String name)</span>;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName2</span><span class="params">(Integer id, String name)</span>;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName3</span><span class="params">(Integer id, String name)</span>;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName4</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id,// </span></span><br><span class="line"><span class="params">										<span class="meta">@Param(&quot;lastName&quot;)</span>String name)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="21-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-POJO-amp-Map-amp-TO"><a href="#21-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-POJO-amp-Map-amp-TO" class="headerlink" title="21.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-POJO&amp;Map&amp;TO"></a>21.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-POJO&amp;Map&amp;TO</h2><ul><li>POJOï¼šå¦‚æœå¤šä¸ªå‚æ•°æ­£å¥½æ˜¯æˆ‘ä»¬ä¸šåŠ¡é€»è¾‘çš„æ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä¼ å…¥pojoï¼›<ul><li><code>#&#123;å±æ€§å&#125;</code>ï¼šå–å‡ºä¼ å…¥çš„pojoçš„å±æ€§å€¼</li></ul></li><li>Mapï¼šå¦‚æœå¤šä¸ªå‚æ•°ä¸æ˜¯ä¸šåŠ¡æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œæ²¡æœ‰å¯¹åº”çš„pojoï¼Œä¸ç»å¸¸ä½¿ç”¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ å…¥map<ul><li><code>#&#123;key&#125;</code>ï¼šå–å‡ºmapä¸­å¯¹åº”çš„å€¼</li></ul></li><li>TOï¼šå¦‚æœå¤šä¸ªå‚æ•°ä¸æ˜¯ä¸šåŠ¡æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œä½†æ˜¯ç»å¸¸è¦ä½¿ç”¨ï¼Œæ¨èæ¥ç¼–å†™ä¸€ä¸ªTOï¼ˆTransfer Objectï¼‰æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œå¦‚ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Page&#123;</span><br><span class="line">	<span class="type">int</span> index;</span><br><span class="line">	<span class="type">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParameters</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		...</span><br><span class="line">		<span class="comment">//4.</span></span><br><span class="line">		<span class="comment">//ä¼ å…¥map</span></span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">		map.put(<span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;jallen&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;4. &quot;</span> + mapper.getEmpByMap(map));</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- map ä½œå‚è¾“å…¥ --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="22-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å‚æ•°å°è£…æ‰©å±•æ€è€ƒ"><a href="#22-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å‚æ•°å°è£…æ‰©å±•æ€è€ƒ" class="headerlink" title="22.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å‚æ•°å°è£…æ‰©å±•æ€è€ƒ"></a>22.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å‚æ•°å°è£…æ‰©å±•æ€è€ƒ</h2><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;æ€è€ƒ&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><ul><li><p><code>public Employee getEmp(@Param(&quot;id&quot;)Integer id,String lastName);</code></p><ul><li>å–å€¼ï¼šid&#x3D;&#x3D;&gt;#{id&#x2F;param1} lastName&#x3D;&#x3D;&gt;#{param2}</li></ul></li><li><p><code>public Employee getEmp(Integer id,@Param(&quot;e&quot;)Employee emp);</code></p><ul><li>å–å€¼ï¼šid&#x3D;&#x3D;&gt;#{param1} lastName&#x3D;&#x3D;&#x3D;&gt;#{param2.lastName&#x2F;e.lastName}</li></ul></li><li><p><strong>ç‰¹åˆ«æ³¨æ„</strong>ï¼šå¦‚æœæ˜¯Collectionï¼ˆListã€Setï¼‰ç±»å‹æˆ–è€…æ˜¯æ•°ç»„ï¼Œ</p><ul><li>ä¹Ÿä¼šç‰¹æ®Šå¤„ç†ã€‚ä¹Ÿæ˜¯æŠŠä¼ å…¥çš„listæˆ–è€…æ•°ç»„å°è£…åœ¨mapä¸­ã€‚</li><li>keyï¼šCollectionï¼ˆcollectionï¼‰,å¦‚æœæ˜¯Listè¿˜å¯ä»¥ä½¿ç”¨è¿™ä¸ªkey(list)</li><li><code>public Employee getEmpById(List&lt;Integer&gt; ids);</code><ul><li>å–å€¼ï¼šå–å‡ºç¬¬ä¸€ä¸ªidçš„å€¼ï¼š #{list[0]}</li></ul></li></ul></li></ul><h2 id="23-æºç åˆ†æ-å‚æ•°å¤„ç†-å‚æ•°å°è£…mapçš„è¿‡ç¨‹"><a href="#23-æºç åˆ†æ-å‚æ•°å¤„ç†-å‚æ•°å°è£…mapçš„è¿‡ç¨‹" class="headerlink" title="23.æºç åˆ†æ-å‚æ•°å¤„ç†-å‚æ•°å°è£…mapçš„è¿‡ç¨‹"></a>23.æºç åˆ†æ-å‚æ•°å¤„ç†-å‚æ•°å°è£…mapçš„è¿‡ç¨‹</h2><p><strong>ç»“åˆæºç ï¼Œmybatisæ€ä¹ˆå¤„ç†å‚æ•°</strong></p><ul><li>(@Param(â€œidâ€)Integer id,@Param(â€œlastNameâ€)String lastName);</li><li>ParamNameResolverè§£æå‚æ•°å°è£…mapçš„ï¼›</li><li>namesï¼š{0&#x3D;id, 1&#x3D;lastName}ï¼›æ„é€ å™¨çš„æ—¶å€™å°±ç¡®å®šå¥½äº†</li></ul><p>ç¡®å®šæµç¨‹ï¼š<br>1.è·å–æ¯ä¸ªæ ‡äº†paramæ³¨è§£çš„å‚æ•°çš„@Paramçš„å€¼ï¼šidï¼ŒlastNameï¼› èµ‹å€¼ç»™name;<br>2.æ¯æ¬¡è§£æä¸€ä¸ªå‚æ•°ç»™mapä¸­ä¿å­˜ä¿¡æ¯ï¼šï¼ˆkeyï¼šå‚æ•°ç´¢å¼•ï¼Œvalueï¼šnameçš„å€¼ï¼‰<br>nameçš„å€¼ï¼š<br>æ ‡æ³¨äº†paramæ³¨è§£ï¼šæ³¨è§£çš„å€¼<br>æ²¡æœ‰æ ‡æ³¨ï¼š<br>1.å…¨å±€é…ç½®ï¼šuseActualParamNameï¼ˆjdk1.8ï¼‰ï¼šname&#x3D;å‚æ•°å<br>2.name&#x3D;map.size()ï¼›ç›¸å½“äºå½“å‰å…ƒç´ çš„ç´¢å¼•<br>{0&#x3D;id, 1&#x3D;lastName,2&#x3D;2}</p><p>argsã€1ï¼Œâ€Tomâ€,â€™helloâ€™ã€‘:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getNamedParams</span><span class="params">(Object[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">paramCount</span> <span class="operator">=</span> names.size();</span><br><span class="line">    <span class="comment">//1ã€å‚æ•°ä¸ºnullç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (args == <span class="literal">null</span> || paramCount == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//2ã€å¦‚æœåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”æ²¡æœ‰Paramæ³¨è§£ï¼›args[0]ï¼šå•ä¸ªå‚æ•°ç›´æ¥è¿”å›</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hasParamAnnotation &amp;&amp; paramCount == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> args[names.firstKey()];</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//3ã€å¤šä¸ªå…ƒç´ æˆ–è€…æœ‰Paramæ ‡æ³¨</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> Map&lt;String, Object&gt; param = <span class="keyword">new</span> <span class="title class_">ParamMap</span>&lt;Object&gt;();</span><br><span class="line">      <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//4ã€éå†namesé›†åˆï¼›&#123;0=id, 1=lastName,2=2&#125;</span></span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : names.entrySet()) &#123;</span><br><span class="line">      </span><br><span class="line">      	<span class="comment">//namesé›†åˆçš„valueä½œä¸ºkey;  namesé›†åˆçš„keyåˆä½œä¸ºå–å€¼çš„å‚è€ƒargs[0]:argsã€1ï¼Œ&quot;Tom&quot;ã€‘:</span></span><br><span class="line">      	<span class="comment">//eg:&#123;id=args[0]:1,lastName=args[1]:Tom,2=args[2]&#125;</span></span><br><span class="line">        param.put(entry.getValue(), args[entry.getKey()]);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// add generic param names (param1, param2, ...)param</span></span><br><span class="line">        <span class="comment">//é¢å¤–çš„å°†æ¯ä¸€ä¸ªå‚æ•°ä¹Ÿä¿å­˜åˆ°mapä¸­ï¼Œä½¿ç”¨æ–°çš„keyï¼šparam1...paramN</span></span><br><span class="line">        <span class="comment">//æ•ˆæœï¼šæœ‰Paramæ³¨è§£å¯ä»¥#&#123;æŒ‡å®šçš„key&#125;ï¼Œæˆ–è€…#&#123;param1&#125;</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">genericParamName</span> <span class="operator">=</span> GENERIC_NAME_PREFIX + String.valueOf(i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// ensure not to overwrite parameter named with @Param</span></span><br><span class="line">        <span class="keyword">if</span> (!names.containsValue(genericParamName)) &#123;</span><br><span class="line">          param.put(genericParamName, args[entry.getKey()]);</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> param;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong>ï¼šå‚æ•°å¤šæ—¶ä¼šå°è£…mapï¼Œä¸ºäº†ä¸æ··ä¹±ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Paramæ¥æŒ‡å®šå°è£…æ—¶ä½¿ç”¨çš„keyï¼›#{key}å°±å¯ä»¥å–å‡ºmapä¸­çš„å€¼ï¼›</p><h2 id="24-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-ä¸-å–å€¼åŒºåˆ«"><a href="#24-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-ä¸-å–å€¼åŒºåˆ«" class="headerlink" title="24.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-#ä¸$å–å€¼åŒºåˆ«"></a>24.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-#ä¸$å–å€¼åŒºåˆ«</h2><p><code>#&#123;&#125;</code>å’Œ<code>$&#123;&#125;</code>éƒ½å¯ä»¥è·å–mapä¸­çš„å€¼æˆ–è€…pojoå¯¹è±¡å±æ€§çš„å€¼ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_employee <span class="keyword">where</span> id<span class="operator">=</span>$&#123;id&#125; <span class="keyword">and</span> last_name<span class="operator">=</span>#&#123;lastName&#125;</span><br><span class="line">#Preparing:</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_employee <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> last_name<span class="operator">=</span>?</span><br></pre></td></tr></table></figure><p><strong>åŒºåˆ«</strong>ï¼š</p><ul><li><code>#&#123;&#125;</code> : æ˜¯ä»¥é¢„ç¼–è¯‘çš„å½¢å¼ï¼Œå°†å‚æ•°è®¾ç½®åˆ°sqlè¯­å¥ä¸­ï¼›PreparedStatementï¼›é˜²æ­¢sqlæ³¨å…¥</li><li><code>$&#123;&#125;</code> : å–å‡ºçš„å€¼<strong>ç›´æ¥æ‹¼è£…</strong>åœ¨sqlè¯­å¥ä¸­ï¼›ä¼šæœ‰å®‰å…¨é—®é¢˜ï¼›</li></ul><p>å¤§å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»å‚æ•°çš„å€¼éƒ½åº”è¯¥å»ä½¿ç”¨<code>#&#123;&#125;</code>ã€‚</p><p>åŸç”Ÿjdbcä¸æ”¯æŒå ä½ç¬¦çš„åœ°æ–¹æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>$&#123;&#125;</code>è¿›è¡Œå–å€¼ï¼Œæ¯”å¦‚åˆ†è¡¨ã€æ’åºã€‚ã€‚ã€‚ï¼›æŒ‰ç…§å¹´ä»½åˆ†è¡¨æ‹†åˆ†</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> $&#123;<span class="keyword">year</span>&#125;_salary <span class="keyword">where</span> xxx;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_employee <span class="keyword">order</span> <span class="keyword">by</span> $&#123;f_name&#125; $&#123;<span class="keyword">order</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="25-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å–å€¼æ—¶æŒ‡å®šå‚æ•°ç›¸å…³è§„åˆ™"><a href="#25-æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å–å€¼æ—¶æŒ‡å®šå‚æ•°ç›¸å…³è§„åˆ™" class="headerlink" title="25.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-#å–å€¼æ—¶æŒ‡å®šå‚æ•°ç›¸å…³è§„åˆ™"></a>25.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-#å–å€¼æ—¶æŒ‡å®šå‚æ•°ç›¸å…³è§„åˆ™</h2><p><code>#&#123;&#125;</code>:æ›´ä¸°å¯Œçš„ç”¨æ³•ï¼š</p><p>è§„å®šå‚æ•°çš„ä¸€äº›è§„åˆ™ï¼š</p><ul><li>javaTypeã€</li><li>jdbcTypeã€</li><li>modeï¼ˆå­˜å‚¨è¿‡ç¨‹ï¼‰ã€</li><li>numericScaleã€</li><li>resultMapã€</li><li>typeHandlerã€</li><li>jdbcTypeNameã€</li><li>expressionï¼ˆæœªæ¥å‡†å¤‡æ”¯æŒçš„åŠŸèƒ½ï¼‰ï¼›</li></ul><p>ä¾‹å¦‚ï¼šjdbcType</p><p>jdbcTypeé€šå¸¸éœ€è¦åœ¨æŸç§ç‰¹å®šçš„æ¡ä»¶ä¸‹è¢«è®¾ç½®ï¼š</p><ul><li>åœ¨æˆ‘ä»¬æ•°æ®ä¸ºnullçš„æ—¶å€™ï¼Œæœ‰äº›æ•°æ®åº“å¯èƒ½ä¸èƒ½è¯†åˆ«mybatiså¯¹nullçš„é»˜è®¤å¤„ç†ã€‚æ¯”å¦‚Oracle DBï¼ˆæŠ¥é”™ï¼‰ï¼›</li><li>JdbcType OTHERï¼šæ— æ•ˆçš„ç±»å‹ï¼›å› ä¸ºmybatiså¯¹æ‰€æœ‰çš„nulléƒ½æ˜ å°„çš„æ˜¯åŸç”ŸJdbcçš„OTHERç±»å‹ï¼ŒOracle DBä¸èƒ½æ­£ç¡®å¤„ç†;</li></ul><p>ç”±äºå…¨å±€é…ç½®ä¸­ï¼šjdbcTypeForNull&#x3D;OTHERï¼ŒOracle DBä¸æ”¯æŒï¼Œä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p><ol><li>åœ¨mapperæ–‡ä»¶ä¸­å†™<code>#&#123;email,jdbcType=NULL&#125;</code>;</li><li>åœ¨å…¨å±€é…ç½®æ–‡ä»¶<code>&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot;/&gt;</code></li></ol><h2 id="26-æ˜ å°„æ–‡ä»¶-select-è¿”å›List"><a href="#26-æ˜ å°„æ–‡ä»¶-select-è¿”å›List" class="headerlink" title="26.æ˜ å°„æ–‡ä»¶-select-è¿”å›List"></a>26.æ˜ å°„æ–‡ä»¶-select-è¿”å›List</h2><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByLastNameLike(String lastName); --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--resultTypeï¼šå¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªé›†åˆï¼Œè¦å†™é›†åˆä¸­å…ƒç´ çš„ç±»å‹  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByLastNameLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where last_name like #&#123;lastName&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//// return Collection</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByLastNameLike</span><span class="params">(String str)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		List&lt;Employee&gt; result = em.getEmpsByLastNameLike(<span class="string">&quot;%a%&quot;</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line"></span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="27-æ˜ å°„æ–‡ä»¶-select-è®°å½•å°è£…map"><a href="#27-æ˜ å°„æ–‡ä»¶-select-è®°å½•å°è£…map" class="headerlink" title="27.æ˜ å°„æ–‡ä»¶-select-è®°å½•å°è£…map"></a>27.æ˜ å°„æ–‡ä»¶-select-è®°å½•å°è£…map</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¤šæ¡è®°å½•å°è£…ä¸€ä¸ªmapï¼šMap&lt;Integer,Employee&gt;:é”®æ˜¯è¿™æ¡è®°å½•çš„ä¸»é”®ï¼Œå€¼æ˜¯è®°å½•å°è£…åçš„javaBean</span></span><br><span class="line">	<span class="comment">//@MapKey:å‘Šè¯‰mybatiså°è£…è¿™ä¸ªmapçš„æ—¶å€™ä½¿ç”¨å“ªä¸ªå±æ€§ä½œä¸ºmapçš„key</span></span><br><span class="line">	<span class="meta">@MapKey(&quot;lastName&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, Employee&gt; <span class="title function_">getEmpByLastNameLikeReturnMap</span><span class="params">(String lastName)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è¿”å›ä¸€æ¡è®°å½•çš„mapï¼›keyå°±æ˜¯åˆ—åï¼Œå€¼å°±æ˜¯å¯¹åº”çš„å€¼</span></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getEmpByIdReturnMap</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="comment">&lt;!--public Map&lt;Integer, Employee&gt; getEmpByLastNameLikeReturnMap(String lastName);  --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByLastNameLikeReturnMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where last_name like #&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 	<span class="comment">&lt;!--public Map&lt;String, Object&gt; getEmpByIdReturnMap(Integer id);  --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdReturnMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id=#&#123;id&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">MapperTest</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		Map&lt;String, Object&gt; result = em.getEmpByIdReturnMap(<span class="number">1</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;---&quot;</span>);</span><br><span class="line">		Map&lt;String, Employee&gt; result2 = em.getEmpByLastNameLikeReturnMap(<span class="string">&quot;%a%&quot;</span>);</span><br><span class="line">		System.out.println(result2);</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="28-æ˜ å°„æ–‡ä»¶-select-resultMap-è‡ªå®šä¹‰ç»“æœæ˜ å°„è§„åˆ™"><a href="#28-æ˜ å°„æ–‡ä»¶-select-resultMap-è‡ªå®šä¹‰ç»“æœæ˜ å°„è§„åˆ™" class="headerlink" title="28.æ˜ å°„æ–‡ä»¶-select-resultMap-è‡ªå®šä¹‰ç»“æœæ˜ å°„è§„åˆ™"></a>28.æ˜ å°„æ–‡ä»¶-select-resultMap-è‡ªå®šä¹‰ç»“æœæ˜ å°„è§„åˆ™</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è‡ªå®šä¹‰ç»“æœæ˜ å°„è§„åˆ™</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdWithResultMap</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--è‡ªå®šä¹‰æŸä¸ªjavaBeançš„å°è£…è§„åˆ™</span></span><br><span class="line"><span class="comment">	typeï¼šè‡ªå®šä¹‰è§„åˆ™çš„Javaç±»å‹</span></span><br><span class="line"><span class="comment">	id:å”¯ä¸€idæ–¹ä¾¿å¼•ç”¨</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--æŒ‡å®šä¸»é”®åˆ—çš„å°è£…è§„åˆ™</span></span><br><span class="line"><span class="comment">		idå®šä¹‰ä¸»é”®ä¼šåº•å±‚æœ‰ä¼˜åŒ–ï¼›</span></span><br><span class="line"><span class="comment">		columnï¼šæŒ‡å®šå“ªä¸€åˆ—</span></span><br><span class="line"><span class="comment">		propertyï¼šæŒ‡å®šå¯¹åº”çš„javaBeanå±æ€§</span></span><br><span class="line"><span class="comment">		  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- å®šä¹‰æ™®é€šåˆ—å°è£…è§„åˆ™ --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- å…¶ä»–ä¸æŒ‡å®šçš„åˆ—ä¼šè‡ªåŠ¨å°è£…ï¼šæˆ‘ä»¬åªè¦å†™resultMapå°±æŠŠå…¨éƒ¨çš„æ˜ å°„è§„åˆ™éƒ½å†™ä¸Šã€‚ --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- resultMap:è‡ªå®šä¹‰ç»“æœé›†æ˜ å°„è§„åˆ™ï¼›  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Employee getEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdWithResultMap&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMap</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpByIdWithResultMap(<span class="number">1</span>));</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="29-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-ç¯å¢ƒæ­å»º"><a href="#29-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-ç¯å¢ƒæ­å»º" class="headerlink" title="29.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-ç¯å¢ƒæ­å»º"></a>29.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-ç¯å¢ƒæ­å»º</h2><p>æ–°å»ºç±»<a href="src/main/java/com/lun/c01/helloworld/bean/Department.java">Department.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String departmentName;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; emps;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//getter and setter and toString()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p>ä¿®æ”¹ç±»<a href="src/main/java/com/lun/c01/helloworld/bean/Employee.java">Employee.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">private</span> Department department;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//add department&#x27;s getter and setter</span></span><br></pre></td></tr></table></figure><hr><p>åˆ›å»ºæ•°æ®åº“è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> department(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	department_name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> department_id <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_employee_department </span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(department_id) <span class="keyword">REFERENCES</span> department(id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> department(department_name) <span class="keyword">values</span> (<span class="string">&#x27;å¼€å‘éƒ¨&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> department(department_name) <span class="keyword">values</span> (<span class="string">&#x27;æµ‹è¯•éƒ¨&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="30-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-çº§è”å±æ€§å°è£…ç»“æœ"><a href="#30-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-çº§è”å±æ€§å°è£…ç»“æœ" class="headerlink" title="30.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-çº§è”å±æ€§å°è£…ç»“æœ"></a>30.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-çº§è”å±æ€§å°è£…ç»“æœ</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è”åˆæŸ¥è¯¢ï¼šçº§è”å±æ€§å°è£…ç»“æœé›†</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpAndDept</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- è”åˆæŸ¥è¯¢ï¼šçº§è”å±æ€§å°è£…ç»“æœé›†</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDifEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;department.id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;department.departmentName&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  public Employee getEmpAndDept(Integer id);--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDifEmp&quot;</span>&gt;</span></span><br><span class="line">		SELECT</span><br><span class="line">			e.id id,e.last_name last_name,e.gender gender,</span><br><span class="line">			e.department_id department_id, d.department_name department_name </span><br><span class="line">		FROM employee e, department d</span><br><span class="line">		WHERE e.department_id=d.id AND e.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMapAssociation</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpAndDept(<span class="number">1</span>));</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="31-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationå®šä¹‰å…³è”å¯¹è±¡å°è£…è§„åˆ™"><a href="#31-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationå®šä¹‰å…³è”å¯¹è±¡å°è£…è§„åˆ™" class="headerlink" title="31.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationå®šä¹‰å…³è”å¯¹è±¡å°è£…è§„åˆ™"></a>31.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationå®šä¹‰å…³è”å¯¹è±¡å°è£…è§„åˆ™</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è”åˆæŸ¥è¯¢ï¼šçº§è”å±æ€§å°è£…ç»“æœé›†</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpAndDept2</span><span class="params">(Integer id)</span>;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><font>æ³¨æ„ï¼šä½¿ç”¨è¯¥æ–¹æ³•ä¸å†™çš„columnå’Œpropertyä¸ä¼šè‡ªåŠ¨å°è£…ï¼Œå› æ­¤å¿…é¡»å†™å…¨ï¼Œä¸èƒ½å·æ‡’ï¼</font></p><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  associationå¯ä»¥æŒ‡å®šè”åˆçš„javaBeanå¯¹è±¡ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDifEmp2&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--  associationå¯ä»¥æŒ‡å®šè”åˆçš„javaBeanå¯¹è±¡</span></span><br><span class="line"><span class="comment">		property=&quot;dept&quot;ï¼šæŒ‡å®šå“ªä¸ªå±æ€§æ˜¯è”åˆçš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">		javaType:æŒ‡å®šè¿™ä¸ªå±æ€§å¯¹è±¡çš„ç±»å‹[ä¸èƒ½çœç•¥]</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  public Employee getEmpAndDept2(Integer id);--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDifEmp2&quot;</span>&gt;</span></span><br><span class="line">		SELECT</span><br><span class="line">			e.id id,e.last_name last_name,e.gender gender,</span><br><span class="line">			e.department_id department_id, d.department_name department_name </span><br><span class="line">		FROM employee e, department d</span><br><span class="line">		WHERE e.department_id=d.id AND e.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMapAssociation2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpAndDept2(<span class="number">1</span>));</span><br><span class="line">		System.out.println(em.getEmpAndDept2(<span class="number">1</span>).getDepartment());</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="32-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationåˆ†æ­¥æŸ¥è¯¢"><a href="#32-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationåˆ†æ­¥æŸ¥è¯¢" class="headerlink" title="32.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationåˆ†æ­¥æŸ¥è¯¢"></a>32.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationåˆ†æ­¥æŸ¥è¯¢</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/DepartmentMapper.java">DepartmentMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Department <span class="title function_">getDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--public Department getDeptById(Integer id);  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span>&gt;</span></span><br><span class="line">		select id,department_name departmentName from department where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;c03/EmployeeMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;c03/DepartmentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//associationåˆ†æ­¥æŸ¥è¯¢</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdStep</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- associationåˆ†æ­¥æŸ¥è¯¢  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- ä½¿ç”¨associationè¿›è¡Œåˆ†æ­¥æŸ¥è¯¢ï¼š</span></span><br><span class="line"><span class="comment">		1ã€å…ˆæŒ‰ç…§å‘˜å·¥idæŸ¥è¯¢å‘˜å·¥ä¿¡æ¯</span></span><br><span class="line"><span class="comment">		2ã€æ ¹æ®æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯ä¸­çš„department_idå€¼å»éƒ¨é—¨è¡¨æŸ¥å‡ºéƒ¨é—¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">		3ã€éƒ¨é—¨è®¾ç½®åˆ°å‘˜å·¥ä¸­ï¼›</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--  id  last_name  email   gender    d_id   --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmpByStep&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- associationå®šä¹‰å…³è”å¯¹è±¡çš„å°è£…è§„åˆ™</span></span><br><span class="line"><span class="comment">	 		select:è¡¨æ˜å½“å‰å±æ€§æ˜¯è°ƒç”¨selectæŒ‡å®šçš„æ–¹æ³•æŸ¥å‡ºçš„ç»“æœ</span></span><br><span class="line"><span class="comment">	 		column:æŒ‡å®šå°†å“ªä¸€åˆ—çš„å€¼ä¼ ç»™è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="comment">	 		</span></span><br><span class="line"><span class="comment">	 		æµç¨‹ï¼šä½¿ç”¨selectæŒ‡å®šçš„æ–¹æ³•ï¼ˆä¼ å…¥columnæŒ‡å®šçš„è¿™åˆ—å‚æ•°çš„å€¼ï¼‰æŸ¥å‡ºå¯¹è±¡ï¼Œå¹¶å°è£…ç»™propertyæŒ‡å®šçš„å±æ€§</span></span><br><span class="line"><span class="comment">	 	 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> </span></span><br><span class="line"><span class="tag">	 		<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">	 		<span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--  public Employee getEmpByIdStep(Integer id);--&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyEmpByStep&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee where id=#&#123;id&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMapAssociation3</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpByIdStep(<span class="number">1</span>));</span><br><span class="line">		System.out.println(em.getEmpByIdStep(<span class="number">1</span>).getDepartment());</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="33-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-åˆ†æ­¥æŸ¥è¯¢-amp-å»¶è¿ŸåŠ è½½"><a href="#33-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-åˆ†æ­¥æŸ¥è¯¢-amp-å»¶è¿ŸåŠ è½½" class="headerlink" title="33.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-åˆ†æ­¥æŸ¥è¯¢&amp;å»¶è¿ŸåŠ è½½"></a>33.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-åˆ†æ­¥æŸ¥è¯¢&amp;å»¶è¿ŸåŠ è½½</h2><p>æˆ‘ä»¬æ¯æ¬¡æŸ¥è¯¢Employeeå¯¹è±¡çš„æ—¶å€™ï¼Œéƒ½å°†ä¸€èµ·æŸ¥è¯¢å‡ºæ¥ã€‚éƒ¨é—¨ä¿¡æ¯åœ¨æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™å†å»æŸ¥è¯¢ï¼›åˆ†æ®µæŸ¥è¯¢çš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šä¸¤ä¸ªé…ç½®ï¼š</p><p>åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œå®ç°<strong>æ‡’åŠ è½½</strong></p><p><a href="src/main/resources/c03/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">		<span class="comment">&lt;!--æ˜¾ç¤ºçš„æŒ‡å®šæ¯ä¸ªæˆ‘ä»¬éœ€è¦æ›´æ”¹çš„é…ç½®çš„å€¼ï¼Œå³ä½¿ä»–æ˜¯é»˜è®¤çš„ã€‚é˜²æ­¢ç‰ˆæœ¬æ›´æ–°å¸¦æ¥çš„é—®é¢˜  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>Setting</th><th>Description</th><th>Valid Values</th><th>Default</th></tr></thead><tbody><tr><td>lazyLoadingEnabled</td><td>Globally enables or disables lazy loading. When enabled, all relations will be lazily loaded. This value can be superseded for an specific relation by using the fetchType attribute on it.</td><td>true&#x2F;false</td><td>false</td></tr><tr><td>aggressiveLazyLoading</td><td>When enabled, an object with lazy loaded properties will be loaded entirely upon a call to any of the lazy properties. Otherwise, each property is loaded on demand.</td><td>true&#x2F;false</td><td>true</td></tr></tbody></table><blockquote><p>aggressive<br>è‹± [É™ËˆÉ¡resÉªv] ç¾ [É™ËˆÉ¡resÉªv]<br>adj.<br>å¥½æ–—çš„;æŒ‘è¡…çš„;ä¾µç•¥çš„;å¯Œäºæ”»å‡»æ€§çš„;æ°”åŠ¿æ±¹æ±¹çš„;å£°åŠ¿æµ©å¤§çš„;å¿—åœ¨å¿…å¾—çš„</p></blockquote><p>PS. ä¸ªäººè®¤ä¸ºaggressiveLazyLoading å¯é˜²æ­¢<strong>æ‡’åŠ è½½å¯¹è±¡é“¾</strong>æƒ…å†µå‡ºç°ã€‚TODO: å¾…éªŒè¯</p><h2 id="34-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionå®šä¹‰å…³è”é›†åˆå°è£…è§„åˆ™"><a href="#34-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionå®šä¹‰å…³è”é›†åˆå°è£…è§„åˆ™" class="headerlink" title="34.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionå®šä¹‰å…³è”é›†åˆå°è£…è§„åˆ™"></a>34.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionå®šä¹‰å…³è”é›†åˆå°è£…è§„åˆ™</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/DepartmentMapper.java">DepartmentMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Department <span class="title function_">getDeptByIdPlus</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	public class Department &#123;</span></span><br><span class="line"><span class="comment">			private Integer id;</span></span><br><span class="line"><span class="comment">			private String departmentName;</span></span><br><span class="line"><span class="comment">			private List&lt;Employee&gt; emps;</span></span><br><span class="line"><span class="comment">	  did  dept_name  ||  eid  last_name  email   gender  </span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="comment">&lt;!--åµŒå¥—ç»“æœé›†çš„æ–¹å¼ï¼Œä½¿ç”¨collectionæ ‡ç­¾å®šä¹‰å…³è”çš„é›†åˆç±»å‹çš„å±æ€§å°è£…è§„åˆ™  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDept&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			collectionå®šä¹‰å…³è”é›†åˆç±»å‹çš„å±æ€§çš„å°è£…è§„åˆ™ </span></span><br><span class="line"><span class="comment">			ofType:æŒ‡å®šé›†åˆé‡Œé¢å…ƒç´ çš„ç±»å‹</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- å®šä¹‰è¿™ä¸ªé›†åˆä¸­å…ƒç´ çš„å°è£…è§„åˆ™ --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Department getDeptByIdPlus(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdPlus&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDept&quot;</span>&gt;</span></span><br><span class="line">		SELECT d.id did,d.department_name department_name,</span><br><span class="line">				e.id eid,e.last_name last_name,</span><br><span class="line">				e.email email,e.gender gender</span><br><span class="line">		FROM department d LEFT JOIN employee e ON d.id=e.department_id</span><br><span class="line">		WHERE d.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/DepartmentMapperTest.java">DepartmentMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptByIdPlus</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm</span> <span class="operator">=</span> session.getMapper(DepartmentMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Department</span> <span class="variable">department</span> <span class="operator">=</span> dm.getDeptByIdPlus(<span class="number">1</span>);</span><br><span class="line">			</span><br><span class="line">			System.out.println(department);</span><br><span class="line">			System.out.println(department.getEmps());</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="35-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionåˆ†æ­¥æŸ¥è¯¢-amp-å»¶è¿ŸåŠ è½½"><a href="#35-æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionåˆ†æ­¥æŸ¥è¯¢-amp-å»¶è¿ŸåŠ è½½" class="headerlink" title="35.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionåˆ†æ­¥æŸ¥è¯¢&amp;å»¶è¿ŸåŠ è½½"></a>35.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionåˆ†æ­¥æŸ¥è¯¢&amp;å»¶è¿ŸåŠ è½½</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpsByDeptId</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--  public Employee getEmpsByDeptId(Integer departmentId);--&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByDeptId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee where department_id=#&#123;department_id&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/DepartmentMapper.java">DepartmentMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Department <span class="title function_">getDeptByIdStep</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- collectionï¼šåˆ†æ®µæŸ¥è¯¢ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper.getEmpsByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">		select id,department_name from department where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/DepartmentMapperTest.java">DepartmentMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptByIdStep</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm</span> <span class="operator">=</span> session.getMapper(DepartmentMapper.class);</span><br><span class="line">			<span class="type">Department</span> <span class="variable">department</span> <span class="operator">=</span> dm.getDeptByIdStep(<span class="number">1</span>);</span><br><span class="line">			</span><br><span class="line">			System.out.println(department);</span><br><span class="line">			System.out.println(department.getEmps());</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="36-æ˜ å°„æ–‡ä»¶-select-resultMap-åˆ†æ­¥æŸ¥è¯¢ä¼ é€’å¤šåˆ—å€¼-amp-fetchType"><a href="#36-æ˜ å°„æ–‡ä»¶-select-resultMap-åˆ†æ­¥æŸ¥è¯¢ä¼ é€’å¤šåˆ—å€¼-amp-fetchType" class="headerlink" title="36.æ˜ å°„æ–‡ä»¶-select-resultMap-åˆ†æ­¥æŸ¥è¯¢ä¼ é€’å¤šåˆ—å€¼&amp;fetchType"></a>36.æ˜ å°„æ–‡ä»¶-select-resultMap-åˆ†æ­¥æŸ¥è¯¢ä¼ é€’å¤šåˆ—å€¼&amp;fetchType</h2><p>æ‰©å±•ï¼š</p><ul><li>å¤šåˆ—çš„å€¼ä¼ é€’è¿‡å»ï¼š<ul><li>å°†å¤šåˆ—çš„å€¼å°è£…mapä¼ é€’ï¼›<code>column=&quot;&#123;key1=column1,key2=column2&#125;&quot;</code></li></ul></li><li>fetchType&#x3D;â€lazyâ€ï¼šè¡¨ç¤ºä½¿ç”¨å»¶è¿ŸåŠ è½½ï¼›<ul><li>lazyï¼šå»¶è¿Ÿ</li><li>eagerï¼šç«‹å³</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper.getEmpsByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">column</span>=<span class="string">&quot;&#123;deptId=id&#125;&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">	select id,department_name from department where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="37-æ˜ å°„æ–‡ä»¶-select-resultMap-discriminatoré‰´åˆ«å™¨"><a href="#37-æ˜ å°„æ–‡ä»¶-select-resultMap-discriminatoré‰´åˆ«å™¨" class="headerlink" title="37.æ˜ å°„æ–‡ä»¶-select-resultMap-discriminatoré‰´åˆ«å™¨"></a>37.æ˜ å°„æ–‡ä»¶-select-resultMap-discriminatoré‰´åˆ«å™¨</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//å¸¦æœ‰é‰´åˆ«å™¨çš„</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsWithDiscriminator</span><span class="params">()</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- =======================é‰´åˆ«å™¨============================ --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;discriminator javaType=&quot;&quot;&gt;&lt;/discriminator&gt;</span></span><br><span class="line"><span class="comment">		é‰´åˆ«å™¨ï¼šmybatiså¯ä»¥ä½¿ç”¨discriminatoråˆ¤æ–­æŸåˆ—çš„å€¼ï¼Œç„¶åæ ¹æ®æŸåˆ—çš„å€¼æ”¹å˜å°è£…è¡Œä¸º</span></span><br><span class="line"><span class="comment">		å°è£…Employeeï¼š</span></span><br><span class="line"><span class="comment">			å¦‚æœæŸ¥å‡ºçš„æ˜¯å¥³ç”Ÿï¼šå°±æŠŠéƒ¨é—¨ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ï¼Œå¦åˆ™ä¸æŸ¥è¯¢ï¼›</span></span><br><span class="line"><span class="comment">			å¦‚æœæ˜¯ç”·ç”Ÿï¼ŒæŠŠlast_nameè¿™ä¸€åˆ—çš„å€¼èµ‹å€¼ç»™email;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmpDis&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	 		columnï¼šæŒ‡å®šåˆ¤å®šçš„åˆ—å</span></span><br><span class="line"><span class="comment">	 		javaTypeï¼šåˆ—å€¼å¯¹åº”çš„javaç±»å‹  --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!--å¥³ç”Ÿ  resultType:æŒ‡å®šå°è£…çš„ç»“æœç±»å‹ï¼›ä¸èƒ½ç¼ºå°‘ã€‚/resultMap--&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> </span></span><br><span class="line"><span class="tag">			 		<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">			 		<span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;eager&quot;</span> &gt;</span></span><br><span class="line">		 		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!--ç”·ç”Ÿ ;å¦‚æœæ˜¯ç”·ç”Ÿï¼ŒæŠŠlast_nameè¿™ä¸€åˆ—çš„å€¼èµ‹å€¼ç»™email; --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		 		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">			 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">			 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">			 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--  public Employee getEmpByIdStep(Integer id);--&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsWithDiscriminator&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyEmpDis&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee limit 10</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsWithDiscriminator</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpsWithDiscriminator());</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="38-åŠ¨æ€sql-ç®€ä»‹-amp-ç¯å¢ƒæ­å»º"><a href="#38-åŠ¨æ€sql-ç®€ä»‹-amp-ç¯å¢ƒæ­å»º" class="headerlink" title="38.åŠ¨æ€sql-ç®€ä»‹&amp;ç¯å¢ƒæ­å»º"></a>38.åŠ¨æ€sql-ç®€ä»‹&amp;ç¯å¢ƒæ­å»º</h2><ul><li>åŠ¨æ€SQLæ˜¯MyBatiså¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ã€‚æå¤§çš„ç®€åŒ–æˆ‘ä»¬æ‹¼è£…SQLçš„æ“ä½œã€‚</li><li>åŠ¨æ€SQLå…ƒç´ å’Œä½¿ç”¨ JSTL æˆ–å…¶ä»–ç±»ä¼¼åŸºäº XML çš„æ–‡æœ¬å¤„ç†å™¨ç›¸ä¼¼ã€‚</li><li>MyBatisé‡‡ç”¨åŠŸèƒ½å¼ºå¤§çš„åŸºäº OGNL çš„è¡¨è¾¾å¼æ¥ç®€åŒ–æ“ä½œã€‚<ul><li>if</li><li>choose (when, otherwise)</li><li>trim (where, set)</li><li>foreach</li></ul></li></ul><h2 id="39-åŠ¨æ€sql-if-åˆ¤æ–­-amp-OGNL"><a href="#39-åŠ¨æ€sql-if-åˆ¤æ–­-amp-OGNL" class="headerlink" title="39.åŠ¨æ€sql-if-åˆ¤æ–­&amp;OGNL"></a>39.åŠ¨æ€sql-if-åˆ¤æ–­&amp;OGNL</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	<span class="comment">//æºå¸¦äº†å“ªä¸ªå­—æ®µæŸ¥è¯¢æ¡ä»¶å°±å¸¦ä¸Šè¿™ä¸ªå­—æ®µçš„å€¼</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionIf</span><span class="params">(Employee employee)</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- æŸ¥è¯¢å‘˜å·¥ï¼Œè¦æ±‚ï¼Œæºå¸¦äº†å“ªä¸ªå­—æ®µæŸ¥è¯¢æ¡ä»¶å°±å¸¦ä¸Šè¿™ä¸ªå­—æ®µçš„å€¼ --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionIf(Employee employee); --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee where</span><br><span class="line">	 	<span class="comment">&lt;!-- testï¼šåˆ¤æ–­è¡¨è¾¾å¼ï¼ˆOGNLï¼‰</span></span><br><span class="line"><span class="comment">	 	OGNLå‚ç…§PPTæˆ–è€…å®˜æ–¹æ–‡æ¡£ã€‚</span></span><br><span class="line"><span class="comment">	 	  	 c:if  test</span></span><br><span class="line"><span class="comment">	 	ä»å‚æ•°ä¸­å–å€¼è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line"><span class="comment">	 	</span></span><br><span class="line"><span class="comment">	 	é‡è§ç‰¹æ®Šç¬¦å·åº”è¯¥å»å†™è½¬ä¹‰å­—ç¬¦ï¼š</span></span><br><span class="line"><span class="comment">	 	&amp;&amp;ï¼š</span></span><br><span class="line"><span class="comment">	 	--&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">	 		id=#&#123;id&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">	 		and last_name like #&#123;lastName&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">	 		and email=#&#123;email&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">	 	<span class="comment">&lt;!-- ognlä¼šè¿›è¡Œå­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢åˆ¤æ–­  &quot;0&quot;==0 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">	 	 	and gender=#&#123;gender&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionIf</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionIf(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="OGNL"><a href="#OGNL" class="headerlink" title="OGNL"></a>OGNL</h3><p><a target="_blank" rel="noopener" href="http://commons.apache.org/proper/commons-ognl/language-guide.html">OGNLå®˜æ–¹æ–‡æ¡£</a></p><p>OGNLï¼ˆ Object Graph Navigation Language ï¼‰å¯¹è±¡å›¾å¯¼èˆªè¯­è¨€ï¼Œ è¿™æ˜¯ä¸€ç§å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œé€šè¿‡å®ƒå¯ä»¥éå¸¸æ–¹ä¾¿çš„æ¥æ“ä½œå¯¹è±¡å±æ€§ã€‚ ç±»ä¼¼äºæˆ‘ä»¬çš„ELï¼Œ SpELç­‰ã€‚</p><ul><li>è®¿é—®å¯¹è±¡å±æ€§ï¼š person.name</li><li>è°ƒç”¨æ–¹æ³•ï¼š person.getName()</li><li>è°ƒç”¨é™æ€å±æ€§&#x2F;æ–¹æ³•ï¼š @java.lang.Math@PIã€@java.util.UUID@randomUUID()</li><li>è°ƒç”¨æ„é€ æ–¹æ³•ï¼š new com.lun.Person(â€˜adminâ€™).name</li><li>è¿ç®—ç¬¦ï¼š +, -*, &#x2F;, %</li><li>é€»è¾‘è¿ç®—ç¬¦ï¼š in, not in, &gt;, &gt;&#x3D;, &lt;, &lt;&#x3D;, &#x3D;&#x3D;, !&#x3D;</li></ul><p><strong>æ³¨æ„</strong>ï¼š xmlä¸­ç‰¹æ®Šç¬¦å·å¦‚â€,&gt;,&lt;ç­‰è¿™äº›éƒ½éœ€è¦ä½¿ç”¨è½¬ä¹‰å­—ç¬¦</p><p>è®¿é—®é›†åˆä¼ªå±æ€§ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>ä¼ªå±æ€§</th><th>ä¼ªå±æ€§å¯¹åº”çš„ Java æ–¹æ³•</th></tr></thead><tbody><tr><td>Listã€ Setã€ Map</td><td>sizeã€ isEmpty</td><td>List&#x2F;Set&#x2F;Map.size(),List&#x2F;Set&#x2F;Map.isEmpty()</td></tr><tr><td>Listã€ Set</td><td>iterator</td><td>List.iterator()ã€ Set.iterator()</td></tr><tr><td>Map</td><td>keysã€ values</td><td>Map.keySet()ã€ Map.values()</td></tr><tr><td>Iterator</td><td>nextã€ hasNext</td><td>Iterator.next()ã€ Iterator.hasNext()</td></tr></tbody></table><h2 id="40-åŠ¨æ€sql-where-æŸ¥è¯¢æ¡ä»¶"><a href="#40-åŠ¨æ€sql-where-æŸ¥è¯¢æ¡ä»¶" class="headerlink" title="40.åŠ¨æ€sql-where-æŸ¥è¯¢æ¡ä»¶"></a>40.åŠ¨æ€sql-where-æŸ¥è¯¢æ¡ä»¶</h2><p>æŸ¥è¯¢çš„æ—¶å€™å¦‚æœæŸäº›æ¡ä»¶æ²¡å¸¦å¯èƒ½sqlæ‹¼è£…ä¼šæœ‰é—®é¢˜</p><ol><li>ç»™whereåé¢åŠ ä¸Š1&#x3D;1ï¼Œä»¥åçš„æ¡ä»¶éƒ½and xxxã€‚</li><li>mybatisä½¿ç”¨whereæ ‡ç­¾æ¥å°†æ‰€æœ‰çš„æŸ¥è¯¢æ¡ä»¶åŒ…æ‹¬åœ¨å†…ã€‚mybatiså°±ä¼šå°†whereæ ‡ç­¾ä¸­æ‹¼è£…çš„sqlï¼Œå¤šå‡ºæ¥çš„andæˆ–è€…orå»æ‰ï¼ˆwhereåªä¼šå»æ‰ç¬¬ä¸€ä¸ªå¤šå‡ºæ¥çš„andæˆ–è€…orï¼Œ<strong>ä½†æœ€åä¸€ä¸ªå¤šå‡ºæ¥çš„andæˆ–è€…oråˆ™ä¸ä¼šå»æ‰</strong>ï¼‰ã€‚</li></ol><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionIfWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee</span><br><span class="line">	 	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">		 		id=#&#123;id&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		and last_name like #&#123;lastName&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		and email=#&#123;email&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">		 	<span class="comment">&lt;!-- ognlä¼šè¿›è¡Œå­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢åˆ¤æ–­  &quot;0&quot;==0 --&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">		 	 	and gender=#&#123;gender&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionIfWithWhere</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionIfWithWhere</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="literal">null</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionIfWithWhere(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="41-åŠ¨æ€sql-trim-è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆªå–"><a href="#41-åŠ¨æ€sql-trim-è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆªå–" class="headerlink" title="41.åŠ¨æ€sql-trim-è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆªå–"></a>41.åŠ¨æ€sql-trim-è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆªå–</h2><p>åé¢å¤šå‡ºçš„andæˆ–è€…or whereæ ‡ç­¾ä¸èƒ½è§£å†³</p><ul><li>prefix&#x3D;â€â€:å‰ç¼€ï¼štrimæ ‡ç­¾ä½“ä¸­æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²æ‹¼ä¸²åçš„ç»“æœã€‚<ul><li>prefixç»™æ‹¼ä¸²åçš„æ•´ä¸ªå­—ç¬¦ä¸²åŠ ä¸€ä¸ªå‰ç¼€</li></ul></li><li>prefixOverrides&#x3D;â€â€:<ul><li>å‰ç¼€è¦†ç›–ï¼š å»æ‰æ•´ä¸ªå­—ç¬¦ä¸²å‰é¢å¤šä½™çš„å­—ç¬¦</li></ul></li><li>suffix&#x3D;â€â€:åç¼€<ul><li>suffixç»™æ‹¼ä¸²åçš„æ•´ä¸ªå­—ç¬¦ä¸²åŠ ä¸€ä¸ªåç¼€</li></ul></li><li>suffixOverrides&#x3D;â€â€<ul><li>åç¼€è¦†ç›–ï¼šå»æ‰æ•´ä¸ªå­—ç¬¦ä¸²åé¢å¤šä½™çš„å­—ç¬¦</li></ul></li></ul><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionTrim</span><span class="params">(Employee employee)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsByConditionTrim(Employee employee);  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionTrim&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee</span><br><span class="line">	 	<span class="comment">&lt;!-- è‡ªå®šä¹‰å­—ç¬¦ä¸²çš„æˆªå–è§„åˆ™ --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">		 		id=#&#123;id&#125; and</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		last_name like #&#123;lastName&#125; and</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		email=#&#123;email&#125; and</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">		 	<span class="comment">&lt;!-- ognlä¼šè¿›è¡Œå­—ç¬¦ä¸²ä¸æ•°å­—çš„è½¬æ¢åˆ¤æ–­  &quot;0&quot;==0 --&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">		 	 	gender=#&#123;gender&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionTrim</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionTrim(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="42-åŠ¨æ€sql-choose-åˆ†æ”¯é€‰æ‹©"><a href="#42-åŠ¨æ€sql-choose-åˆ†æ”¯é€‰æ‹©" class="headerlink" title="42.åŠ¨æ€sql-choose-åˆ†æ”¯é€‰æ‹©"></a>42.åŠ¨æ€sql-choose-åˆ†æ”¯é€‰æ‹©</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionChoose</span><span class="params">(Employee employee)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionChoose(Employee employee); --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee </span><br><span class="line">	 	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- å¦‚æœå¸¦äº†idå°±ç”¨idæŸ¥ï¼Œå¦‚æœå¸¦äº†lastNameå°±ç”¨lastNameæŸ¥;åªä¼šè¿›å…¥å…¶ä¸­ä¸€ä¸ª --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">	 				id=#&#123;id&#125;</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null&quot;</span>&gt;</span></span><br><span class="line">	 				last_name like #&#123;lastName&#125;</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span></span><br><span class="line">	 				email = #&#123;email&#125;</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">	 				gender = 0</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionChoose</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionChoose(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="43-åŠ¨æ€sql-set-ä¸ifç»“åˆçš„åŠ¨æ€æ›´æ–°"><a href="#43-åŠ¨æ€sql-set-ä¸ifç»“åˆçš„åŠ¨æ€æ›´æ–°" class="headerlink" title="43.åŠ¨æ€sql-set-ä¸ifç»“åˆçš„åŠ¨æ€æ›´æ–°"></a>43.åŠ¨æ€sql-set-ä¸ifç»“åˆçš„åŠ¨æ€æ›´æ–°</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateEmp</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--public void updateEmp(Employee employee);  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmp&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- Setæ ‡ç­¾çš„ä½¿ç”¨ --&gt;</span></span><br><span class="line">	 	update employee </span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null&quot;</span>&gt;</span></span><br><span class="line">				last_name=#&#123;lastName&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span></span><br><span class="line">				email=#&#123;email&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender!=null&quot;</span>&gt;</span></span><br><span class="line">				gender=#&#123;gender&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">		where id=#&#123;id&#125; </span><br><span class="line">	<span class="comment">&lt;!-- 		</span></span><br><span class="line"><span class="comment">		Trimï¼šæ›´æ–°æ‹¼ä¸²</span></span><br><span class="line"><span class="comment">		update tbl_employee </span></span><br><span class="line"><span class="comment">		&lt;trim prefix=&quot;set&quot; suffixOverrides=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="comment">			&lt;if test=&quot;lastName!=null&quot;&gt;</span></span><br><span class="line"><span class="comment">				last_name=#&#123;lastName&#125;,</span></span><br><span class="line"><span class="comment">			&lt;/if&gt;</span></span><br><span class="line"><span class="comment">			&lt;if test=&quot;email!=null&quot;&gt;</span></span><br><span class="line"><span class="comment">				email=#&#123;email&#125;,</span></span><br><span class="line"><span class="comment">			&lt;/if&gt;</span></span><br><span class="line"><span class="comment">			&lt;if test=&quot;gender!=null&quot;&gt;</span></span><br><span class="line"><span class="comment">				gender=#&#123;gender&#125;</span></span><br><span class="line"><span class="comment">			&lt;/if&gt;</span></span><br><span class="line"><span class="comment">		&lt;/trim&gt;</span></span><br><span class="line"><span class="comment">		where id=#&#123;id&#125;  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateEmp</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen2&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			dsm.updateEmp(employee);</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="44-åŠ¨æ€sql-foreach-éå†é›†åˆ"><a href="#44-åŠ¨æ€sql-foreach-éå†é›†åˆ" class="headerlink" title="44.åŠ¨æ€sql-foreach-éå†é›†åˆ"></a>44.åŠ¨æ€sql-foreach-éå†é›†åˆ</h2><ul><li><p>collectionï¼šæŒ‡å®šè¦éå†çš„é›†åˆï¼š</p><ul><li>listç±»å‹çš„å‚æ•°ä¼šç‰¹æ®Šå¤„ç†å°è£…åœ¨mapä¸­ï¼Œmapçš„keyå°±å«list</li></ul></li><li><p>itemï¼šå°†å½“å‰éå†å‡ºçš„å…ƒç´ èµ‹å€¼ç»™æŒ‡å®šçš„å˜é‡</p></li><li><p>separator:æ¯ä¸ªå…ƒç´ ä¹‹é—´çš„åˆ†éš”ç¬¦</p></li><li><p>openï¼šéå†å‡ºæ‰€æœ‰ç»“æœæ‹¼æ¥ä¸€ä¸ªå¼€å§‹çš„å­—ç¬¦</p></li><li><p>close:éå†å‡ºæ‰€æœ‰ç»“æœæ‹¼æ¥ä¸€ä¸ªç»“æŸçš„å­—ç¬¦</p></li><li><p>index:ç´¢å¼•ã€‚éå†listçš„æ—¶å€™æ˜¯indexå°±æ˜¯ç´¢å¼•ï¼Œitemå°±æ˜¯å½“å‰å€¼</p><ul><li>éå†mapçš„æ—¶å€™indexè¡¨ç¤ºçš„å°±æ˜¯mapçš„keyï¼Œitemå°±æ˜¯mapçš„å€¼</li></ul></li><li><p><code>#&#123;å˜é‡å&#125;</code>å°±èƒ½å–å‡ºå˜é‡çš„å€¼ä¹Ÿå°±æ˜¯å½“å‰éå†å‡ºçš„å…ƒç´ </p></li></ul><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionForeach</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span>List&lt;Integer&gt; ids)</span>;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">	 &lt;!--<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionForeach</span><span class="params">(List&lt;Integer&gt; ids)</span>;  --&gt;</span><br><span class="line">	 &lt;select id=<span class="string">&quot;getEmpsByConditionForeach&quot;</span> resultType=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span><br><span class="line">	 	select * from employee</span><br><span class="line">	 	&lt;foreach collection=<span class="string">&quot;ids&quot;</span> item=<span class="string">&quot;item_id&quot;</span> separator=<span class="string">&quot;,&quot;</span></span><br><span class="line">	 		open=<span class="string">&quot;where id in(&quot;</span> close=<span class="string">&quot;)&quot;</span>&gt;</span><br><span class="line">	 		#&#123;item_id&#125;</span><br><span class="line">	 	&lt;/foreach&gt;</span><br><span class="line">	 &lt;/select&gt;</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionForeach</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionForeach(Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="45-åŠ¨æ€sql-foreach-mysqlä¸‹foreachæ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼"><a href="#45-åŠ¨æ€sql-foreach-mysqlä¸‹foreachæ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="45.åŠ¨æ€sql-foreach-mysqlä¸‹foreachæ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼"></a>45.åŠ¨æ€sql-foreach-mysqlä¸‹foreachæ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEmps</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span>List&lt;Employee&gt; emps)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEmps2</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span>List&lt;Employee&gt; emps)</span>;</span><br><span class="line">	</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!-- æ‰¹é‡ä¿å­˜ --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--public void addEmps(@Param(&quot;emps&quot;)List&lt;Employee&gt; emps);  --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--MySQLä¸‹æ‰¹é‡ä¿å­˜ï¼šå¯ä»¥foreachéå†   mysqlæ”¯æŒvalues(),(),()è¯­æ³•--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span>&gt;</span></span><br><span class="line">	 	insert into employee(last_name,email,gender,department_id) </span><br><span class="line">		values</span><br><span class="line">		<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">			(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.department.id&#125;)</span><br><span class="line">		<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span><span class="comment">&lt;!--   --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- è¿™ç§æ–¹å¼éœ€è¦æ•°æ®åº“è¿æ¥å±æ€§allowMultiQueries=trueï¼›</span></span><br><span class="line"><span class="comment">	 	è¿™ç§åˆ†å·åˆ†éš”å¤šä¸ªsqlå¯ä»¥ç”¨äºå…¶ä»–çš„æ‰¹é‡æ“ä½œï¼ˆåˆ é™¤ï¼Œä¿®æ”¹ï¼‰ --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps2&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span></span><br><span class="line">	 		insert into employee(last_name,email,gender,department_id)</span><br><span class="line">	 		values(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.department.id&#125;)</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼ŒMySQLæ•°æ®åº“è¿æ¥å±æ€§allowMultiQueries&#x3D;trueï¼Œæ‰èƒ½æ‰¹é‡åˆ é™¤ï¼Œä¿®æ”¹æ•°æ®ã€‚ï¼ˆåœ¨è¿æ¥MySQLçš„URLåæ·»åŠ å‚æ•°ï¼‰ã€‚</p><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class DynamicSQLMapperTest &#123;</span><br><span class="line">	</span><br><span class="line">	@Test</span><br><span class="line">	public void testAddEmps2() throws IOException &#123;</span><br><span class="line">		SqlSessionFactory ssf = Tools.getSqlSessionFactory(&quot;c04/mybatis-config.xml&quot;);</span><br><span class="line">		SqlSession session = ssf.openSession();</span><br><span class="line">		try &#123;</span><br><span class="line">			DynamicSQLMapper dsm = session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			</span><br><span class="line">			dsm.addEmps2(Arrays.asList(new Employee(null, &quot;abc&quot;, null, null),</span><br><span class="line">					new Employee(null, &quot;cba&quot;,null, null)));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Test</span><br><span class="line">	public void testAddEmps() throws IOException &#123;</span><br><span class="line">		SqlSessionFactory ssf = Tools.getSqlSessionFactory(&quot;c04/mybatis-config.xml&quot;);</span><br><span class="line">		SqlSession session = ssf.openSession();</span><br><span class="line">		try &#123;</span><br><span class="line">			DynamicSQLMapper dsm = session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			dsm.addEmps(Arrays.asList(new Employee(null, &quot;abc&quot;, null, null),</span><br><span class="line">					new Employee(null, &quot;cba&quot;,null, null)));</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="46-åŠ¨æ€sql-foreach-oracleä¸‹æ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼"><a href="#46-åŠ¨æ€sql-foreach-oracleä¸‹æ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="46.åŠ¨æ€sql-foreach-oracleä¸‹æ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼"></a>46.åŠ¨æ€sql-foreach-oracleä¸‹æ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼</h2><p>Oracleæ•°æ®åº“æ‰¹é‡ä¿å­˜ï¼š</p><ul><li>Oracleä¸æ”¯æŒvalues(),(),()</li></ul><p>Oracleæ”¯æŒçš„æ‰¹é‡æ–¹å¼:</p><ol><li>å¤šä¸ªinsertæ”¾åœ¨begin - endé‡Œé¢</li><li>åˆ©ç”¨ä¸­é—´è¡¨</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># å¤šä¸ª<span class="keyword">insert</span>æ”¾åœ¨<span class="keyword">begin</span> <span class="operator">-</span> <span class="keyword">end</span>é‡Œé¢</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> employees(employee_id,last_name,email) </span><br><span class="line">    <span class="keyword">values</span>(employees_seq.nextval,<span class="string">&#x27;test_001&#x27;</span>,<span class="string">&#x27;test_001@atguigu.com&#x27;</span>);</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> employees(employee_id,last_name,email) </span><br><span class="line">    <span class="keyword">values</span>(employees_seq.nextval,<span class="string">&#x27;test_002&#x27;</span>,<span class="string">&#x27;test_002@atguigu.com&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"># åˆ©ç”¨ä¸­é—´è¡¨</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees(employee_id,last_name,email)</span><br><span class="line">   <span class="keyword">select</span> employees_seq.nextval,lastName,email <span class="keyword">from</span>(</span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;test_a_01&#x27;</span> lastName,<span class="string">&#x27;test_a_e01&#x27;</span> email <span class="keyword">from</span> dual</span><br><span class="line">          <span class="keyword">union</span></span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;test_a_02&#x27;</span> lastName,<span class="string">&#x27;test_a_e02&#x27;</span> email <span class="keyword">from</span> dual</span><br><span class="line">          <span class="keyword">union</span></span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;test_a_03&#x27;</span> lastName,<span class="string">&#x27;test_a_e03&#x27;</span> email <span class="keyword">from</span> dual</span><br><span class="line">   );</span><br></pre></td></tr></table></figure><h2 id="47-åŠ¨æ€sql-foreach-oracleä¸‹foreachæ‰¹é‡ä¿å­˜ä¸¤ç§æ–¹å¼"><a href="#47-åŠ¨æ€sql-foreach-oracleä¸‹foreachæ‰¹é‡ä¿å­˜ä¸¤ç§æ–¹å¼" class="headerlink" title="47.åŠ¨æ€sql-foreach-oracleä¸‹foreachæ‰¹é‡ä¿å­˜ä¸¤ç§æ–¹å¼"></a>47.åŠ¨æ€sql-foreach-oracleä¸‹foreachæ‰¹é‡ä¿å­˜ä¸¤ç§æ–¹å¼</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- oracleç¬¬ä¸€ç§æ‰¹é‡æ–¹å¼ --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;foreach collection=&quot;emps&quot; item=&quot;emp&quot; open=&quot;begin&quot; close=&quot;end;&quot;&gt;</span></span><br><span class="line"><span class="comment">		insert into employees(employee_id,last_name,email) </span></span><br><span class="line"><span class="comment">	    values(employees_seq.nextval,#&#123;emp.lastName&#125;,#&#123;emp.email&#125;);</span></span><br><span class="line"><span class="comment">	&lt;/foreach&gt; </span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- oracleç¬¬äºŒç§æ‰¹é‡æ–¹å¼  --&gt;</span></span><br><span class="line">	insert into employees(employee_id,last_name,email)</span><br><span class="line">	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;union&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">open</span>=<span class="string">&quot;select employees_seq.nextval,lastName,email from(&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">		select #&#123;emp.lastName&#125; lastName,#&#123;emp.email&#125; email from dual</span><br><span class="line">	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="48-åŠ¨æ€sql-å†…ç½®å‚æ•°-parameter-amp-databaseId"><a href="#48-åŠ¨æ€sql-å†…ç½®å‚æ•°-parameter-amp-databaseId" class="headerlink" title="48.åŠ¨æ€sql-å†…ç½®å‚æ•° _parameter &amp; _databaseId"></a>48.åŠ¨æ€sql-å†…ç½®å‚æ•° _parameter &amp; _databaseId</h2><p>ä¸åªæ˜¯æ–¹æ³•ä¼ é€’è¿‡æ¥çš„å‚æ•°å¯ä»¥è¢«ç”¨æ¥åˆ¤æ–­ï¼Œ</p><p>mybatisé»˜è®¤è¿˜æœ‰<strong>ä¸¤ä¸ªå†…ç½®å‚æ•°</strong>ï¼š</p><ol><li><strong>_parameter</strong>:ä»£è¡¨æ•´ä¸ªå‚æ•°<ul><li>å•ä¸ªå‚æ•°ï¼š_parameterå°±æ˜¯è¿™ä¸ªå‚æ•°</li><li>å¤šä¸ªå‚æ•°ï¼šå‚æ•°ä¼šè¢«å°è£…ä¸ºä¸€ä¸ªmapï¼›_parameterå°±æ˜¯ä»£è¡¨è¿™ä¸ªmap</li></ul></li><li><strong>_databaseId</strong>:å¦‚æœé…ç½®äº†databaseIdProvideræ ‡ç­¾ã€‚<ul><li>_databaseIdå°±æ˜¯ä»£è¡¨å½“å‰æ•°æ®åº“çš„åˆ«åoracle</li></ul></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee);  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsTestInnerParameter&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">		select * from tbl_employee</span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">			where last_name like #&#123;_parameter.lastName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span></span><br><span class="line">		select * from employees</span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">			where last_name like #&#123;_parameter.lastName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="49-åŠ¨æ€sql-bind-ç»‘å®šï¼ˆä¸å¸¸ç”¨ï¼‰"><a href="#49-åŠ¨æ€sql-bind-ç»‘å®šï¼ˆä¸å¸¸ç”¨ï¼‰" class="headerlink" title="49.åŠ¨æ€sql-bind-ç»‘å®šï¼ˆä¸å¸¸ç”¨ï¼‰"></a>49.åŠ¨æ€sql-bind-ç»‘å®šï¼ˆä¸å¸¸ç”¨ï¼‰</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee);  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsTestInnerParameter&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- bindï¼šå¯ä»¥å°†OGNLè¡¨è¾¾å¼çš„å€¼ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡ä¸­ï¼Œæ–¹ä¾¿åæ¥å¼•ç”¨è¿™ä¸ªå˜é‡çš„å€¼ --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+lastName+&#x27;%&#x27;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">			select * from tbl_employee</span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">				where last_name like #&#123;lastName&#125;<span class="comment">&lt;!-- è¿™é‡Œä½¿ç”¨åˆ°lastName --&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span></span><br><span class="line">			select * from employees</span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">				where last_name like #&#123;_parameter.lastName&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="50-åŠ¨æ€sql-sql-æŠ½å–å¯é‡ç”¨çš„sqlç‰‡æ®µ"><a href="#50-åŠ¨æ€sql-sql-æŠ½å–å¯é‡ç”¨çš„sqlç‰‡æ®µ" class="headerlink" title="50.åŠ¨æ€sql-sql-æŠ½å–å¯é‡ç”¨çš„sqlç‰‡æ®µ"></a>50.åŠ¨æ€sql-sql-æŠ½å–å¯é‡ç”¨çš„sqlç‰‡æ®µ</h2><p>æŠ½å–å¯é‡ç”¨çš„sqlç‰‡æ®µã€‚æ–¹ä¾¿åé¢å¼•ç”¨ï¼š</p><ol><li>sqlæŠ½å–ï¼šç»å¸¸å°†è¦æŸ¥è¯¢çš„åˆ—åï¼Œæˆ–è€…æ’å…¥ç”¨çš„åˆ—åæŠ½å–å‡ºæ¥æ–¹ä¾¿å¼•ç”¨</li><li>includeæ¥å¼•ç”¨å·²ç»æŠ½å–çš„sqlï¼š</li><li>includeè¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›propertyï¼Œsqlæ ‡ç­¾å†…éƒ¨å°±èƒ½ä½¿ç”¨è‡ªå®šä¹‰çš„å±æ€§<ul><li>include-propertyï¼šå–å€¼çš„æ­£ç¡®æ–¹å¼${prop},</li><li>ä¸èƒ½ä½¿ç”¨<code>#&#123;&#125;</code>ï¼Œè€Œä½¿ç”¨<code>$&#123;&#125;</code></li></ul></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">sql</span> id<span class="operator">=</span>&quot;userColumns&quot;<span class="operator">&gt;</span> $&#123;alias&#125;.id,$&#123;alias&#125;.username,$&#123;alias&#125;.password <span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectUsers&quot; resultType<span class="operator">=</span>&quot;map&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		<span class="operator">&lt;</span>include refid<span class="operator">=</span>&quot;userColumns&quot;<span class="operator">&gt;</span><span class="operator">&lt;</span>property name<span class="operator">=</span>&quot;alias&quot; <span class="keyword">value</span><span class="operator">=</span>&quot;t1&quot;<span class="operator">/</span><span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>include<span class="operator">&gt;</span>,</span><br><span class="line">		<span class="operator">&lt;</span>include refid<span class="operator">=</span>&quot;userColumns&quot;<span class="operator">&gt;</span><span class="operator">&lt;</span>property name<span class="operator">=</span>&quot;alias&quot; <span class="keyword">value</span><span class="operator">=</span>&quot;t2&quot;<span class="operator">/</span><span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>include<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">from</span> some_table t1</span><br><span class="line">		<span class="keyword">cross</span> <span class="keyword">join</span> some_table t2</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">sql</span> id<span class="operator">=</span>&quot;insertColumn&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;_databaseId==&#x27;oracle&#x27;&quot;<span class="operator">&gt;</span></span><br><span class="line">		employee_id,last_name,email</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;_databaseId==&#x27;mysql&#x27;&quot;<span class="operator">&gt;</span></span><br><span class="line">		last_name,email,gender,d_id</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;addEmps&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> tbl_employee(</span><br><span class="line">		<span class="operator">&lt;</span>include refid<span class="operator">=</span>&quot;insertColumn&quot;<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>include<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">!</span><span class="comment">-- ä½¿ç”¨åœ°æ–¹ --&gt;</span></span><br><span class="line">	) </span><br><span class="line">	<span class="keyword">values</span></span><br><span class="line">	<span class="operator">&lt;</span>foreach collection<span class="operator">=</span>&quot;emps&quot; item<span class="operator">=</span>&quot;emp&quot; separator<span class="operator">=</span>&quot;,&quot;<span class="operator">&gt;</span></span><br><span class="line">		(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>foreach<span class="operator">&gt;</span></span><br><span class="line"> <span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="51-ç¼“å­˜-ç¼“å­˜ä»‹ç»"><a href="#51-ç¼“å­˜-ç¼“å­˜ä»‹ç»" class="headerlink" title="51.ç¼“å­˜-ç¼“å­˜ä»‹ç»"></a>51.ç¼“å­˜-ç¼“å­˜ä»‹ç»</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#cache">MyBatiså®˜æ–¹æ–‡æ¡£</a></p><p>MyBatis åŒ…å«ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æŸ¥è¯¢ç¼“å­˜ç‰¹æ€§ï¼Œå®ƒå¯ä»¥éå¸¸æ–¹ä¾¿åœ°é…ç½®å’Œå®šåˆ¶ã€‚ç¼“å­˜å¯ä»¥æå¤§çš„æå‡æŸ¥è¯¢æ•ˆç‡ã€‚</p><p>MyBatisç³»ç»Ÿä¸­é»˜è®¤å®šä¹‰äº†ä¸¤çº§ç¼“å­˜ï¼Œä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚</p><ol><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€çº§ç¼“å­˜ï¼ˆ SqlSessionçº§åˆ«çš„ç¼“å­˜ï¼Œä¹Ÿç§°ä¸ºæœ¬åœ°ç¼“å­˜ï¼‰å¼€å¯ã€‚</li><li>äºŒçº§ç¼“å­˜éœ€è¦æ‰‹åŠ¨å¼€å¯å’Œé…ç½®ï¼Œä»–æ˜¯åŸºäºnamespaceçº§åˆ«çš„ç¼“å­˜ã€‚</li><li>ä¸ºäº†æé«˜æ‰©å±•æ€§ã€‚ MyBatiså®šä¹‰äº†ç¼“å­˜æ¥å£Cacheã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°Cacheæ¥å£æ¥è‡ªå®šä¹‰äºŒçº§ç¼“å­˜</li></ol><h2 id="52-ç¼“å­˜-ä¸€çº§ç¼“å­˜ä½“éªŒ"><a href="#52-ç¼“å­˜-ä¸€çº§ç¼“å­˜ä½“éªŒ" class="headerlink" title="52.ç¼“å­˜-ä¸€çº§ç¼“å­˜ä½“éªŒ"></a>52.ç¼“å­˜-ä¸€çº§ç¼“å­˜ä½“éªŒ</h2><h3 id="ä¸€çº§ç¼“å­˜"><a href="#ä¸€çº§ç¼“å­˜" class="headerlink" title="ä¸€çº§ç¼“å­˜"></a>ä¸€çº§ç¼“å­˜</h3><ul><li>ä¸€çº§ç¼“å­˜(local cache)ï¼Œå³æœ¬åœ°ç¼“å­˜ï¼Œä½œç”¨åŸŸé»˜è®¤ä¸ºsqlSessionã€‚å½“ Session flush æˆ– close å, è¯¥Session ä¸­çš„æ‰€æœ‰ Cache å°†è¢«æ¸…ç©ºã€‚</li><li>æœ¬åœ°ç¼“å­˜ä¸èƒ½è¢«å…³é—­, ä½†å¯ä»¥è°ƒç”¨ clearCache() æ¥æ¸…ç©ºæœ¬åœ°ç¼“å­˜, æˆ–è€…æ”¹å˜ç¼“å­˜çš„ä½œç”¨åŸŸ.</li><li>åœ¨mybatis3.1ä¹‹å, å¯ä»¥é…ç½®æœ¬åœ°ç¼“å­˜çš„ä½œç”¨åŸŸ. åœ¨ mybatis.xml ä¸­é…ç½®</li></ul><table><thead><tr><th>-</th><th>-</th><th>-</th><th>-</th></tr></thead><tbody><tr><td>localCacheScope</td><td>MyBatis uses local cache to prevent circular references and speed up repeated nested queries. By default (SESSION) all queries executed during a session are cached. If localCacheScope&#x3D;STATEMENT local session will be used just for statement execution, no data will be shared between two different calls to the same SqlSession.</td><td>SESSION&#x2F;STATEMENT</td><td>SESSION</td></tr></tbody></table><h3 id="ä¸€çº§ç¼“å­˜ä½“éªŒ"><a href="#ä¸€çº§ç¼“å­˜ä½“éªŒ" class="headerlink" title="ä¸€çº§ç¼“å­˜ä½“éªŒ"></a>ä¸€çº§ç¼“å­˜ä½“éªŒ</h3><p><a href="src/test/java/com/lun/c05/cache/CacheTest.java">CacheTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFirstCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e1</span> <span class="operator">=</span> em.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e1);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e2</span> <span class="operator">=</span> em.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e2);</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">&quot;e1 == e2 : &quot;</span> + (e1 == e2));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DEBUG 08-02 22:50:35,092 ==&gt;  Preparing: select * from employee where id = ?   (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-02 22:50:35,192 ==&gt; Parameters: 1(Integer)  (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-02 22:50:35,260 &lt;==      Total: 1  (BaseJdbcLogger.java:145) </span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">e1 == e2 : true &lt;-------------e1å’Œe2æŒ‡å‘ç›¸åŒçš„å¯¹è±¡</span><br></pre></td></tr></table></figure><h2 id="53-ç¼“å­˜-ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ"><a href="#53-ç¼“å­˜-ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ" class="headerlink" title="53.ç¼“å­˜-ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ"></a>53.ç¼“å­˜-ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ</h2><p>åŒä¸€æ¬¡ä¼šè¯æœŸé—´åªè¦æŸ¥è¯¢è¿‡çš„æ•°æ®éƒ½ä¼šä¿å­˜åœ¨å½“å‰SqlSessionçš„ä¸€ä¸ªMapä¸­</p><ul><li>key &#x3D; hashCode + æŸ¥è¯¢çš„SqlId + ç¼–å†™çš„sqlæŸ¥è¯¢è¯­å¥ + å‚æ•°</li></ul><p>ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µï¼š</p><ol><li>ä¸åŒçš„SqlSessionå¯¹åº”ä¸åŒçš„ä¸€çº§ç¼“å­˜</li><li>åŒä¸€ä¸ªSqlSessionä½†æ˜¯æŸ¥è¯¢æ¡ä»¶ä¸åŒ</li><li>åŒä¸€ä¸ªSqlSessionä¸¤æ¬¡æŸ¥è¯¢æœŸé—´æ‰§è¡Œäº†ä»»ä½•ä¸€æ¬¡<strong>å¢åˆ æ”¹</strong>æ“ä½œ</li><li>åŒä¸€ä¸ªSqlSessionä¸¤æ¬¡æŸ¥è¯¢æœŸé—´æ‰‹åŠ¨æ¸…ç©ºäº†ç¼“å­˜</li></ol><h2 id="54-ç¼“å­˜-äºŒçº§ç¼“å­˜ä»‹ç»"><a href="#54-ç¼“å­˜-äºŒçº§ç¼“å­˜ä»‹ç»" class="headerlink" title="54.ç¼“å­˜-äºŒçº§ç¼“å­˜ä»‹ç»"></a>54.ç¼“å­˜-äºŒçº§ç¼“å­˜ä»‹ç»</h2><ul><li>äºŒçº§ç¼“å­˜(second level cache)ï¼Œå…¨å±€ä½œç”¨åŸŸç¼“å­˜</li><li>äºŒçº§ç¼“å­˜é»˜è®¤ä¸å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®</li><li>MyBatisæä¾›äºŒçº§ç¼“å­˜çš„æ¥å£ä»¥åŠå®ç°ï¼Œç¼“å­˜å®ç°è¦æ±‚ POJOå®ç°Serializableæ¥å£</li><li>äºŒçº§ç¼“å­˜åœ¨ SqlSession å…³é—­æˆ–æäº¤ä¹‹åæ‰ä¼šç”Ÿæ•ˆ</li><li>ä½¿ç”¨æ­¥éª¤<ol><li>å…¨å±€é…ç½®æ–‡ä»¶ä¸­å¼€å¯äºŒçº§ç¼“å­˜<ul><li><code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code></li></ul></li><li>éœ€è¦ä½¿ç”¨äºŒçº§ç¼“å­˜çš„æ˜ å°„æ–‡ä»¶å¤„ä½¿ç”¨cacheé…ç½®ç¼“å­˜<ul><li><code>&lt;cache /&gt;</code></li></ul></li><li><strong>æ³¨æ„</strong>ï¼š POJOéœ€è¦å®ç°Serializableæ¥å£</li></ol></li></ul><p>cacheæ ‡ç­¾çš„å±æ€§ï¼š</p><ul><li>eviction:ç¼“å­˜çš„å›æ”¶ç­–ç•¥ï¼š<ul><li>LRU â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</li><li>FIFO â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚</li><li>SOFT â€“ è½¯å¼•ç”¨ï¼šç§»é™¤åŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚</li><li>WEAK â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°ç§»é™¤åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚</li><li>é»˜è®¤çš„æ˜¯ LRUã€‚</li></ul></li><li>flushIntervalï¼šç¼“å­˜åˆ·æ–°é—´éš”<ul><li>ç¼“å­˜å¤šé•¿æ—¶é—´æ¸…ç©ºä¸€æ¬¡ï¼Œé»˜è®¤ä¸æ¸…ç©ºï¼Œè®¾ç½®ä¸€ä¸ªæ¯«ç§’å€¼</li></ul></li><li>readOnly:æ˜¯å¦åªè¯»ï¼š<ul><li>trueï¼šåªè¯»ï¼›mybatisè®¤ä¸ºæ‰€æœ‰ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„æ“ä½œéƒ½æ˜¯åªè¯»æ“ä½œï¼Œä¸ä¼šä¿®æ”¹æ•°æ®ã€‚mybatisä¸ºäº†åŠ å¿«è·å–é€Ÿåº¦ï¼Œç›´æ¥å°±ä¼šå°†æ•°æ®åœ¨ç¼“å­˜ä¸­çš„å¼•ç”¨äº¤ç»™ç”¨æˆ·ã€‚ä¸å®‰å…¨ï¼Œé€Ÿåº¦å¿«</li><li>falseï¼šéåªè¯»ï¼šmybatisè§‰å¾—è·å–çš„æ•°æ®å¯èƒ½ä¼šè¢«ä¿®æ”¹ã€‚mybatisä¼šåˆ©ç”¨åºåˆ—åŒ–&amp;ååºåˆ—çš„æŠ€æœ¯å…‹éš†ä¸€ä»½æ–°çš„æ•°æ®ç»™ä½ ã€‚å®‰å…¨ï¼Œé€Ÿåº¦æ…¢</li></ul></li><li>sizeï¼šç¼“å­˜å­˜æ”¾å¤šå°‘å…ƒç´ ï¼›</li><li>type&#x3D;â€â€ï¼šæŒ‡å®šè‡ªå®šä¹‰ç¼“å­˜çš„å…¨ç±»åï¼›<ul><li>å®ç°Cacheæ¥å£å³å¯ï¼›</li></ul></li></ul><h2 id="55-ç¼“å­˜-äºŒçº§ç¼“å­˜ä½¿ç”¨-amp-ç»†èŠ‚"><a href="#55-ç¼“å­˜-äºŒçº§ç¼“å­˜ä½¿ç”¨-amp-ç»†èŠ‚" class="headerlink" title="55.ç¼“å­˜-äºŒçº§ç¼“å­˜ä½¿ç”¨&amp;ç»†èŠ‚"></a>55.ç¼“å­˜-äºŒçº§ç¼“å­˜ä½¿ç”¨&amp;ç»†èŠ‚</h2><p>ä½¿ç”¨æ­¥éª¤:</p><ol><li>å…¨å±€é…ç½®æ–‡ä»¶ä¸­å¼€å¯äºŒçº§ç¼“å­˜<ul><li><code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code></li></ul></li><li>éœ€è¦ä½¿ç”¨äºŒçº§ç¼“å­˜çš„æ˜ å°„æ–‡ä»¶å¤„ä½¿ç”¨cacheé…ç½®ç¼“å­˜<ul><li><code>&lt;cache /&gt;</code></li></ul></li><li><strong>æ³¨æ„</strong>ï¼š POJOéœ€è¦å®ç°Serializableæ¥å£</li></ol><p><a href="src/main/resources/c05/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;settings&gt;</span><br><span class="line">		&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c01/helloworld/bean/Employee.java">Employee.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">7390587151857533202L</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c05/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;60000&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;false&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1024&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c05/cache/CacheTest.java">CacheTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSecondCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c05/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session2</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e1</span> <span class="operator">=</span> em.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e1);</span><br><span class="line">			session.close();</span><br><span class="line">			</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">em2</span> <span class="operator">=</span> session2.getMapper(EmployeeMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e2</span> <span class="operator">=</span> em2.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e2);</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">&quot;e1 == e2 : &quot;</span> + (e1 == e2));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session2.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEBUG 08-03 01:13:02,575 Cache Hit Ratio [com.lun.c03.mapper.dao.EmployeeMapper]: 0.0  (LoggingCache.java:62) </span><br><span class="line">DEBUG 08-03 01:13:03,945 ==&gt;  Preparing: select * from employee where id = ?   (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-03 01:13:04,081 ==&gt; Parameters: 1(Integer)  (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-03 01:13:04,186 &lt;==      Total: 1  (BaseJdbcLogger.java:145) </span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">DEBUG 08-03 01:13:04,218 Cache Hit Ratio [com.lun.c03.mapper.dao.EmployeeMapper]: 0.5  (LoggingCache.java:62) </span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">e1 == e2 : false</span><br></pre></td></tr></table></figure><h2 id="56-ç¼“å­˜-ç¼“å­˜æœ‰å…³çš„è®¾ç½®ä»¥åŠå±æ€§"><a href="#56-ç¼“å­˜-ç¼“å­˜æœ‰å…³çš„è®¾ç½®ä»¥åŠå±æ€§" class="headerlink" title="56.ç¼“å­˜-ç¼“å­˜æœ‰å…³çš„è®¾ç½®ä»¥åŠå±æ€§"></a>56.ç¼“å­˜-ç¼“å­˜æœ‰å…³çš„è®¾ç½®ä»¥åŠå±æ€§</h2><ol><li>å…¨å±€settingçš„cacheEnableï¼š<br>â€“ é…ç½®äºŒçº§ç¼“å­˜çš„å¼€å…³ã€‚ä¸€çº§ç¼“å­˜ä¸€ç›´æ˜¯æ‰“å¼€çš„ã€‚</li><li>selectæ ‡ç­¾çš„useCacheå±æ€§ï¼š<br>â€“ é…ç½®è¿™ä¸ªselectæ˜¯å¦ä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜ä¸€ç›´æ˜¯ä½¿ç”¨çš„</li><li>æ¯ä¸ªå¢åˆ æ”¹æ ‡ç­¾çš„flushCacheå±æ€§ï¼š<br>â€“ å¢åˆ æ”¹é»˜è®¤flushCache&#x3D;trueã€‚sqlæ‰§è¡Œä»¥åï¼Œä¼šåŒæ—¶æ¸…ç©ºä¸€çº§å’ŒäºŒçº§ç¼“å­˜ã€‚æŸ¥è¯¢é»˜è®¤flushCache&#x3D;falseã€‚</li><li>sqlSession.clearCache()ï¼š<br>â€“ åªæ˜¯ç”¨æ¥æ¸…é™¤ä¸€çº§ç¼“å­˜ã€‚</li><li>å…¨å±€settingçš„localCacheScopeï¼šæœ¬åœ°ç¼“å­˜ä½œç”¨åŸŸï¼šï¼ˆä¸€çº§ç¼“å­˜SESSIONï¼‰ï¼Œå½“å‰ä¼šè¯çš„æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ä¼šè¯ç¼“å­˜ä¸­ï¼›STATEMENTï¼šå¯ä»¥ç¦ç”¨ä¸€çº§ç¼“å­˜ã€‚</li></ol><h2 id="57-ç¼“å­˜-ç¼“å­˜åŸç†å›¾ç¤º"><a href="#57-ç¼“å­˜-ç¼“å­˜åŸç†å›¾ç¤º" class="headerlink" title="57.ç¼“å­˜-ç¼“å­˜åŸç†å›¾ç¤º"></a>57.ç¼“å­˜-ç¼“å­˜åŸç†å›¾ç¤º</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/04.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/image-20220217184558739.png" alt="image-20220217184558739"></p><h2 id="58-ç¼“å­˜-ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆåŸç†-amp-ehcacheé€‚é…åŒ…ä¸‹è½½"><a href="#58-ç¼“å­˜-ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆåŸç†-amp-ehcacheé€‚é…åŒ…ä¸‹è½½" class="headerlink" title="58.ç¼“å­˜-ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆåŸç†&amp;ehcacheé€‚é…åŒ…ä¸‹è½½"></a>58.ç¼“å­˜-ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆåŸç†&amp;ehcacheé€‚é…åŒ…ä¸‹è½½</h2><ul><li>EhCache æ˜¯ä¸€ä¸ªçº¯Javaçš„è¿›ç¨‹å†…ç¼“å­˜æ¡†æ¶ï¼Œå…·æœ‰å¿«é€Ÿã€ç²¾å¹²ç­‰ç‰¹ç‚¹ï¼Œæ˜¯Hibernateä¸­é»˜è®¤çš„CacheProviderã€‚</li><li>MyBatiså®šä¹‰äº†Cacheæ¥å£æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œè‡ªå®šä¹‰æ‰©å±•ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.ibatis.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line"></span><br><span class="line">  String <span class="title function_">getId</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span>;</span><br><span class="line"></span><br><span class="line">  Object <span class="title function_">getObject</span><span class="params">(Object key)</span>;</span><br><span class="line"></span><br><span class="line">  Object <span class="title function_">removeObject</span><span class="params">(Object key)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  ReadWriteLock <span class="title function_">getReadWriteLock</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="59-ç¼“å­˜-MyBatisæ•´åˆehcache-amp-æ€»ç»“"><a href="#59-ç¼“å­˜-MyBatisæ•´åˆehcache-amp-æ€»ç»“" class="headerlink" title="59.ç¼“å­˜-MyBatisæ•´åˆehcache&amp;æ€»ç»“"></a>59.ç¼“å­˜-MyBatisæ•´åˆehcache&amp;æ€»ç»“</h2><p>æ­¥éª¤ï¼š</p><ul><li>åŠ å…¥mybatis-ehcacheä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ç¼–å†™<a href="src/main/resources/ehcache.xml">ehcache.xml</a>é…ç½®æ–‡ä»¶</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;../config/ehcache.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- ç£ç›˜ä¿å­˜è·¯å¾„ --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;C:\\ehcache&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">defaultCache</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;10000&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxElementsOnDisk</span>=<span class="string">&quot;10000000&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">å±æ€§è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">l diskStoreï¼šæŒ‡å®šæ•°æ®åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨ä½ç½®ã€‚</span></span><br><span class="line"><span class="comment">l defaultCacheï¼šå½“å€ŸåŠ©CacheManager.add(&quot;demoCache&quot;)åˆ›å»ºCacheæ—¶ï¼ŒEhCacheä¾¿ä¼šé‡‡ç”¨&lt;defalutCache/&gt;æŒ‡å®šçš„çš„ç®¡ç†ç­–ç•¥</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">ä»¥ä¸‹å±æ€§æ˜¯å¿…é¡»çš„ï¼š</span></span><br><span class="line"><span class="comment">l maxElementsInMemory - åœ¨å†…å­˜ä¸­ç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›® </span></span><br><span class="line"><span class="comment">l maxElementsOnDisk - åœ¨ç£ç›˜ä¸Šç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›®ï¼Œè‹¥æ˜¯0è¡¨ç¤ºæ— ç©·å¤§</span></span><br><span class="line"><span class="comment">l eternal - è®¾å®šç¼“å­˜çš„elementsæ˜¯å¦æ°¸è¿œä¸è¿‡æœŸã€‚å¦‚æœä¸ºtrueï¼Œåˆ™ç¼“å­˜çš„æ•°æ®å§‹ç»ˆæœ‰æ•ˆï¼Œå¦‚æœä¸ºfalseé‚£ä¹ˆè¿˜è¦æ ¹æ®timeToIdleSecondsï¼ŒtimeToLiveSecondsåˆ¤æ–­</span></span><br><span class="line"><span class="comment">l overflowToDisk - è®¾å®šå½“å†…å­˜ç¼“å­˜æº¢å‡ºçš„æ—¶å€™æ˜¯å¦å°†è¿‡æœŸçš„elementç¼“å­˜åˆ°ç£ç›˜ä¸Š</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">ä»¥ä¸‹å±æ€§æ˜¯å¯é€‰çš„ï¼š</span></span><br><span class="line"><span class="comment">l timeToIdleSeconds - å½“ç¼“å­˜åœ¨EhCacheä¸­çš„æ•°æ®å‰åä¸¤æ¬¡è®¿é—®çš„æ—¶é—´è¶…è¿‡timeToIdleSecondsçš„å±æ€§å–å€¼æ—¶ï¼Œè¿™äº›æ•°æ®ä¾¿ä¼šåˆ é™¤ï¼Œé»˜è®¤å€¼æ˜¯0,ä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§</span></span><br><span class="line"><span class="comment">l timeToLiveSeconds - ç¼“å­˜elementçš„æœ‰æ•ˆç”Ÿå‘½æœŸï¼Œé»˜è®¤æ˜¯0.,ä¹Ÿå°±æ˜¯elementå­˜æ´»æ—¶é—´æ— ç©·å¤§</span></span><br><span class="line"><span class="comment"> diskSpoolBufferSizeMB è¿™ä¸ªå‚æ•°è®¾ç½®DiskStore(ç£ç›˜ç¼“å­˜)çš„ç¼“å­˜åŒºå¤§å°.é»˜è®¤æ˜¯30MB.æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒº.</span></span><br><span class="line"><span class="comment">l diskPersistent - åœ¨VMé‡å¯çš„æ—¶å€™æ˜¯å¦å¯ç”¨ç£ç›˜ä¿å­˜EhCacheä¸­çš„æ•°æ®ï¼Œé»˜è®¤æ˜¯falseã€‚</span></span><br><span class="line"><span class="comment">l diskExpiryThreadIntervalSeconds - ç£ç›˜ç¼“å­˜çš„æ¸…ç†çº¿ç¨‹è¿è¡Œé—´éš”ï¼Œé»˜è®¤æ˜¯120ç§’ã€‚æ¯ä¸ª120sï¼Œç›¸åº”çš„çº¿ç¨‹ä¼šè¿›è¡Œä¸€æ¬¡EhCacheä¸­æ•°æ®çš„æ¸…ç†å·¥ä½œ</span></span><br><span class="line"><span class="comment">l memoryStoreEvictionPolicy - å½“å†…å­˜ç¼“å­˜è¾¾åˆ°æœ€å¤§ï¼Œæœ‰æ–°çš„elementåŠ å…¥çš„æ—¶å€™ï¼Œ ç§»é™¤ç¼“å­˜ä¸­elementçš„ç­–ç•¥ã€‚é»˜è®¤æ˜¯LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ï¼Œå¯é€‰çš„æœ‰LFUï¼ˆæœ€ä¸å¸¸ä½¿ç”¨ï¼‰å’ŒFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®cacheæ ‡ç­¾<code>&lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;&gt;&lt;/cache&gt;</code></li></ul><hr><p>æ¼”ç¤ºï¼š</p><p><a href="src/main/resources/c05/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c05/cache/CacheTest.java">CacheTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEhcache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c05/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session2</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm</span> <span class="operator">=</span> session.getMapper(DepartmentMapper.class);</span><br><span class="line">			<span class="type">Department</span> <span class="variable">dp</span> <span class="operator">=</span> dm.getDeptById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(dp);</span><br><span class="line">			session.close();</span><br><span class="line">			</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm2</span> <span class="operator">=</span> session2.getMapper(DepartmentMapper.class);</span><br><span class="line">			<span class="type">Department</span> <span class="variable">dp2</span> <span class="operator">=</span> dm2.getDeptById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(dp2);</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session2.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦å¤–</strong>ï¼š</p><p>å‚ç…§ç¼“å­˜ï¼š è‹¥æƒ³åœ¨å‘½åç©ºé—´ä¸­å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨ cache-ref å…ƒç´ æ¥å¼•ç”¨å¦å¤–ä¸€ä¸ªç¼“å­˜ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.mybatis.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- å¼•ç”¨ç¼“å­˜ï¼šnamespaceï¼šæŒ‡å®šå’Œå“ªä¸ªåç§°ç©ºé—´ä¸‹çš„ç¼“å­˜ä¸€æ · --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.mybatis.dao.EmployeeMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="60-æ•´åˆSpring-æ•´åˆé€‚é…åŒ…ä¸‹è½½"><a href="#60-æ•´åˆSpring-æ•´åˆé€‚é…åŒ…ä¸‹è½½" class="headerlink" title="60.æ•´åˆSpring-æ•´åˆé€‚é…åŒ…ä¸‹è½½"></a>60.æ•´åˆSpring-æ•´åˆé€‚é…åŒ…ä¸‹è½½</h2><p>MyBatis-Spring ä¼šå¸®åŠ©ä½ å°† MyBatis ä»£ç æ— ç¼åœ°æ•´åˆåˆ° Spring ä¸­ã€‚å®ƒå°†å…è®¸ MyBatis å‚ä¸åˆ° Spring çš„äº‹åŠ¡ç®¡ç†ä¹‹ä¸­ï¼Œåˆ›å»ºæ˜ å°„å™¨ mapper å’Œ SqlSession å¹¶æ³¨å…¥åˆ° bean ä¸­ï¼Œä»¥åŠå°† Mybatis çš„å¼‚å¸¸è½¬æ¢ä¸º Spring çš„ DataAccessExceptionã€‚æœ€ç»ˆï¼Œå¯ä»¥åšåˆ°åº”ç”¨ä»£ç ä¸ä¾èµ–äº MyBatisï¼ŒSpring æˆ– MyBatis-Springã€‚</p><p><a target="_blank" rel="noopener" href="http://mybatis.org/spring/zh/index.html">å®˜æ–¹æ–‡æ¡£</a></p><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/spring">æºç ä»“åº“</a></p><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/jpetstore-6">å®˜æ–¹æ•´åˆç¤ºä¾‹</a></p><h2 id="61-æ•´åˆSpring-æ‰€æœ‰éœ€è¦çš„jaråŒ…å¯¼å…¥"><a href="#61-æ•´åˆSpring-æ‰€æœ‰éœ€è¦çš„jaråŒ…å¯¼å…¥" class="headerlink" title="61.æ•´åˆSpring-æ‰€æœ‰éœ€è¦çš„jaråŒ…å¯¼å…¥"></a>61.æ•´åˆSpring-æ‰€æœ‰éœ€è¦çš„jaråŒ…å¯¼å…¥</h2><p><a href="pom.xml">pom.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- DBè¿æ¥æ±  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- JSP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç”¨äºæ•´åˆSpring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="62-æ•´åˆSpring-å¼•å…¥MyBatisä¹‹å‰çš„é…ç½®"><a href="#62-æ•´åˆSpring-å¼•å…¥MyBatisä¹‹å‰çš„é…ç½®" class="headerlink" title="62.æ•´åˆSpring-å¼•å…¥MyBatisä¹‹å‰çš„é…ç½®"></a>62.æ•´åˆSpring-å¼•å…¥MyBatisä¹‹å‰çš„é…ç½®</h2><p><a href="src/main/resources/c06/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--æ˜¾ç¤ºçš„æŒ‡å®šæ¯ä¸ªæˆ‘ä»¬éœ€è¦æ›´æ”¹çš„é…ç½®çš„å€¼ï¼Œå³ä½¿ä»–æ˜¯é»˜è®¤çš„ã€‚é˜²æ­¢ç‰ˆæœ¬æ›´æ–°å¸¦æ¥çš„é—®é¢˜  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c06/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c06.spring.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmps&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c06/spring/EmployeeMapper.java">EmployeeMapper</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmps</span><span class="params">()</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="63-æ•´åˆSpring-SpringMVCé…ç½®æ–‡ä»¶ç¼–å†™"><a href="#63-æ•´åˆSpring-SpringMVCé…ç½®æ–‡ä»¶ç¼–å†™" class="headerlink" title="63.æ•´åˆSpring-SpringMVCé…ç½®æ–‡ä»¶ç¼–å†™"></a>63.æ•´åˆSpring-SpringMVCé…ç½®æ–‡ä»¶ç¼–å†™</h2><p><a href="src/main/webapp/WEB-INF/web.xml">web.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--Springé…ç½®ï¼š needed for ContextLoaderListener --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Bootstraps the root web application context before servlet initialization --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- SpringMVCé…ç½® --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/webapp/WEB-INF/spring-servlet.xml">spring-servlet.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">...</span>&quot;&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--SpringMVCåªæ˜¯æ§åˆ¶ç½‘ç«™è·³è½¬é€»è¾‘  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- åªæ‰«ææ§åˆ¶å™¨ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lun.c06&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- è§†å›¾è§£æå™¨ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="64-æ•´åˆSpring-Springé…ç½®æ–‡ä»¶ç¼–å†™"><a href="#64-æ•´åˆSpring-Springé…ç½®æ–‡ä»¶ç¼–å†™" class="headerlink" title="64.æ•´åˆSpring-Springé…ç½®æ–‡ä»¶ç¼–å†™"></a>64.æ•´åˆSpring-Springé…ç½®æ–‡ä»¶ç¼–å†™</h2><p><a href="src/main/resources/c06/applicationContext.xml">applicationContext.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">...</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Springå¸Œæœ›ç®¡ç†æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ç»„ä»¶ï¼Œç­‰ã€‚ã€‚ã€‚ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lun.c06&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- å¼•å…¥æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:c04/dbconfig.properties&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Springç”¨æ¥æ§åˆ¶ä¸šåŠ¡é€»è¾‘ã€‚æ•°æ®æºã€äº‹åŠ¡æ§åˆ¶ã€aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- springäº‹åŠ¡ç®¡ç† --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- å¼€å¯åŸºäºæ³¨è§£çš„äº‹åŠ¡ --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="65-æ•´åˆSpring-Springæ•´åˆMyBatiså…³é”®é…ç½®"><a href="#65-æ•´åˆSpring-Springæ•´åˆMyBatiså…³é”®é…ç½®" class="headerlink" title="65.æ•´åˆSpring-Springæ•´åˆMyBatiså…³é”®é…ç½®"></a>65.æ•´åˆSpring-Springæ•´åˆMyBatiså…³é”®é…ç½®</h2><p><a href="src/main/resources/c06/applicationContext.xml">applicationContext.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	æ•´åˆmybatis </span></span><br><span class="line"><span class="comment">		ç›®çš„ï¼š1ã€springç®¡ç†æ‰€æœ‰ç»„ä»¶ã€‚mapperçš„å®ç°ç±»ã€‚</span></span><br><span class="line"><span class="comment">				service==&gt;Dao   @Autowired:è‡ªåŠ¨æ³¨å…¥mapperï¼›</span></span><br><span class="line"><span class="comment">			2ã€springç”¨æ¥ç®¡ç†äº‹åŠ¡ï¼Œspringå£°æ˜å¼äº‹åŠ¡</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--åˆ›å»ºå‡ºSqlSessionFactoryå¯¹è±¡  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- configLocationæŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä½ç½® --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:c06/mybatis-config.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--mapperLocations: æŒ‡å®šmapperæ–‡ä»¶çš„ä½ç½®--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:c06/*Mapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--é…ç½®ä¸€ä¸ªå¯ä»¥è¿›è¡Œæ‰¹é‡æ‰§è¡Œçš„sqlSession  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- æ‰«ææ‰€æœ‰çš„mapperæ¥å£çš„å®ç°ï¼Œè®©è¿™äº›mapperèƒ½å¤Ÿè‡ªåŠ¨æ³¨å…¥ï¼›</span></span><br><span class="line"><span class="comment">	base-packageï¼šæŒ‡å®šmapperæ¥å£çš„åŒ…å</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mybatis-spring:scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lun.c06&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name=&quot;basePackage&quot; value=&quot;com.lun.dao&quot;&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;/bean&gt; --&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="66-æ•´åˆSpring-æ•´åˆæµ‹è¯•"><a href="#66-æ•´åˆSpring-æ•´åˆæµ‹è¯•" class="headerlink" title="66.æ•´åˆSpring-æ•´åˆæµ‹è¯•"></a>66.æ•´åˆSpring-æ•´åˆæµ‹è¯•</h2><p><a href="src/main/java/com/lun/c06/spring/EmployeeController.java">EmployeeController.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">5415910268862124882L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	EmployeeService employeeService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/getemps&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">emps</span><span class="params">(Map&lt;String,Object&gt; map)</span>&#123;</span><br><span class="line">		List&lt;Employee&gt; emps = employeeService.getEmps();</span><br><span class="line">		map.put(<span class="string">&quot;allEmps&quot;</span>, emps);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c06/spring/EmployeeService.java">EmployeeService.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmps</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">		<span class="comment">//EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);</span></span><br><span class="line">		<span class="keyword">return</span> employeeMapper.getEmps();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/webapp/WEB-INF/pages/list.jsp">list.jsp</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>å‘˜å·¥åˆ—è¡¨<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>lastName<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>email<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;allEmps&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;emp&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.lastName&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.email&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.gender&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p>æœ€åï¼Œåœ¨æµè§ˆå™¨è¾“å…¥<code>http://localhost:8080/LearnMybatis/getemps</code>è¿›è¡Œæµ‹è¯•</p><h2 id="MyBatis-ä»£ç ç”Ÿæˆå™¨"><a href="#MyBatis-ä»£ç ç”Ÿæˆå™¨" class="headerlink" title="MyBatis-ä»£ç ç”Ÿæˆå™¨"></a>MyBatis-ä»£ç ç”Ÿæˆå™¨</h2><p>MyBatis Generatorï¼š</p><p>ç®€ç§°MBGï¼Œæ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºMyBatisæ¡†æ¶ä½¿ç”¨è€…å®šåˆ¶çš„ä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥å¿«é€Ÿçš„æ ¹æ®è¡¨ç”Ÿæˆå¯¹åº”çš„æ˜ å°„æ–‡ä»¶ï¼Œæ¥å£ï¼Œä»¥åŠbeanç±»ã€‚æ”¯æŒåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œä»¥åŠQBCé£æ ¼çš„æ¡ä»¶æŸ¥è¯¢ã€‚ä½†æ˜¯è¡¨è¿æ¥ã€å­˜å‚¨è¿‡ç¨‹ç­‰è¿™äº›å¤æ‚sqlçš„å®šä¹‰éœ€è¦æˆ‘ä»¬æ‰‹å·¥ç¼–å†™</p><p><a target="_blank" rel="noopener" href="http://www.mybatis.org/generator/">å®˜æ–¹æ–‡æ¡£åœ°å€</a></p><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/generator/releases">å®˜æ–¹å·¥ç¨‹åœ°å€</a></p><h3 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h3><ul><li>ä½¿ç”¨æ­¥éª¤ï¼š<ol><li>ç¼–å†™MBGçš„é…ç½®æ–‡ä»¶ï¼ˆé‡è¦å‡ å¤„é…ç½®ï¼‰<ol><li>jdbcConnectioné…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯</li><li>javaModelGeneratoré…ç½®javaBeançš„ç”Ÿæˆç­–ç•¥</li><li>sqlMapGenerator é…ç½®sqlæ˜ å°„æ–‡ä»¶ç”Ÿæˆç­–ç•¥</li><li>javaClientGeneratoré…ç½®Mapperæ¥å£çš„ç”Ÿæˆç­–ç•¥</li><li>table é…ç½®è¦é€†å‘è§£æçš„æ•°æ®è¡¨<ul><li>tableNameï¼šè¡¨å</li><li>domainObjectNameï¼šå¯¹åº”çš„javaBeanå</li></ul></li></ol></li><li>è¿è¡Œä»£ç ç”Ÿæˆå™¨ç”Ÿæˆä»£ç </li></ol></li><li>æ³¨æ„ï¼š<ul><li>Contextæ ‡ç­¾<ul><li>targetRuntime&#x3D;â€œMyBatis3â€œå¯ä»¥ç”Ÿæˆå¸¦æ¡ä»¶çš„å¢åˆ æ”¹æŸ¥</li><li>targetRuntime&#x3D;â€œMyBatis3Simpleâ€œå¯ä»¥ç”ŸæˆåŸºæœ¬çš„å¢åˆ æ”¹æŸ¥</li></ul></li><li>å¦‚æœå†æ¬¡ç”Ÿæˆï¼Œå»ºè®®å°†ä¹‹å‰ç”Ÿæˆçš„æ•°æ®åˆ é™¤ï¼Œé¿å…xmlå‘åè¿½åŠ å†…å®¹å‡ºç°çš„é—®é¢˜ã€‚</li></ul></li></ul><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><a href="src/main/resources/c07/mbg.xml">mbg.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		targetRuntime=&quot;MyBatis3Simple&quot;:ç”Ÿæˆç®€å•ç‰ˆçš„CRUD</span></span><br><span class="line"><span class="comment">		&quot;MyBatis3&quot;:è±ªåç‰ˆ</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;c04/dbconfig.properties&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">&lt;!-- jdbcConnectionï¼šæŒ‡å®šå¦‚ä½•è¿æ¥åˆ°ç›®æ ‡æ•°æ®åº“ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">connectionURL</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">userId</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">password</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaTypeResolver</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- javaModelGeneratorï¼šæŒ‡å®šjavaBeançš„ç”Ÿæˆç­–ç•¥ </span></span><br><span class="line"><span class="comment">	targetPackage=&quot;test.model&quot;ï¼šç›®æ ‡åŒ…å</span></span><br><span class="line"><span class="comment">	targetProject=&quot;\MBGTestProject\src&quot;ï¼šç›®æ ‡å·¥ç¨‹</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.lun.bean&quot;</span> </span></span><br><span class="line"><span class="tag">    		<span class="attr">targetProject</span>=<span class="string">&quot;C:\\src&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- sqlMapGeneratorï¼šsqlæ˜ å°„ç”Ÿæˆç­–ç•¥ï¼š --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.lun.dao&quot;</span>  </span></span><br><span class="line"><span class="tag">    	<span class="attr">targetProject</span>=<span class="string">&quot;C:\\src&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- javaClientGenerator:æŒ‡å®šmapperæ¥å£æ‰€åœ¨çš„ä½ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.lun.dao&quot;</span>  </span></span><br><span class="line"><span class="tag">    	<span class="attr">targetProject</span>=<span class="string">&quot;C:\\src&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- æŒ‡å®šè¦é€†å‘åˆ†æå“ªäº›è¡¨ï¼šæ ¹æ®è¡¨è¦åˆ›å»ºjavaBean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;department&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Department&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;employee&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç”Ÿæˆå™¨ä»£ç "><a href="#ç”Ÿæˆå™¨ä»£ç " class="headerlink" title="ç”Ÿæˆå™¨ä»£ç "></a>ç”Ÿæˆå™¨ä»£ç </h3><p><a href="src/main/java/com/lun/c07/generator/GenerateCode.java">GenerateCode.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenerateCode</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">			<span class="type">boolean</span> <span class="variable">overwrite</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="type">File</span> <span class="variable">configFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(GenerateCode.class.getClassLoader().getResource(<span class="string">&quot;c07/mbg.xml&quot;</span>).getFile());</span><br><span class="line">			<span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);</span><br><span class="line">			<span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(configFile);</span><br><span class="line">			<span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overwrite);</span><br><span class="line">			<span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config, callback, warnings);</span><br><span class="line">			myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="QBCé£æ ¼çš„å¸¦æ¡ä»¶æŸ¥è¯¢"><a href="#QBCé£æ ¼çš„å¸¦æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="QBCé£æ ¼çš„å¸¦æ¡ä»¶æŸ¥è¯¢"></a>QBCé£æ ¼çš„å¸¦æ¡ä»¶æŸ¥è¯¢</h3><p>ç”Ÿæˆå™¨ä¼šQBCé£æ ¼ä»£ç </p><blockquote><p>QBC(Query By Criteria) APIæä¾›äº†æ£€ç´¢å¯¹è±¡çš„å¦ä¸€ç§æ–¹å¼ï¼Œå®ƒä¸»è¦ç”±Criteriaæ¥å£ã€Criterionæ¥å£å’ŒExpressonç±»ç»„æˆï¼Œå®ƒæ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€ç”ŸæˆæŸ¥è¯¢è¯­å¥ã€‚</p><p>From <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/QBC/1529451">https://baike.baidu.com/item/QBC/1529451</a></p></blockquote><p>QBCé£æ ¼ä»£ç ä½¿ç”¨å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> build.openSession();</span><br><span class="line">	<span class="type">DeptMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(DeptMapper.class);</span><br><span class="line">	<span class="type">DeptExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeptExample</span>();</span><br><span class="line">	<span class="comment">//æ‰€æœ‰çš„æ¡ä»¶éƒ½åœ¨exampleä¸­å°è£…</span></span><br><span class="line">	<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">	<span class="comment">//select id, deptName, locAdd from tbl_dept WHERE</span></span><br><span class="line">	<span class="comment">//( deptName like ? and id &gt; ? )</span></span><br><span class="line">	criteria.andDeptnameLike(<span class="string">&quot;%éƒ¨%&quot;</span>);</span><br><span class="line">	criteria.andIdGreaterThan(<span class="number">2</span>);</span><br><span class="line">	List&lt;Dept&gt; list = mapper.selectByExample(example);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (Dept dept : list) &#123;</span><br><span class="line">		System.out.println(dept);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="MyBatis-å·¥ä½œåŸç†"><a href="#MyBatis-å·¥ä½œåŸç†" class="headerlink" title="MyBatis-å·¥ä½œåŸç†"></a>MyBatis-å·¥ä½œåŸç†</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/05.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/07.png"></p><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/08.png" alt="æ ¹æ®é…ç½®æ–‡ä»¶åˆ›å»ºSQLSessionFactory"></p><ul><li>Configurationå°è£…äº†æ‰€æœ‰é…ç½®æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯</li><li>æ€»ç»“ï¼šæŠŠé…ç½®æ–‡ä»¶çš„ä¿¡æ¯è§£æå¹¶ä¿å­˜åœ¨Configurationå¯¹è±¡ä¸­ï¼Œè¿”å›åŒ…å«äº†Configurationçš„DefaultSqlSessionå¯¹è±¡ã€‚</li></ul><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/09.png" alt="openSessionè·å–sqlSessionå¯¹è±¡"></p><ul><li>è¿”å›SqlSessionçš„å®ç°ç±»DefaultSqlSessionå¯¹è±¡ã€‚ä»–é‡Œé¢åŒ…å«äº†Executorå’ŒConfiguration</li><li>Executorä¼šåœ¨è¿™ä¸€æ­¥è¢«åˆ›å»º</li></ul><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/10.png" alt="getMapperè¿”å›æ¥å£çš„ä»£ç†å¯¹è±¡åŒ…å«äº†SqlSessionå¯¹è±¡"></p><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/11.png" alt="æŸ¥è¯¢æµç¨‹"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/12.png" alt="æŸ¥è¯¢æµç¨‹æ€»ç»“"></p><ul><li>StatementHandlerï¼šå¤„ç†sqlè¯­å¥é¢„ç¼–è¯‘ï¼Œè®¾ç½®å‚æ•°ç­‰ç›¸å…³å·¥ä½œï¼›</li><li>ParameterHandlerï¼šè®¾ç½®é¢„ç¼–è¯‘å‚æ•°ç”¨çš„</li><li>ResultHandlerï¼šå¤„ç†ç»“æœé›†</li><li>TypeHandlerï¼šåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œæ•°æ®åº“ç±»å‹å’ŒjavaBeanç±»å‹çš„æ˜ å°„</li></ul><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><ol><li>æ ¹æ®é…ç½®æ–‡ä»¶ï¼ˆå…¨å±€ï¼Œsqlæ˜ å°„ï¼‰åˆå§‹åŒ–å‡ºConfigurationå¯¹è±¡</li><li>åˆ›å»ºä¸€ä¸ªDefaultSqlSessionå¯¹è±¡ï¼Œå®ƒé‡Œé¢åŒ…å«Configurationä»¥åŠExecutorï¼ˆæ ¹æ®å…¨å±€é…ç½®æ–‡ä»¶ä¸­çš„defaultExecutorTypeåˆ›å»ºå‡ºå¯¹åº”çš„Executorï¼‰</li><li>DefaultSqlSession.getMapperï¼ˆï¼‰ï¼šæ‹¿åˆ°Mapperæ¥å£å¯¹åº”çš„MapperProxyï¼›</li><li>MapperProxyé‡Œé¢æœ‰ï¼ˆDefaultSqlSessionï¼‰ï¼›</li><li>æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ–¹æ³•ï¼š<ol><li>è°ƒç”¨DefaultSqlSessionçš„å¢åˆ æ”¹æŸ¥ï¼ˆExecutorï¼‰ï¼›</li><li>ä¼šåˆ›å»ºä¸€ä¸ªStatementHandlerå¯¹è±¡ã€‚åŒæ—¶ä¹Ÿä¼šåˆ›å»ºå‡ºParameterHandlerå’ŒResultSetHandlerï¼‰</li><li>è°ƒç”¨StatementHandleré¢„ç¼–è¯‘å‚æ•°ä»¥åŠè®¾ç½®å‚æ•°å€¼ï¼Œä½¿ç”¨ParameterHandleræ¥ç»™sqlè®¾ç½®å‚æ•°</li><li>è°ƒç”¨StatementHandlerçš„å¢åˆ æ”¹æŸ¥æ–¹æ³•ï¼›</li><li>ResultSetHandlerå°è£…ç»“æœ</li></ol></li></ol><p><strong>æ³¨æ„</strong>ï¼šå››å¤§å¯¹è±¡(Executorã€ParameterHandlerã€ResultSetHandler)æ¯ä¸ªåˆ›å»ºçš„æ—¶å€™éƒ½æœ‰ä¸€ä¸ªinterceptorChain.pluginAll(parameterHandler);</p><h2 id="MyBatis-æ’ä»¶å¼€å‘"><a href="#MyBatis-æ’ä»¶å¼€å‘" class="headerlink" title="MyBatis-æ’ä»¶å¼€å‘"></a>MyBatis-æ’ä»¶å¼€å‘</h2><p>åœ¨å››å¤§å¯¹è±¡åˆ›å»ºçš„æ—¶å€™</p><ol><li>æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ä¸æ˜¯ç›´æ¥è¿”å›çš„ï¼Œè€Œæ˜¯interceptorChain.pluginAll(parameterHandler);</li><li>è·å–åˆ°æ‰€æœ‰çš„Interceptorï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼ˆæ’ä»¶éœ€è¦å®ç°çš„æ¥å£ï¼‰ï¼›è°ƒç”¨interceptor.plugin(target);è¿”å›targetåŒ…è£…åçš„å¯¹è±¡</li><li>æ’ä»¶æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’ä»¶ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼›AOPï¼ˆé¢å‘åˆ‡é¢ï¼‰æˆ‘ä»¬çš„æ’ä»¶å¯ä»¥ä¸ºå››å¤§å¯¹è±¡åˆ›å»ºå‡ºä»£ç†å¯¹è±¡ï¼›ä»£ç†å¯¹è±¡å°±å¯ä»¥æ‹¦æˆªåˆ°å››å¤§å¯¹è±¡çš„æ¯ä¸€ä¸ªæ‰§è¡Œï¼›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">pluginAll</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Interceptor interceptor : interceptors) &#123;</span><br><span class="line">      target = interceptor.plugin(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMyBatis å…è®¸ä½¿ç”¨æ’ä»¶æ¥æ‹¦æˆªçš„æ–¹æ³•è°ƒç”¨åŒ…æ‹¬ï¼š</p><ul><li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li><li>ParameterHandler (getParameterObject, setParameters)</li><li>ResultSetHandler (handleResultSets, handleOutputParameters)</li><li>StatementHandler (prepare, parameterize, batch, update, query)</li></ul><h3 id="æ’ä»¶å¼€å‘"><a href="#æ’ä»¶å¼€å‘" class="headerlink" title="æ’ä»¶å¼€å‘"></a>æ’ä»¶å¼€å‘</h3><p>æ’ä»¶å¼€å‘æ­¥éª¤ï¼š</p><ol><li>ç¼–å†™æ’ä»¶å®ç°Interceptoræ¥å£ï¼Œå¹¶ä½¿ç”¨ @Interceptsæ³¨è§£å®Œæˆæ’ä»¶ç­¾å</li><li>åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œæ’ä»¶</li></ol><p><a href="src/main/java/com/lun/c08/interceptor/MyFirstPlugin.java">MyFirstPlugin.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®Œæˆæ’ä»¶ç­¾åï¼Œç”¨äºæ‹¦æˆªå“ªä¸ªå¯¹è±¡çš„å“ªä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type=StatementHandler.class,method=&quot;parameterize&quot;,args=java.sql.Statement.class)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * intercept:æ‹¦æˆª</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">&quot;myfirstplugin...interceptï¼š&quot;</span> + invocation.getMethod());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> invocation.getTarget();</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰æ‹¦æˆªåˆ°çš„å¯¹è±¡ï¼š&quot;</span>+target);</span><br><span class="line">        <span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> SystemMetaObject.forObject(target);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;parameterHandler.parameterObject&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;sqlè¯­å¥ä¸­çš„å‚æ•°æ˜¯ï¼š&quot;</span>+value);</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;parameterHandler.parameterObject&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">        <span class="comment">//è¿”å›æ‰§è¡Œåçš„è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åŒ…è£…ç›®æ ‡å¯¹è±¡ï¼Œä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--&gt;myfirstplugin...pluginï¼Œå°†è¦åŒ…è£…çš„å¯¹è±¡ï¼š&quot;</span>+target);</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">wrap</span> <span class="operator">=</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//è¿”å›ä¸ºå½“å‰targetåˆ›å»ºçš„åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> wrap;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†æ’ä»¶æ³¨å†Œæ—¶çš„propertyå±æ€§è®¾ç½®è¿›æ¥</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ’ä»¶é…ç½®çš„ä¿¡æ¯ï¼š&quot;</span>+properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="src/main/resources/c08/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.lun.c08.interceptor.MyFirstPlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- å¯å®ç°å¤šä¸ªæ’ä»¶ --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.lun.c08.interceptor.MySecondPlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="æ’ä»¶åŸç†"><a href="#æ’ä»¶åŸç†" class="headerlink" title="æ’ä»¶åŸç†"></a>æ’ä»¶åŸç†</h3><ul><li>æŒ‰ç…§æ’ä»¶æ³¨è§£å£°æ˜ï¼ŒæŒ‰ç…§æ’ä»¶é…ç½®é¡ºåºè°ƒç”¨æ’ä»¶pluginæ–¹æ³•ï¼Œç”Ÿæˆè¢«æ‹¦æˆªå¯¹è±¡çš„åŠ¨æ€ä»£ç†</li><li>å¤šä¸ªæ’ä»¶ä¾æ¬¡ç”Ÿæˆç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œå±‚å±‚åŒ…è£¹ï¼Œå…ˆå£°æ˜çš„å…ˆåŒ…è£¹ï¼›å½¢æˆä»£ç†é“¾</li><li>ç›®æ ‡æ–¹æ³•æ‰§è¡Œæ—¶ä¾æ¬¡ä»å¤–åˆ°å†…æ‰§è¡Œæ’ä»¶çš„interceptæ–¹æ³•ã€‚</li><li>å¤šä¸ªæ’ä»¶æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦åœ¨æŸä¸ªæ’ä»¶ä¸­åˆ†ç¦»å‡ºç›®æ ‡å¯¹è±¡ã€‚å¯ä»¥å€ŸåŠ©MyBatisæä¾›çš„SystemMetaObjectç±»æ¥è¿›è¡Œè·å–æœ€åä¸€å±‚çš„hä»¥åŠtargetå±æ€§çš„å€¼</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/06.png"></p><h3 id="Interceptoræ¥å£"><a href="#Interceptoræ¥å£" class="headerlink" title="Interceptoræ¥å£"></a>Interceptoræ¥å£</h3><ul><li>Interceptï¼šæ‹¦æˆªç›®æ ‡æ–¹æ³•æ‰§è¡Œ</li><li>pluginï¼šç”ŸæˆåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨MyBatisæä¾›çš„Pluginç±»çš„wrapæ–¹æ³•</li><li>setPropertiesï¼šæ³¨å…¥æ’ä»¶é…ç½®æ—¶è®¾ç½®çš„å±æ€§</li></ul><h3 id="å¸¸ç”¨ä»£ç "><a href="#å¸¸ç”¨ä»£ç " class="headerlink" title="å¸¸ç”¨ä»£ç "></a>å¸¸ç”¨ä»£ç </h3><p>ä»ä»£ç†é“¾ä¸­åˆ†ç¦»çœŸå®è¢«ä»£ç†å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1ã€åˆ†ç¦»ä»£ç†å¯¹è±¡ã€‚ç”±äºä¼šå½¢æˆå¤šæ¬¡ä»£ç†ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ä¸€ä¸ª</span></span><br><span class="line"><span class="keyword">while</span> å¾ªç¯åˆ†ç¦»å‡ºæœ€ç»ˆè¢«ä»£ç†å¯¹è±¡ï¼Œä»è€Œæ–¹ä¾¿æå–ä¿¡æ¯</span><br><span class="line"><span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> SystemMetaObject.forObject(target);</span><br><span class="line"><span class="keyword">while</span> (metaObject.hasGetter(<span class="string">&quot;h&quot;</span>)) &#123;</span><br><span class="line">	<span class="type">Object</span> <span class="variable">h</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">	metaObject = SystemMetaObject.forObject(h);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2ã€è·å–åˆ°ä»£ç†å¯¹è±¡ä¸­åŒ…å«çš„è¢«ä»£ç†çš„çœŸå®å¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;target&quot;</span>);</span><br><span class="line"><span class="comment">//3ã€è·å–è¢«ä»£ç†å¯¹è±¡çš„MetaObjectæ–¹ä¾¿è¿›è¡Œä¿¡æ¯æå–</span></span><br><span class="line"><span class="type">MetaObject</span> <span class="variable">forObject</span> <span class="operator">=</span> SystemMetaObject.forObject(obj);</span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-PageHelperæ’ä»¶è¿›è¡Œåˆ†é¡µ"><a href="#æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-PageHelperæ’ä»¶è¿›è¡Œåˆ†é¡µ" class="headerlink" title="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-PageHelperæ’ä»¶è¿›è¡Œåˆ†é¡µ"></a>æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-PageHelperæ’ä»¶è¿›è¡Œåˆ†é¡µ</h2><p><a target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper">PageHelperæ’ä»¶å®˜ç½‘</a></p><p><a href="pom.xml">pom.xml</a>æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- åˆ†é¡µæ’ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c09/mybatis-config.xml">MyBatiså…¨å±€é…ç½®æ–‡ä»¶</a>æ³¨å†Œæ’ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c09/other/PageHelperTest.java">ä½¿ç”¨ç¤ºä¾‹</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageHelperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="comment">// 1ã€è·å–sqlSessionFactoryå¯¹è±¡</span></span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c09/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="comment">// 2ã€è·å–sqlSessionå¯¹è±¡</span></span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">			Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">5</span>, <span class="number">1</span>);<span class="comment">//&lt;---------------------</span></span><br><span class="line">			</span><br><span class="line">			List&lt;Employee&gt; emps = mapper.getEmps();</span><br><span class="line">			<span class="comment">//ä¼ å…¥è¦è¿ç»­æ˜¾ç¤ºå¤šå°‘é¡µ</span></span><br><span class="line">			PageInfo&lt;Employee&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(emps, <span class="number">5</span>);<span class="comment">//&lt;---------------------</span></span><br><span class="line">			<span class="keyword">for</span> (Employee employee : emps) &#123;</span><br><span class="line">				System.out.println(employee);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/*System.out.println(&quot;å½“å‰é¡µç ï¼š&quot;+page.getPageNum());</span></span><br><span class="line"><span class="comment">			System.out.println(&quot;æ€»è®°å½•æ•°ï¼š&quot;+page.getTotal());</span></span><br><span class="line"><span class="comment">			System.out.println(&quot;æ¯é¡µçš„è®°å½•æ•°ï¼š&quot;+page.getPageSize());</span></span><br><span class="line"><span class="comment">			System.out.println(&quot;æ€»é¡µç ï¼š&quot;+page.getPages());*/</span></span><br><span class="line">			<span class="comment">///xxx</span></span><br><span class="line">			System.out.println(<span class="string">&quot;å½“å‰é¡µç ï¼š&quot;</span>+info.getPageNum());</span><br><span class="line">			System.out.println(<span class="string">&quot;æ€»è®°å½•æ•°ï¼š&quot;</span>+info.getTotal());</span><br><span class="line">			System.out.println(<span class="string">&quot;æ¯é¡µçš„è®°å½•æ•°ï¼š&quot;</span>+info.getPageSize());</span><br><span class="line">			System.out.println(<span class="string">&quot;æ€»é¡µç ï¼š&quot;</span>+info.getPages());</span><br><span class="line">			System.out.println(<span class="string">&quot;æ˜¯å¦ç¬¬ä¸€é¡µï¼š&quot;</span>+info.isIsFirstPage());</span><br><span class="line">			System.out.println(<span class="string">&quot;è¿ç»­æ˜¾ç¤ºçš„é¡µç ï¼š&quot;</span>);</span><br><span class="line">			<span class="type">int</span>[] nums = info.getNavigatepageNums();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">				System.out.println(nums[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//xxxx</span></span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-æ‰¹é‡æ“ä½œ"><a href="#æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-æ‰¹é‡æ“ä½œ" class="headerlink" title="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-æ‰¹é‡æ“ä½œ"></a>æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-æ‰¹é‡æ“ä½œ</h2><ul><li>é»˜è®¤çš„ openSession() æ–¹æ³•æ²¡æœ‰å‚æ•°,å®ƒä¼šåˆ›å»ºæœ‰å¦‚ä¸‹ç‰¹æ€§çš„<ul><li>ä¼šå¼€å¯ä¸€ä¸ªäº‹åŠ¡(ä¹Ÿå°±æ˜¯ä¸è‡ªåŠ¨æäº¤)</li><li>è¿æ¥å¯¹è±¡ä¼šä»ç”±æ´»åŠ¨ç¯å¢ƒé…ç½®çš„æ•°æ®æºå®ä¾‹å¾—åˆ°ã€‚</li><li>äº‹åŠ¡éš”ç¦»çº§åˆ«å°†ä¼šä½¿ç”¨é©±åŠ¨æˆ–æ•°æ®æºçš„é»˜è®¤è®¾ç½®ã€‚</li><li>é¢„å¤„ç†è¯­å¥ä¸ä¼šè¢«å¤ç”¨,ä¹Ÿä¸ä¼šæ‰¹é‡å¤„ç†æ›´æ–°ã€‚</li></ul></li><li>openSession æ–¹æ³•çš„ ExecutorType ç±»å‹çš„å‚æ•°ï¼Œæšä¸¾ç±»å‹:<ul><li>ExecutorType.SIMPLE: è¿™ä¸ªæ‰§è¡Œå™¨ç±»å‹ä¸åšç‰¹æ®Šçš„äº‹æƒ…ï¼ˆè¿™æ˜¯é»˜è®¤è£…é…çš„ï¼‰ã€‚å®ƒä¸ºæ¯ä¸ªè¯­å¥çš„æ‰§è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¢„å¤„ç†è¯­å¥ã€‚</li><li>ExecutorType.REUSE: è¿™ä¸ªæ‰§è¡Œå™¨ç±»å‹ä¼šå¤ç”¨é¢„å¤„ç†è¯­å¥ã€‚</li><li>ExecutorType.BATCH: è¿™ä¸ªæ‰§è¡Œå™¨ä¼šæ‰¹é‡æ‰§è¡Œæ‰€æœ‰æ›´æ–°è¯­å¥</li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/13.png"></p><p>æ‰¹é‡æ“ä½œæˆ‘ä»¬æ˜¯ä½¿ç”¨MyBatisæä¾›çš„BatchExecutorè¿›è¡Œçš„ï¼Œå®ƒçš„åº•å±‚å°±æ˜¯é€šè¿‡jdbcæ”’sqlçš„æ–¹å¼è¿›è¡Œçš„ã€‚æˆ‘ä»¬å¯ä»¥è®©ä»–æ”’å¤Ÿä¸€å®šæ•°é‡åå‘ç»™æ•°æ®åº“ä¸€æ¬¡ã€‚</p><p><a href="src/test/java/com/lun/c09/other/BatchTest.java">BatchTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c09/mybatis-config.xml&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//å¯ä»¥æ‰§è¡Œæ‰¹é‡æ“ä½œçš„sqlSession</span></span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">		<span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">				mapper.addEmp(<span class="keyword">new</span> <span class="title class_">Employee</span>(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>), <span class="string">&quot;b&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line">			openSession.commit();</span><br><span class="line">			<span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">			<span class="comment">//æ‰¹é‡ï¼šï¼ˆé¢„ç¼–è¯‘sqlä¸€æ¬¡==&gt;è®¾ç½®å‚æ•°===&gt;10000æ¬¡===&gt;æ‰§è¡Œï¼ˆ1æ¬¡ï¼‰ï¼‰</span></span><br><span class="line">			<span class="comment">//Parameters: 616c1(String), b(String), 1(String)==&gt;4598</span></span><br><span class="line">			<span class="comment">//éæ‰¹é‡ï¼šï¼ˆé¢„ç¼–è¯‘sql=è®¾ç½®å‚æ•°=æ‰§è¡Œï¼‰==ã€‹10000    10200</span></span><br><span class="line">			System.out.println(<span class="string">&quot;æ‰§è¡Œæ—¶é•¿ï¼š&quot;</span>+(end-start));</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>ä¸Springæ•´åˆä¸­ï¼Œæˆ‘ä»¬æ¨èï¼Œé¢å¤–çš„é…ç½®ä¸€ä¸ªå¯ä»¥ä¸“é—¨ç”¨æ¥æ‰§è¡Œæ‰¹é‡æ“ä½œçš„SqlSession</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ä¸€ä¸ªå¯ä»¥è¿›è¡Œæ‰¹é‡æ‰§è¡Œçš„sqlSession  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>éœ€è¦ç”¨åˆ°æ‰¹é‡æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å…¥é…ç½®çš„è¿™ä¸ªæ‰¹é‡SqlSessionã€‚é€šè¿‡ä»–è·å–åˆ°mapperæ˜ å°„å™¨è¿›è¡Œæ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>æ‰¹é‡æ“ä½œæ˜¯åœ¨session.commit()ä»¥åæ‰å‘é€sqlè¯­å¥ç»™æ•°æ®åº“è¿›è¡Œæ‰§è¡Œçš„</li><li>å¦‚æœæˆ‘ä»¬æƒ³è®©å…¶æå‰æ‰§è¡Œï¼Œä»¥æ–¹ä¾¿åç»­å¯èƒ½çš„æŸ¥è¯¢æ“ä½œè·å–æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨sqlSession.flushStatements()æ–¹æ³•ï¼Œè®©å…¶ç›´æ¥å†²åˆ·åˆ°æ•°æ®åº“è¿›è¡Œæ‰§è¡Œã€‚</li></ol><h2 id="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-å­˜å‚¨è¿‡ç¨‹"><a href="#æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-å­˜å‚¨è¿‡ç¨‹"></a>æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-å­˜å‚¨è¿‡ç¨‹</h2><p>å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¹Ÿä¼šå†™ä¸€äº›å­˜å‚¨è¿‡ç¨‹ï¼ŒMyBatisä¹Ÿæ”¯æŒå¯¹å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨</p><p>ä¸€ä¸ªæœ€ç®€å•çš„å­˜å‚¨è¿‡ç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure test()</span><br><span class="line">begin</span><br><span class="line">select &#x27;hello&#x27;;</span><br><span class="line">end $$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure><p>å­˜å‚¨è¿‡ç¨‹çš„è°ƒç”¨ï¼š</p><ol><li>selectæ ‡ç­¾ä¸­statementType&#x3D;â€œCALLABLEâ€</li><li>æ ‡ç­¾ä½“ä¸­è°ƒç”¨è¯­æ³•ï¼š<code>&#123;call procedure_name(#&#123;param1_info&#125;,#&#123;param2_info&#125;)&#125;</code></li></ol><p>MyBatiså¯¹å­˜å‚¨è¿‡ç¨‹çš„æ¸¸æ ‡æä¾›äº†ä¸€ä¸ªJdbcType&#x3D;CURSORçš„æ”¯æŒï¼Œå¯ä»¥æ™ºèƒ½çš„æŠŠæ¸¸æ ‡è¯»å–åˆ°çš„æ•°æ®ï¼Œæ˜ å°„åˆ°æˆ‘ä»¬å£°æ˜çš„ç»“æœé›†ä¸­</p><p>oracleå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span></span><br><span class="line">	hello_ test(</span><br><span class="line">		p_start <span class="keyword">in</span> <span class="type">int</span>,p_end <span class="keyword">in</span> <span class="type">int</span>,p_count <span class="keyword">out</span> <span class="type">int</span>,p_emps <span class="keyword">out</span> sys_refcursor)</span><br><span class="line">	) <span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">into</span> p_count <span class="keyword">from</span> employees;</span><br><span class="line">	<span class="keyword">open</span> p_emps <span class="keyword">for</span></span><br><span class="line">		<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> rownum rn,e.<span class="operator">*</span> <span class="keyword">from</span> employees e <span class="keyword">where</span> rownum<span class="operator">&lt;=</span>p_end )</span><br><span class="line">			<span class="keyword">where</span> rn<span class="operator">&gt;=</span>p_start;</span><br><span class="line"><span class="keyword">end</span> hello_test;</span><br></pre></td></tr></table></figure><p>mapper.xmlæ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public void getPageByProcedure(); </span></span><br><span class="line"><span class="comment">	1ã€ä½¿ç”¨selectæ ‡ç­¾å®šä¹‰è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</span></span><br><span class="line"><span class="comment">	2ã€statementType=&quot;CALLABLE&quot;:è¡¨ç¤ºè¦è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</span></span><br><span class="line"><span class="comment">	3ã€&#123;call procedure_name(params)&#125;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPageByProcedure&quot;</span> <span class="attr">statementType</span>=<span class="string">&quot;CALLABLE&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">		&#123;call hello_test(</span><br><span class="line">			#&#123;start,mode=IN,jdbcType=INTEGER&#125;,</span><br><span class="line">			#&#123;end,mode=IN,jdbcType=INTEGER&#125;,</span><br><span class="line">			#&#123;count,mode=OUT,jdbcType=INTEGER&#125;,</span><br><span class="line">			#&#123;emps,mode=OUT,jdbcType=CURSOR,javaType=ResultSet,resultMap=PageEmp&#125;</span><br><span class="line">		)&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;PageEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;EMPLOYEE_ID&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;LAST_NAME&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;EMAIL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¨å±€é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * oracleåˆ†é¡µï¼š</span></span><br><span class="line"><span class="comment"> * 		å€ŸåŠ©rownumï¼šè¡Œå·ï¼›å­æŸ¥è¯¢ï¼›</span></span><br><span class="line"><span class="comment"> * å­˜å‚¨è¿‡ç¨‹åŒ…è£…åˆ†é¡µé€»è¾‘</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProcedure</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">		<span class="type">OraclePage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OraclePage</span>();</span><br><span class="line">		page.setStart(<span class="number">1</span>);</span><br><span class="line">		page.setEnd(<span class="number">5</span>);</span><br><span class="line">		mapper.getPageByProcedure(page);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;æ€»è®°å½•æ•°ï¼š&quot;</span>+page.getCount());</span><br><span class="line">		System.out.println(<span class="string">&quot;æŸ¥å‡ºçš„æ•°æ®ï¼š&quot;</span>+page.getEmps().size());</span><br><span class="line">		System.out.println(<span class="string">&quot;æŸ¥å‡ºçš„æ•°æ®ï¼š&quot;</span>+page.getEmps());</span><br><span class="line">	&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OraclePage</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> start;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> end;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; emps;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//setter and getter</span></span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-typeHandlerå¤„ç†æšä¸¾"><a href="#æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-typeHandlerå¤„ç†æšä¸¾" class="headerlink" title="æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-typeHandlerå¤„ç†æšä¸¾"></a>æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-typeHandlerå¤„ç†æšä¸¾</h2><h3 id="çƒ­èº«"><a href="#çƒ­èº«" class="headerlink" title="çƒ­èº«"></a>çƒ­èº«</h3><p>æ–°å»ºä¸€ä¸ªæšä¸¾ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EmpStatus</span> &#123;</span><br><span class="line">	LOGIN,LOGOUT,REMOVE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æšä¸¾çš„ç›¸å…³å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEnumUse</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">EmpStatus</span> <span class="variable">login</span> <span class="operator">=</span> EmpStatus.LOGIN;</span><br><span class="line">	System.out.println(<span class="string">&quot;æšä¸¾çš„ç´¢å¼•ï¼š&quot;</span> + login.ordinal());</span><br><span class="line">	System.out.println(<span class="string">&quot;æšä¸¾çš„åå­—ï¼š&quot;</span> + login.name());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æšä¸¾çš„ç´¢å¼•ï¼š0</span><br><span class="line">æšä¸¾çš„åå­—ï¼šLOGIN</span><br></pre></td></tr></table></figure><hr><p>è‹¥å­˜å…¥æšä¸¾å±æ€§åˆ°æ•°æ®åº“ï¼Œæ•°æ®åº“è¡¨ä¼šå‘ˆç°æ€æ ·çš„å€¼ï¼Ÿ</p><p><a href="src/main/java/com/lun/c09/other/bean/Employee.java">Employeeç±»</a>æ·»åŠ ä¸€ä¸ªæšä¸¾å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">EmpStatus</span> <span class="variable">empStatus</span> <span class="operator">=</span> EmpStatus.LOGOUT;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹è¡¨ç»“æ„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> EmpStatus <span class="type">VARCHAR</span>(<span class="number">255</span>);</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c09/other/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEmp2</span><span class="params">(com.lun.c09.other.bean.Employee em)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> com.lun.c09.other.bean.Employee <span class="title function_">getEmpById2</span><span class="params">(Integer id)</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c09/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.lun.c09.other.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">		insert into employee(last_name,email,gender,empStatus) </span><br><span class="line">		values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;,#&#123;empStatus&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c09.other.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender,empStatus from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c09/other/EnumTest.java">æµ‹è¯•æ–¹æ³•</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é»˜è®¤mybatisåœ¨å¤„ç†æšä¸¾å¯¹è±¡çš„æ—¶å€™ä¿å­˜çš„æ˜¯æšä¸¾çš„åå­—ï¼šEnumTypeHandler</span></span><br><span class="line"><span class="comment"> * æ”¹å˜ä½¿ç”¨ï¼šEnumOrdinalTypeHandlerï¼š</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEnum</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c09/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">		<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;test_enum&quot;</span>, <span class="string">&quot;enum@abc.com&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		mapper.addEmp2(employee);</span><br><span class="line">		<span class="comment">//System.out.println(&quot;ä¿å­˜æˆåŠŸ&quot;+employee.getId());</span></span><br><span class="line">		<span class="comment">//openSession.commit();</span></span><br><span class="line">		<span class="type">Employee</span> <span class="variable">empById</span> <span class="operator">=</span> mapper.getEmpById2(employee.getId());</span><br><span class="line">		System.out.println(empById.getEmpStatus());</span><br><span class="line">	&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯å­˜å…¥<code>LOGOUT</code>åˆ°æ•°æ®åº“è¡¨ã€‚</p><p>å› æ­¤ï¼Œé»˜è®¤mybatisåœ¨å¤„ç†æšä¸¾å¯¹è±¡çš„æ—¶å€™ä¿å­˜çš„æ˜¯æšä¸¾çš„åå­—ï¼šEnumTypeHandler</p><p>å°†æƒ³<strong>å­˜æ•°å€¼</strong>åˆ°æ•°æ®åº“è¡¨ï¼Œæ”¹ç”¨EnumOrdinalTypeHandler</p><p>åœ¨<a href="src/main/resources/c09/mybatis-config.xml">MyBatiså­˜å‚¨æ–‡ä»¶</a>æ³¨å†Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.EnumOrdinalTypeHandler&quot;</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">javaType</span>=<span class="string">&quot;com.lun.c09.other.bean.EmpStatus&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰TypeHandler"><a href="#è‡ªå®šä¹‰TypeHandler" class="headerlink" title="è‡ªå®šä¹‰TypeHandler"></a>è‡ªå®šä¹‰TypeHandler</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰TypeHandlerçš„å½¢å¼æ¥åœ¨è®¾ç½®å‚æ•°æˆ–è€…å–å‡ºç»“æœé›†çš„æ—¶å€™è‡ªå®šä¹‰å‚æ•°å°è£…ç­–ç•¥ã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>å®ç°TypeHandleræ¥å£æˆ–è€…ç»§æ‰¿BaseTypeHandler</li><li>ä½¿ç”¨@MappedTypeså®šä¹‰å¤„ç†çš„javaç±»å‹ï¼Œä½¿ç”¨@MappedJdbcTypeså®šä¹‰jdbcTypeç±»å‹</li><li>åœ¨è‡ªå®šä¹‰ç»“æœé›†æ ‡ç­¾æˆ–è€…å‚æ•°å¤„ç†çš„æ—¶å€™å£°æ˜ä½¿ç”¨è‡ªå®šä¹‰TypeHandlerè¿›è¡Œå¤„ç†æˆ–è€…åœ¨å…¨å±€é…ç½®TypeHandlerè¦å¤„ç†çš„javaTypeã€‚</li></ol><hr><p>ç¤ºä¾‹ï¼šå¸Œæœ›æ•°æ®åº“ä¿å­˜çš„æ˜¯100,200è¿™äº›çŠ¶æ€ç ï¼Œè€Œä¸æ˜¯é»˜è®¤0,1æˆ–è€…æšä¸¾çš„åå­—</p><p><a href="src/main/java/com/lun/c09/other/bean/EmpStatus.java">EmpStatus.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EmpStatus</span> &#123;</span><br><span class="line">	LOGIN(<span class="number">100</span>,<span class="string">&quot;ç”¨æˆ·ç™»å½•&quot;</span>),LOGOUT(<span class="number">200</span>,<span class="string">&quot;ç”¨æˆ·ç™»å‡º&quot;</span>),REMOVE(<span class="number">300</span>,<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">EmpStatus</span><span class="params">(Integer code,String msg)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.code = code;</span><br><span class="line">		<span class="built_in">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//æŒ‰ç…§çŠ¶æ€ç è¿”å›æšä¸¾å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> EmpStatus <span class="title function_">getEmpStatusByCode</span><span class="params">(Integer code)</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (code) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGIN;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGOUT;	</span><br><span class="line">			<span class="keyword">case</span> <span class="number">300</span>:</span><br><span class="line">				<span class="keyword">return</span> REMOVE;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGOUT;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c09/other/typehandler/MyEnumEmpStatusTypeHandler.java">è‡ªå®šä¹‰Handler</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyEnumEmpStatusTypeHandler</span> <span class="keyword">implements</span> <span class="title class_">TypeHandler</span>&lt;EmpStatus&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å®šä¹‰å½“å‰æ•°æ®å¦‚ä½•ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParameter</span><span class="params">(PreparedStatement ps, <span class="type">int</span> i, EmpStatus parameter,</span></span><br><span class="line"><span class="params">			JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">&quot;è¦ä¿å­˜çš„çŠ¶æ€ç ï¼š&quot;</span>+parameter.getCode());</span><br><span class="line">		ps.setString(i, parameter.getCode().toString());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> EmpStatus <span class="title function_">getResult</span><span class="params">(ResultSet rs, String columnName)</span></span><br><span class="line">			<span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//éœ€è¦æ ¹æ®ä»æ•°æ®åº“ä¸­æ‹¿åˆ°çš„æšä¸¾çš„çŠ¶æ€ç è¿”å›ä¸€ä¸ªæšä¸¾å¯¹è±¡</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> rs.getInt(columnName);</span><br><span class="line">		System.out.println(<span class="string">&quot;ä»æ•°æ®åº“ä¸­è·å–çš„çŠ¶æ€ç ï¼š&quot;</span>+code);</span><br><span class="line">		<span class="type">EmpStatus</span> <span class="variable">status</span> <span class="operator">=</span> EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> EmpStatus <span class="title function_">getResult</span><span class="params">(ResultSet rs, <span class="type">int</span> columnIndex)</span></span><br><span class="line">			<span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> rs.getInt(columnIndex);</span><br><span class="line">		System.out.println(<span class="string">&quot;ä»æ•°æ®åº“ä¸­è·å–çš„çŠ¶æ€ç ï¼š&quot;</span>+code);</span><br><span class="line">		<span class="type">EmpStatus</span> <span class="variable">status</span> <span class="operator">=</span> EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> EmpStatus <span class="title function_">getResult</span><span class="params">(CallableStatement cs, <span class="type">int</span> columnIndex)</span></span><br><span class="line">			<span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> cs.getInt(columnIndex);</span><br><span class="line">		System.out.println(<span class="string">&quot;ä»æ•°æ®åº“ä¸­è·å–çš„çŠ¶æ€ç ï¼š&quot;</span>+code);</span><br><span class="line">		<span class="type">EmpStatus</span> <span class="variable">status</span> <span class="operator">=</span> EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>æ³¨å†Œè‡ªå®šä¹‰TypeHandlerï¼š</p><p>1.<a href="src/main/resources/c09/mybatis-config.xml">MyBatiså…¨å±€é…ç½®æ–‡ä»¶</a>ä¸­æ³¨å†Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.lun.c09.other.typehandler.MyEnumEmpStatusTypeHandler&quot;</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">javaType</span>=<span class="string">&quot;com.lun.c09.other.bean.EmpStatus&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>ä¹Ÿå¯ä»¥åœ¨å¤„ç†æŸä¸ªå­—æ®µçš„æ—¶å€™å‘Šè¯‰MyBatisç”¨ä»€ä¹ˆç±»å‹å¤„ç†å™¨</li></ol><ul><li>ä¿å­˜ï¼š<code>#&#123;empStatus,typeHandler=xxxx&#125;</code></li><li>æŸ¥è¯¢ï¼š</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmp&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;empStatus&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empStatus&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;xxxxx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šå¦‚æœåœ¨å‚æ•°ä½ç½®ä¿®æ”¹TypeHandlerï¼Œåº”è¯¥ä¿è¯ä¿å­˜æ•°æ®å’ŒæŸ¥è¯¢æ•°æ®ç”¨çš„TypeHandleræ˜¯ä¸€æ ·çš„ã€‚</p></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>MyBatisç¬”è®°</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://blog.twintea.top/posts/93fcac00.html">https://blog.twintea.top/posts/93fcac00.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>ğŸ¤twinteağŸ¥</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2022-01-28</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2023-03-12</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mybatis/">Mybatis</a></div><div class="post_share"><div class="social-share" data-image="https://static-bed.twintea.top/wallpaper/å£çº¸ç”µè„‘7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/9e256e89.html" title="POMæ–‡ä»¶å¸®åŠ©æ–‡æ¡£"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/66952939_0.jpeg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">POMæ–‡ä»¶å¸®åŠ©æ–‡æ¡£</div></div></a></div><div class="next-post pull-right"><a href="/posts/e545fed0.html" title="SpringMVCç¬”è®°"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/wallhaven-p9ozm9.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">SpringMVCç¬”è®°</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"></div><div class="author_top is-center"><div class="card-info-avatar"></div><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/avatar.jfif" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">ğŸ¤twinteağŸ¥</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/twintea"><i class="fab fa-github"></i><span>ğŸ±â€ğŸFollow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/twintea" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:beyond2galaxy@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">Welcome to my BlogğŸ¥‚</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">MyBatisç¬”è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.1.</span> <span class="toc-text">MyBatisæ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E5%8E%86%E5%8F%B2"><span class="toc-number">1.1.2.</span> <span class="toc-text">MyBatiså†å²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8MyBatis%EF%BC%9F"><span class="toc-number">1.1.3.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨MyBatisï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.2.</span> <span class="toc-text">2.ä¸‹è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-HelloWorld"><span class="toc-number">1.3.</span> <span class="toc-text">3.HelloWorld</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%8E%A5%E5%8F%A3%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">4.æ¥å£å¼ç¼–ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B0%8F%E7%BB%93-1"><span class="toc-number">1.5.</span> <span class="toc-text">5.å°ç»“(1)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-%E5%BC%95%E5%85%A5dtd%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.</span> <span class="toc-text">6.å…¨å±€é…ç½®æ–‡ä»¶-å¼•å…¥dtdçº¦æŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.1.</span> <span class="toc-text">MyBatis-å…¨å±€é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5dtd%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.2.</span> <span class="toc-text">å¼•å…¥dtdçº¦æŸ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-properties-%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.7.</span> <span class="toc-text">7.å…¨å±€é…ç½®æ–‡ä»¶-properties-å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-settings-%E8%BF%90%E8%A1%8C%E6%97%B6%E8%A1%8C%E4%B8%BA%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.8.</span> <span class="toc-text">8.å…¨å±€é…ç½®æ–‡ä»¶-settings-è¿è¡Œæ—¶è¡Œä¸ºè®¾ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-typeAliases-%E5%88%AB%E5%90%8D"><span class="toc-number">1.9.</span> <span class="toc-text">9.å…¨å±€é…ç½®æ–‡ä»¶-typeAliases-åˆ«å</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-typeHandlers-%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.10.</span> <span class="toc-text">10.å…¨å±€é…ç½®æ–‡ä»¶-typeHandlers-ç±»å‹å¤„ç†å™¨ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">1.10.1.</span> <span class="toc-text">æ—¥æœŸç±»å‹çš„å¤„ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-plugins-%E6%8F%92%E4%BB%B6%E7%AE%80%E4%BB%8B"><span class="toc-number">1.11.</span> <span class="toc-text">11.å…¨å±€é…ç½®æ–‡ä»¶-plugins-æ’ä»¶ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-enviroments-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.12.</span> <span class="toc-text">12.å…¨å±€é…ç½®æ–‡ä»¶-enviroments-è¿è¡Œç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#environment-%E6%8C%87%E5%AE%9A%E5%85%B7%E4%BD%93%E7%8E%AF%E5%A2%83"><span class="toc-number">1.12.1.</span> <span class="toc-text">environment-æŒ‡å®šå…·ä½“ç¯å¢ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#transactionManager"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">transactionManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dataSource"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">dataSource</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-databaseIdProvider-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81"><span class="toc-number">1.13.</span> <span class="toc-text">13.å…¨å±€é…ç½®æ–‡ä»¶-databaseIdProvider-å¤šæ•°æ®åº“æ”¯æŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-mappers-sql%E6%98%A0%E5%B0%84%E6%B3%A8%E5%86%8C"><span class="toc-number">1.14.</span> <span class="toc-text">14.å…¨å±€é…ç½®æ–‡ä»¶-mappers-sqlæ˜ å°„æ³¨å†Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E5%B0%8F%E7%BB%93-2"><span class="toc-number">1.15.</span> <span class="toc-text">15.å°ç»“(2)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">1.16.</span> <span class="toc-text">16.æ˜ å°„æ–‡ä»¶-å¢åˆ æ”¹æŸ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CRUD%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-number">1.16.1.</span> <span class="toc-text">CRUDåˆä½“éªŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A6%E5%A4%96"><span class="toc-number">1.16.2.</span> <span class="toc-text">å¦å¤–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-insert-%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC"><span class="toc-number">1.17.</span> <span class="toc-text">17.æ˜ å°„æ–‡ä»¶-insert-è·å–è‡ªå¢ä¸»é”®çš„å€¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-insert-Oracle%E4%BD%BF%E7%94%A8%E5%BA%8F%E5%88%97%E7%94%9F%E6%88%90%E4%B8%BB%E9%94%AE%E6%BC%94%E7%A4%BA"><span class="toc-number">1.18.</span> <span class="toc-text">18.æ˜ å°„æ–‡ä»¶-insert-Oracleä½¿ç”¨åºåˆ—ç”Ÿæˆä¸»é”®æ¼”ç¤º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-oracle%E4%BD%BF%E7%94%A8%EF%BC%89%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-insert-%E8%8E%B7%E5%8F%96%E9%9D%9E%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC-selectKey"><span class="toc-number">1.19.</span> <span class="toc-text">19.(oracleä½¿ç”¨ï¼‰æ˜ å°„æ–‡ä»¶-insert-è·å–éè‡ªå¢ä¸»é”®çš„å€¼-selectKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0-amp-%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0-amp-%E5%91%BD%E5%90%8D%E5%8F%82%E6%95%B0"><span class="toc-number">1.20.</span> <span class="toc-text">20.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å•ä¸ªå‚æ•°&amp;å¤šä¸ªå‚æ•°&amp;å‘½åå‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-POJO-amp-Map-amp-TO"><span class="toc-number">1.21.</span> <span class="toc-text">21.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-POJO&amp;Map&amp;TO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8F%82%E6%95%B0%E5%B0%81%E8%A3%85%E6%89%A9%E5%B1%95%E6%80%9D%E8%80%83"><span class="toc-number">1.22.</span> <span class="toc-text">22.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-å‚æ•°å°è£…æ‰©å±•æ€è€ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8F%82%E6%95%B0%E5%B0%81%E8%A3%85map%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">1.23.</span> <span class="toc-text">23.æºç åˆ†æ-å‚æ•°å¤„ç†-å‚æ•°å°è£…mapçš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E4%B8%8E-%E5%8F%96%E5%80%BC%E5%8C%BA%E5%88%AB"><span class="toc-number">1.24.</span> <span class="toc-text">24.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-#ä¸$å–å€¼åŒºåˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8F%96%E5%80%BC%E6%97%B6%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3%E8%A7%84%E5%88%99"><span class="toc-number">1.25.</span> <span class="toc-text">25.æ˜ å°„æ–‡ä»¶-å‚æ•°å¤„ç†-#å–å€¼æ—¶æŒ‡å®šå‚æ•°ç›¸å…³è§„åˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-%E8%BF%94%E5%9B%9EList"><span class="toc-number">1.26.</span> <span class="toc-text">26.æ˜ å°„æ–‡ä»¶-select-è¿”å›List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-%E8%AE%B0%E5%BD%95%E5%B0%81%E8%A3%85map"><span class="toc-number">1.27.</span> <span class="toc-text">27.æ˜ å°„æ–‡ä»¶-select-è®°å½•å°è£…map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-number">1.28.</span> <span class="toc-text">28.æ˜ å°„æ–‡ä»¶-select-resultMap-è‡ªå®šä¹‰ç»“æœæ˜ å°„è§„åˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.29.</span> <span class="toc-text">29.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7%E5%B0%81%E8%A3%85%E7%BB%93%E6%9E%9C"><span class="toc-number">1.30.</span> <span class="toc-text">30.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-çº§è”å±æ€§å°è£…ç»“æœ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-association%E5%AE%9A%E4%B9%89%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1%E5%B0%81%E8%A3%85%E8%A7%84%E5%88%99"><span class="toc-number">1.31.</span> <span class="toc-text">31.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationå®šä¹‰å…³è”å¯¹è±¡å°è£…è§„åˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-association%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.32.</span> <span class="toc-text">32.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-associationåˆ†æ­¥æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2-amp-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.33.</span> <span class="toc-text">33.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-åˆ†æ­¥æŸ¥è¯¢&amp;å»¶è¿ŸåŠ è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-collection%E5%AE%9A%E4%B9%89%E5%85%B3%E8%81%94%E9%9B%86%E5%90%88%E5%B0%81%E8%A3%85%E8%A7%84%E5%88%99"><span class="toc-number">1.34.</span> <span class="toc-text">34.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionå®šä¹‰å…³è”é›†åˆå°è£…è§„åˆ™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-collection%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2-amp-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.35.</span> <span class="toc-text">35.æ˜ å°„æ–‡ä»¶-select-resultMap-å…³è”æŸ¥è¯¢-collectionåˆ†æ­¥æŸ¥è¯¢&amp;å»¶è¿ŸåŠ è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E4%BC%A0%E9%80%92%E5%A4%9A%E5%88%97%E5%80%BC-amp-fetchType"><span class="toc-number">1.36.</span> <span class="toc-text">36.æ˜ å°„æ–‡ä»¶-select-resultMap-åˆ†æ­¥æŸ¥è¯¢ä¼ é€’å¤šåˆ—å€¼&amp;fetchType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-discriminator%E9%89%B4%E5%88%AB%E5%99%A8"><span class="toc-number">1.37.</span> <span class="toc-text">37.æ˜ å°„æ–‡ä»¶-select-resultMap-discriminatoré‰´åˆ«å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#38-%E5%8A%A8%E6%80%81sql-%E7%AE%80%E4%BB%8B-amp-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.38.</span> <span class="toc-text">38.åŠ¨æ€sql-ç®€ä»‹&amp;ç¯å¢ƒæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#39-%E5%8A%A8%E6%80%81sql-if-%E5%88%A4%E6%96%AD-amp-OGNL"><span class="toc-number">1.39.</span> <span class="toc-text">39.åŠ¨æ€sql-if-åˆ¤æ–­&amp;OGNL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OGNL"><span class="toc-number">1.39.1.</span> <span class="toc-text">OGNL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40-%E5%8A%A8%E6%80%81sql-where-%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.40.</span> <span class="toc-text">40.åŠ¨æ€sql-where-æŸ¥è¯¢æ¡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#41-%E5%8A%A8%E6%80%81sql-trim-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96"><span class="toc-number">1.41.</span> <span class="toc-text">41.åŠ¨æ€sql-trim-è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆªå–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-%E5%8A%A8%E6%80%81sql-choose-%E5%88%86%E6%94%AF%E9%80%89%E6%8B%A9"><span class="toc-number">1.42.</span> <span class="toc-text">42.åŠ¨æ€sql-choose-åˆ†æ”¯é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-%E5%8A%A8%E6%80%81sql-set-%E4%B8%8Eif%E7%BB%93%E5%90%88%E7%9A%84%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0"><span class="toc-number">1.43.</span> <span class="toc-text">43.åŠ¨æ€sql-set-ä¸ifç»“åˆçš„åŠ¨æ€æ›´æ–°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-%E5%8A%A8%E6%80%81sql-foreach-%E9%81%8D%E5%8E%86%E9%9B%86%E5%90%88"><span class="toc-number">1.44.</span> <span class="toc-text">44.åŠ¨æ€sql-foreach-éå†é›†åˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E5%8A%A8%E6%80%81sql-foreach-mysql%E4%B8%8Bforeach%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.45.</span> <span class="toc-text">45.åŠ¨æ€sql-foreach-mysqlä¸‹foreachæ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-%E5%8A%A8%E6%80%81sql-foreach-oracle%E4%B8%8B%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.46.</span> <span class="toc-text">46.åŠ¨æ€sql-foreach-oracleä¸‹æ‰¹é‡æ’å…¥çš„ä¸¤ç§æ–¹å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#47-%E5%8A%A8%E6%80%81sql-foreach-oracle%E4%B8%8Bforeach%E6%89%B9%E9%87%8F%E4%BF%9D%E5%AD%98%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.47.</span> <span class="toc-text">47.åŠ¨æ€sql-foreach-oracleä¸‹foreachæ‰¹é‡ä¿å­˜ä¸¤ç§æ–¹å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#48-%E5%8A%A8%E6%80%81sql-%E5%86%85%E7%BD%AE%E5%8F%82%E6%95%B0-parameter-amp-databaseId"><span class="toc-number">1.48.</span> <span class="toc-text">48.åŠ¨æ€sql-å†…ç½®å‚æ•° _parameter &amp; _databaseId</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#49-%E5%8A%A8%E6%80%81sql-bind-%E7%BB%91%E5%AE%9A%EF%BC%88%E4%B8%8D%E5%B8%B8%E7%94%A8%EF%BC%89"><span class="toc-number">1.49.</span> <span class="toc-text">49.åŠ¨æ€sql-bind-ç»‘å®šï¼ˆä¸å¸¸ç”¨ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#50-%E5%8A%A8%E6%80%81sql-sql-%E6%8A%BD%E5%8F%96%E5%8F%AF%E9%87%8D%E7%94%A8%E7%9A%84sql%E7%89%87%E6%AE%B5"><span class="toc-number">1.50.</span> <span class="toc-text">50.åŠ¨æ€sql-sql-æŠ½å–å¯é‡ç”¨çš„sqlç‰‡æ®µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51-%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.51.</span> <span class="toc-text">51.ç¼“å­˜-ç¼“å­˜ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-%E7%BC%93%E5%AD%98-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%93%E9%AA%8C"><span class="toc-number">1.52.</span> <span class="toc-text">52.ç¼“å­˜-ä¸€çº§ç¼“å­˜ä½“éªŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.52.1.</span> <span class="toc-text">ä¸€çº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%93%E9%AA%8C"><span class="toc-number">1.52.2.</span> <span class="toc-text">ä¸€çº§ç¼“å­˜ä½“éªŒ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E7%BC%93%E5%AD%98-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-number">1.53.</span> <span class="toc-text">53.ç¼“å­˜-ä¸€çº§ç¼“å­˜å¤±æ•ˆçš„å››ç§æƒ…å†µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-%E7%BC%93%E5%AD%98-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.54.</span> <span class="toc-text">54.ç¼“å­˜-äºŒçº§ç¼“å­˜ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#55-%E7%BC%93%E5%AD%98-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8-amp-%E7%BB%86%E8%8A%82"><span class="toc-number">1.55.</span> <span class="toc-text">55.ç¼“å­˜-äºŒçº§ç¼“å­˜ä½¿ç”¨&amp;ç»†èŠ‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#56-%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E6%9C%89%E5%85%B3%E7%9A%84%E8%AE%BE%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%B1%9E%E6%80%A7"><span class="toc-number">1.56.</span> <span class="toc-text">56.ç¼“å­˜-ç¼“å­˜æœ‰å…³çš„è®¾ç½®ä»¥åŠå±æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#57-%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86%E5%9B%BE%E7%A4%BA"><span class="toc-number">1.57.</span> <span class="toc-text">57.ç¼“å­˜-ç¼“å­˜åŸç†å›¾ç¤º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#58-%E7%BC%93%E5%AD%98-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%93%E5%AD%98%E6%95%B4%E5%90%88%E5%8E%9F%E7%90%86-amp-ehcache%E9%80%82%E9%85%8D%E5%8C%85%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.58.</span> <span class="toc-text">58.ç¼“å­˜-ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆåŸç†&amp;ehcacheé€‚é…åŒ…ä¸‹è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#59-%E7%BC%93%E5%AD%98-MyBatis%E6%95%B4%E5%90%88ehcache-amp-%E6%80%BB%E7%BB%93"><span class="toc-number">1.59.</span> <span class="toc-text">59.ç¼“å­˜-MyBatisæ•´åˆehcache&amp;æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60-%E6%95%B4%E5%90%88Spring-%E6%95%B4%E5%90%88%E9%80%82%E9%85%8D%E5%8C%85%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.60.</span> <span class="toc-text">60.æ•´åˆSpring-æ•´åˆé€‚é…åŒ…ä¸‹è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#61-%E6%95%B4%E5%90%88Spring-%E6%89%80%E6%9C%89%E9%9C%80%E8%A6%81%E7%9A%84jar%E5%8C%85%E5%AF%BC%E5%85%A5"><span class="toc-number">1.61.</span> <span class="toc-text">61.æ•´åˆSpring-æ‰€æœ‰éœ€è¦çš„jaråŒ…å¯¼å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-%E6%95%B4%E5%90%88Spring-%E5%BC%95%E5%85%A5MyBatis%E4%B9%8B%E5%89%8D%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.62.</span> <span class="toc-text">62.æ•´åˆSpring-å¼•å…¥MyBatisä¹‹å‰çš„é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-%E6%95%B4%E5%90%88Spring-SpringMVC%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-number">1.63.</span> <span class="toc-text">63.æ•´åˆSpring-SpringMVCé…ç½®æ–‡ä»¶ç¼–å†™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-%E6%95%B4%E5%90%88Spring-Spring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-number">1.64.</span> <span class="toc-text">64.æ•´åˆSpring-Springé…ç½®æ–‡ä»¶ç¼–å†™</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-%E6%95%B4%E5%90%88Spring-Spring%E6%95%B4%E5%90%88MyBatis%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.65.</span> <span class="toc-text">65.æ•´åˆSpring-Springæ•´åˆMyBatiså…³é”®é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66-%E6%95%B4%E5%90%88Spring-%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95"><span class="toc-number">1.66.</span> <span class="toc-text">66.æ•´åˆSpring-æ•´åˆæµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">1.67.</span> <span class="toc-text">MyBatis-ä»£ç ç”Ÿæˆå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">1.67.1.</span> <span class="toc-text">æ·»åŠ ä¾èµ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.67.2.</span> <span class="toc-text">ä½¿ç”¨è¯´æ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.67.3.</span> <span class="toc-text">é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.67.4.</span> <span class="toc-text">ç”Ÿæˆå™¨ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QBC%E9%A3%8E%E6%A0%BC%E7%9A%84%E5%B8%A6%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.67.5.</span> <span class="toc-text">QBCé£æ ¼çš„å¸¦æ¡ä»¶æŸ¥è¯¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.68.</span> <span class="toc-text">MyBatis-å·¥ä½œåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.68.1.</span> <span class="toc-text">å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="toc-number">1.69.</span> <span class="toc-text">MyBatis-æ’ä»¶å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="toc-number">1.69.1.</span> <span class="toc-text">æ’ä»¶å¼€å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%8E%9F%E7%90%86"><span class="toc-number">1.69.2.</span> <span class="toc-text">æ’ä»¶åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Interceptor%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.69.3.</span> <span class="toc-text">Interceptoræ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.69.4.</span> <span class="toc-text">å¸¸ç”¨ä»£ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-PageHelper%E6%8F%92%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%88%86%E9%A1%B5"><span class="toc-number">1.70.</span> <span class="toc-text">æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-PageHelperæ’ä»¶è¿›è¡Œåˆ†é¡µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.71.</span> <span class="toc-text">æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-æ‰¹é‡æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.72.</span> <span class="toc-text">æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-å­˜å‚¨è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-typeHandler%E5%A4%84%E7%90%86%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.73.</span> <span class="toc-text">æ‰©å±•-MyBatiså®ç”¨åœºæ™¯-typeHandlerå¤„ç†æšä¸¾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E8%BA%AB"><span class="toc-number">1.73.1.</span> <span class="toc-text">çƒ­èº«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89TypeHandler"><span class="toc-number">1.73.2.</span> <span class="toc-text">è‡ªå®šä¹‰TypeHandler</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c43bf339.html" title="Sky-User-Centeré¡¹ç›®ä»‹ç»"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/ç”µè„‘å£çº¸70.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Sky-User-Centeré¡¹ç›®ä»‹ç»"></a><div class="content"><a class="title" href="/posts/c43bf339.html" title="Sky-User-Centeré¡¹ç›®ä»‹ç»">Sky-User-Centeré¡¹ç›®ä»‹ç»</a><time datetime="2023-03-08T22:00:00.000Z" title="å‘è¡¨äº 2023-03-08 22:00:00">2023-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8036cfa7.html" title="Sky-User-Centerå¼€å‘ç¬”è®°"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/TIM%E5%9B%BE%E7%89%8720181208144407.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Sky-User-Centerå¼€å‘ç¬”è®°"></a><div class="content"><a class="title" href="/posts/8036cfa7.html" title="Sky-User-Centerå¼€å‘ç¬”è®°">Sky-User-Centerå¼€å‘ç¬”è®°</a><time datetime="2023-03-08T22:00:00.000Z" title="å‘è¡¨äº 2023-03-08 22:00:00">2023-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/41803b43.html" title="é‡ç½®æ•°æ®åº“"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/wallhaven-l3xk6q.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="é‡ç½®æ•°æ®åº“"></a><div class="content"><a class="title" href="/posts/41803b43.html" title="é‡ç½®æ•°æ®åº“">é‡ç½®æ•°æ®åº“</a><time datetime="2023-03-08T22:00:00.000Z" title="å‘è¡¨äº 2023-03-08 22:00:00">2023-03-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"></div><div class="copyright"><span><b>&copy;2023 - 2024</b></span><span><b>&nbsp;&nbsp;By ğŸ¤twinteağŸ¥</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.7.0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯æ‰˜ç®¡äºVercel"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px" title="æœ¬ç«™å·²åœ¨æ¡‚è¿›è¡Œå¤‡æ¡ˆ"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E6%A1%82ICP%E5%A4%87-2022001032%E5%8F%B7-red?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAQjSURBVHjaVNNZbFRlGIDh95w525zpdGa6TVtbykBbyiICxQY0AhYTJUCiiYqGqEEiJhKQmBg0ESPeeCGRENEYb4jhBr0gNQrRlCBiSgyLaSlSaKEs3Wemy+xnzuqFYdD/6rt6ku/N9wue55EcPwWArCgIgkx5ZRuYVxsnJ801Z05f3jY1MRnb/HxHV+uSph9RKq4mhkdwbZVgdQ2SHkPTwgj/h1QUWWi8/tfg/hM/XN/Y2zfaZnkSnuRDtLMsXhBOvrJtya/LlrcdMs1Qb1lVRQmSAEDAsU1kxpgamXp3y+azu1esreK9dyRqs9PIjkW6OsLx7lTV1ld/237s8HRV57MbnvO8CA+e9GCQFTk6Mza+4/0P+t9a9VSEI3uyTH/eR27aB2Ed31Q/Hx1sI6BHOPT13c5Frd0HW9p3HPUQEwAigJW9RDp+bstrOy981nVGLN/7RpHUV70YfXnEAtjxFPasxPDBQXatjzNTdOQXtg983H/51AFFy1KCIg2bNIdC+8270NwmUmelsXqSqHkDK5PDl8iCW0QcnEW+lqCjvcjQuMZ4YnQRTkotQUZu4GkjcfZNv19G011kXw4vayNYNvqCCvSVTciOgABgeuhBGwhgz5zbkI2ff7HUqJiNR2QktbbSYnBYYqbMT/ilKI4SIbT/GcRylbnvLmJ2X8N7tJ7rR8OE/BbliqEYea81WIotmOs02WFpc55Lf0f5/mSI3dsamOgxSX7ZjaALuBmB6M6FnB+S+POCwmOLk1QFFAqZyQWl1YrpiRZJLvDkygyC5NJ1XCax7xYNiTQVEYVIuUulayIcGeLkpw6WK7GuPY/fb2CkhleXIFFe8XPGaKBj9QxLW1Ik0bg8EuT2zRCJYZvZIYepe0EGbvi4bQUJVZhs2phADFYj+df0lBqJUnaekS4SUHXe3jrOnoE2PhSewHfRpfZGgcryIvfHdQruQlLo7Ns6QizqkJ31CIUlqwQJXuWUpDXj6qOsW32HT3YNImll9FwJsb4jyaLmWQ4fa6a+2sQw0ry8YZSiHcPxxXBtMfCv4XkUCrfliWs/fTE31rtTVfv9vsIorvQIniMhqXM4popVcJFVMHMpfMEaLPdxR1Tnna1b1vl6tGntpAjgCTNWONZyIFBR8Ydtr6EgrCI3VySfzZPLBDHyIq5gkpmzcOUmTGMF+bh7M9LYulfWzMmHBzk7Fpq9deWEYxjrtaCMXjWfstp6BCGNXZzBdYqYhogWqkMum4+oBVD0YnP63u/fFqbv1D+M7VSlBbmmK5uYaLYLYwslfwFVAyXQiOfcx3XyyGIM8DDn0lgWyGokHogu/0UJxpL/+f2e569s/CZQZ53OpzJr0+NXludUfb5jVdf7VUGXJUPIZast1S9PeII6jFDT5xMjFwO1S4c8zwTgnwEAxufYSzA67PMAAAAASUVORK5CYII=" alt=""></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="æœ¬ç½‘ç«™æºç ç”±Githubæä¾›å­˜å‚¨ä»“åº“"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.1/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js").then((()=>{pangu.autoSpacingPage()}))}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"><script>(()=>{const t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-vercel.twintea.top/",region:"",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))},o=()=>{"object"!=typeof twikoo?getScript("https://lib.baomitu.com/twikoo/1.6.10/twikoo.all.min.js").then(t):setTimeout(t,0)};btf.loadComment(document.getElementById("twikoo-wrap"),o)})()</script></div><script defer src="/js/kslink.js"></script><script defer src="/js/runtime.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script data-pjax defer src="/js/emoji.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="49" mobile="false" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/canvas-nest.min.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","750ms"),arr[i].setAttribute("data-wow-delay","600ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>