<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>MyBatis笔记 | twintea's blog🐣</title><meta name="author" content="🐤twintea🐥"><meta name="copyright" content="🐤twintea🐥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MyBatis笔记1.简介MyBatis是什么 MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架。 MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。 MyBatis 可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（ Plain Old Java Objects，普通的Java对象）映射成数据库中的记录  MyBat"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis笔记"><meta property="og:url" content="https://blog.twintea.top/posts/93fcac00.html"><meta property="og:site_name" content="twintea&#39;s blog🐣"><meta property="og:description" content="MyBatis笔记1.简介MyBatis是什么 MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架。 MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。 MyBatis 可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（ Plain Old Java Objects，普通的Java对象）映射成数据库中的记录  MyBat"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://static-bed.twintea.top/wallpaper/%E5%A3%81%E7%BA%B8%E7%94%B5%E8%84%917.jpg"><meta property="article:published_time" content="2022-01-28T08:56:00.000Z"><meta property="article:modified_time" content="2023-03-12T22:00:00.000Z"><meta property="article:author" content="🐤twintea🐥"><meta property="article:tag" content="Mybatis"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://static-bed.twintea.top/wallpaper/%E5%A3%81%E7%BA%B8%E7%94%B5%E8%84%917.jpg"><link rel="shortcut icon" href="https://www.emojiall.com/en/header-svg/%F0%9F%90%A3.svg"><link rel="canonical" href="https://blog.twintea.top/posts/93fcac00.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},noticeOutdate:{limitDay:500,position:"top",messagePrev:"It has been",messageNext:"days since the last update, the content of the article may be outdated."},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: 🐤twintea🐥",link:"链接: ",source:"来源: twintea's blog🐣",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"top-right"},source:{justifiedGallery:{js:"https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js",css:"https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,percent:{toc:!0,rightside:!1}}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"MyBatis笔记",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-03-12 22:00:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.getCSS=(e,t=!1)=>new Promise(((o,n)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=e,t&&(a.id=t),a.onerror=n,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,o())},document.head.appendChild(a)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=(new Date).getHours();void 0===t?o<=6||o>=18?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode();const n=saveToLocal.get("aside-status");void 0!==n&&("hide"===n?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"></head><body><link rel="stylesheet" href="/css/progress_bar.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/avatar.jfif" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://static-bed.twintea.top/wallpaper/壁纸电脑7.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="twintea's blog🐣"><span class="site-name">twintea's blog🐣</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i> <span>清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MyBatis笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-28T08:56:00.000Z" title="发表于 2022-01-28 08:56:00">2022-01-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-12T22:00:00.000Z" title="更新于 2023-03-12 22:00:00">2023-03-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Mybatis/">Mybatis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">24.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>112分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="MyBatis笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MyBatis笔记"><a href="#MyBatis笔记" class="headerlink" title="MyBatis笔记"></a>MyBatis笔记</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h2><h3 id="MyBatis是什么"><a href="#MyBatis是什么" class="headerlink" title="MyBatis是什么"></a>MyBatis是什么</h3><ul><li>MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的<strong>持久层框架</strong>。</li><li>MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。</li><li>MyBatis 可以使用简单的XML或注解用于配置和原始映射，将接口和Java的POJO（ Plain Old Java Objects，普通的Java对象）映射成数据库中的记录</li></ul><h3 id="MyBatis历史"><a href="#MyBatis历史" class="headerlink" title="MyBatis历史"></a>MyBatis历史</h3><ul><li>原是Apache的一个开源项目iBatis, 2010年6月这个项目由Apache Software Foundation 迁移到了Google Code，随着开发团队转投Google Code旗下， iBatis3.x正式更名为MyBatis ，代码于2013年11月迁移到Github（下载地址见后）。</li><li>iBatis一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。 iBatis提供的持久层框架包括SQL Maps和Data Access Objects（DAO）</li></ul><h3 id="为什么要使用MyBatis？"><a href="#为什么要使用MyBatis？" class="headerlink" title="为什么要使用MyBatis？"></a>为什么要使用MyBatis？</h3><ul><li>JDBC<ul><li>SQL夹在Java代码块里，耦合度高导致硬编码内伤</li><li>维护不易且实际开发需求中sql是有变化，频繁修改的情况多见</li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/01.png"></p><ul><li>Hibernate和JPA<br>– 长难复杂SQL，对于Hibernate而言处理也不容易<br>– 内部自动生产的SQL，不容易做特殊优化。<br>– 基于全映射的全自动框架，大量字段的POJO进行部分映射时比较困难，导致数据库性能下降。</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/02.png"></p><ul><li>MyBatis是一个半自动化的持久化层框架。<ul><li>对开发人员而言，核心sql还是需要自己优化</li><li>sql和java编码分开，功能边界清晰，一个专注业务、一个专注数据。</li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/03.png"></p><h2 id="2-下载"><a href="#2-下载" class="headerlink" title="2.下载"></a>2.下载</h2><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">MyBatis下载</a></p><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/index.html">MyBatis官网</a></p><h2 id="3-HelloWorld"><a href="#3-HelloWorld" class="headerlink" title="3.HelloWorld"></a>3.HelloWorld</h2><ul><li>在MySQL数据库创建一数据库实例<code>learnmybatis</code>，在其创建一张表</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employee(</span><br><span class="line">	id <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	last_name <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">	gender <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	email <span class="type">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>再插进一条随意数据，用于测试</p><ul><li>创建Maven工程，添加依赖</li></ul><p><a href="pom.xml">pom.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>创建对应的JavaBean</li></ul><p><a href="src/main/java/com/lun/c01/helloworld/bean/Employee.java">Employee.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//getter and setter and toString()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>创建mybatis配置文件，sql映射文件<ul><li>MyBatis 的全局配置文件包含了影响 MyBatis 行为甚深的设置（ settings）和属性（ properties）信息、如数据库连接池信息等。指导着MyBatis进行工作。我们可以参照官方文件的配置示例。</li><li>映射文件的作用就相当于是定义Dao接口的实现类如何工作。这也是<strong>我们使用MyBatis时编写的最多的文件</strong>。</li></ul></li></ul><p>mybatis全局配置文件</p><p><a href="src/main/resources/c01/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta"> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/learnmybatis?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>serverTimezone=CTT&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 将我们写好的sql映射文件（EmployeeMapper.xml）一定要注册到全局配置文件（mybatis-config.xml）中 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;c01/EmployeeMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>sql映射文件</strong></p><p><a href="src/main/resources/c01/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;abc&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">namespace:名称空间;通常指定为接口的全类名</span></span><br><span class="line"><span class="comment">id：唯一标识</span></span><br><span class="line"><span class="comment">resultType：返回值类型</span></span><br><span class="line"><span class="comment">#&#123;id&#125;：从传递过来的参数中取出id值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">public Employee getEmpById(Integer id);</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>测试</li></ul><p><a href="src/test/java/com/lun/c01/helloworld/HelloWorldTest.java">HelloWorldTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> SqlSessionFactory <span class="title function_">getSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;c01/mybatis-config.xml&quot;</span>;</span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 1、根据xml配置文件（全局配置文件）创建一个SqlSessionFactory对象 有数据源一些运行环境信息</span></span><br><span class="line"><span class="comment">	 * 2、sql映射文件；配置了每一个sql，以及sql的封装规则等。 </span></span><br><span class="line"><span class="comment">	 * 3、将sql映射文件注册在全局配置文件中</span></span><br><span class="line"><span class="comment">	 * 4、写代码：</span></span><br><span class="line"><span class="comment">	 * 		1）、根据全局配置文件得到SqlSessionFactory；</span></span><br><span class="line"><span class="comment">	 * 		2）、使用sqlSession工厂，获取到sqlSession对象使用他来执行增删改查</span></span><br><span class="line"><span class="comment">	 * 			一个sqlSession就是代表和数据库的一次会话，用完关闭</span></span><br><span class="line"><span class="comment">	 * 		3）、使用sql的唯一标志来告诉MyBatis执行哪个sql。sql都是保存在sql映射文件中的。</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 2、获取sqlSession实例，能直接执行已经映射的sql语句</span></span><br><span class="line">		<span class="comment">// sql的唯一标识：statement Unique identifier matching the statement to use.</span></span><br><span class="line">		<span class="comment">// 执行sql要用的参数：parameter A parameter object to pass to the statement.</span></span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> openSession.selectOne(</span><br><span class="line">					<span class="string">&quot;abc.getEmpById&quot;</span>, <span class="number">1</span>);</span><br><span class="line">			System.out.println(employee);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4-接口式编程"><a href="#4-接口式编程" class="headerlink" title="4.接口式编程"></a>4.接口式编程</h2><p><strong>日后主要用接口式编程</strong></p><p>HelloWorld-接口式编程</p><ul><li>创建一个Dao接口</li></ul><p><a href="src/main/java/com/lun/c01/helloworld/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.lun.c01.helloworld.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>修改Mapper文件（命名空间，id，returnType）</li></ul><p><a href="src/main/java/com/lun/c01/helloworld/dao/EmployeeMapper.java">EmployeeMapper2.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c01.helloworld.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">namespace:名称空间;指定为接口的全类名</span></span><br><span class="line"><span class="comment">id：唯一标识</span></span><br><span class="line"><span class="comment">resultType：返回值类型</span></span><br><span class="line"><span class="comment">#&#123;id&#125;：从传递过来的参数中取出id值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">public Employee getEmpById(Integer id);</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>测试</li></ul><p><a href="src/test/java/com/lun/c01/helloworld/HelloWorldTest.java">HelloWorldTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="comment">// 1、获取sqlSessionFactory对象</span></span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line">	<span class="comment">// 2、获取sqlSession对象</span></span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 3、获取接口的实现类对象</span></span><br><span class="line">		<span class="comment">//会为接口自动的创建一个代理对象，代理对象去执行增删改查方法</span></span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">		<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> mapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">		System.out.println(mapper.getClass());</span><br><span class="line">		System.out.println(employee);</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-小结-1"><a href="#5-小结-1" class="headerlink" title="5.小结(1)"></a>5.小结(1)</h2><ol><li>接口式编程<ul><li>原生： Dao &#x3D;&#x3D;&#x3D;&#x3D;&gt; DaoImpl</li><li>mybatis： Mapper &#x3D;&#x3D;&#x3D;&#x3D;&gt; xxMapper.xml</li></ul></li><li>SqlSession代表和数据库的一次会话；用完必须关闭；</li><li>SqlSession和connection一样她都是非线程安全。每次使用都应该去获取新的对象。</li><li>mapper接口没有实现类，但是mybatis会为这个接口生成一个代理对象。<br>（将接口和xml进行绑定）<code>EmployeeMapper empMapper = sqlSession.getMapper(EmployeeMapper.class);</code></li><li>两个重要的配置文件：<ul><li>mybatis的全局配置文件：包含数据库连接池信息，事务管理器信息等…系统运行环境信息</li><li>sql映射文件：保存了每一个sql语句的映射信息：将sql抽取出来。</li></ul></li></ol><h2 id="6-全局配置文件-引入dtd约束"><a href="#6-全局配置文件-引入dtd约束" class="headerlink" title="6.全局配置文件-引入dtd约束"></a>6.全局配置文件-引入dtd约束</h2><h3 id="MyBatis-全局配置文件"><a href="#MyBatis-全局配置文件" class="headerlink" title="MyBatis-全局配置文件"></a>MyBatis-全局配置文件</h3><p>MyBatis 的配置文件包含了影响 MyBatis 行为甚深的设置（ settings）和属性（ properties）信息。文档的顶层结构如下：</p><ul><li>configuration 配置<ul><li>properties 属性</li><li>settings 设置</li><li>typeAliases 类型命名</li><li>typeHandlers 类型处理器</li><li>objectFactory 对象工厂</li><li>plugins 插件</li><li>environments 环境<ul><li>environment 环境变量<ul><li>transactionManager 事务管理器</li><li>dataSource 数据源</li></ul></li></ul></li><li>databaseIdProvider 数据库厂商标识</li><li>mappers 映射器</li></ul></li></ul><h3 id="引入dtd约束"><a href="#引入dtd约束" class="headerlink" title="引入dtd约束"></a>引入dtd约束</h3><p>有时Eclipse在编辑全局xml或映射xml时没有编辑提示，这时可手动导入dtd，导入后才有编辑提示</p><p>dtd文件在Mybatis的Jar包的org&#x2F;apache&#x2F;ibatis&#x2F;builder&#x2F;xml，导入前需Mybatis的Jar包中的dtd存放到本地目录</p><p>设置路径：Window -&gt; Preferences -&gt; XML -&gt; XML Catalog -&gt; Add Catalog Entry -&gt;Set URL key and DTD local location</p><h2 id="7-全局配置文件-properties-引入外部配置文件"><a href="#7-全局配置文件-properties-引入外部配置文件" class="headerlink" title="7.全局配置文件-properties-引入外部配置文件"></a>7.全局配置文件-properties-引入外部配置文件</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html">官方文档</a></p><p><a href="src/main/resources/c02/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		1、mybatis可以使用properties来引入外部properties配置文件的内容；</span></span><br><span class="line"><span class="comment">		resource：引入类路径下的资源</span></span><br><span class="line"><span class="comment">		url：引入网络路径或者磁盘路径下的资源</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span> =<span class="string">&quot;dbconfig.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="/LearnMybatis/src/main/resources/c02/dbconfig.properties">dbconfig.properties</a></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/learnmybatis?useUnicode=true&amp;amp;characterEncoding=UTF-8&amp;amp;serverTimezone=CTT</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><p>如果属性在不只一个地方进行了配置，那么 MyBatis 将按照下面的顺序来加载：</p><ul><li>在 properties 元素体内指定的属性首先被读取。</li><li>然后根据 properties 元素中的 resource 属性读取类路径下属性文件或根<br>据 url 属性指定的路径读取属性文件，并覆盖已读取的同名属性。</li><li>最后读取作为方法参数传递的属性，并覆盖已读取的同名属性。</li></ul><h2 id="8-全局配置文件-settings-运行时行为设置"><a href="#8-全局配置文件-settings-运行时行为设置" class="headerlink" title="8.全局配置文件-settings-运行时行为设置"></a>8.全局配置文件-settings-运行时行为设置</h2><p>这是 MyBatis 中极为重要的调整设置，它们会改变MyBatis 的运行时行为。</p><p><a href="src/main/resources/c02/mybatis-config2.xml">mybatis-config2.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		2、settings包含很多重要的设置项</span></span><br><span class="line"><span class="comment">		setting:用来设置每一个设置项</span></span><br><span class="line"><span class="comment">			name：设置项名</span></span><br><span class="line"><span class="comment">			value：设置项取值</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>设置参数</th><th>描述</th><th>有效值</th><th>默认值</th></tr></thead><tbody><tr><td>cacheEnabled</td><td>该配置影响的所有映射器中配置的缓存的全局开关。</td><td>true&#x2F;false</td><td>TRUE</td></tr><tr><td>lazyLoadingEnabled</td><td>延迟加载的全局开关。当开启时。所有关联对象都会延迟加载。特定关联关系中可通过设置fetchType属性来覆盖该项的开关状态。</td><td>true&#x2F;false</td><td>FALSE</td></tr><tr><td>useColumnLabel</td><td>使用列标签代替列名。不同的驱动在这方面会有不同的表现，具体可参考相关驱动文档或通过测试这两种不同的模式来观察所用驱动的结果。</td><td>true&#x2F;false</td><td>TRUE</td></tr><tr><td>defaultStatementTimeout</td><td>设置超时时间,它决定驱动等待数据库响应的秒数。</td><td>Any positive integer</td><td>Not Set (null)</td></tr><tr><td>mapUnderscoreToCamelCase</td><td>是否开启自动驼峰命名规则( camel case )映射即从经典数据库列名A_ COLUMN到经典Java属性名aColumn的类似映射</td><td>true&#x2F;false</td><td>FALSE</td></tr></tbody></table><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#settings">更多设置</a></p><h2 id="9-全局配置文件-typeAliases-别名"><a href="#9-全局配置文件-typeAliases-别名" class="headerlink" title="9.全局配置文件-typeAliases-别名"></a>9.全局配置文件-typeAliases-别名</h2><p>类型别名可为 Java 类型设置一个缩写名字。 它仅用于 XML 配置，意在降低冗余的全限定类名书写。例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Blog&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Comment&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Comment&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Post&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Post&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Section&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Section&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Tag&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Tag&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当这样配置时，Blog 可以用在任何使用 domain.blog.Blog 的地方。</p><p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>每一个在包 domain.blog 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。 比如 domain.blog.Author 的别名为 author；若有注解，则别名为其注解值。见下面的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Alias(&quot;author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Author</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>值得注意的是， MyBatis已经为许多常见的 Java 类型内建<br>了相应的类型别名。<strong>它们都是大小写不敏感的</strong>，我们在起<br>别名的时候千万不要占用已有的别名。</p><table><thead><tr><th>别名</th><th>映射的类型</th><th>别名</th><th>映射的类型</th><th>别名</th><th>映射的类型</th><th></th></tr></thead><tbody><tr><td>_byte</td><td>byte</td><td>string</td><td>String</td><td>date</td><td>Date</td><td></td></tr><tr><td>_long</td><td>long</td><td>byte</td><td>Byte</td><td>decimal</td><td>BigDecimal</td><td></td></tr><tr><td>_short</td><td>short</td><td>long</td><td>Long</td><td>bigdecimal</td><td>BigDecimal</td><td></td></tr><tr><td>_int</td><td>int</td><td>short</td><td>Short</td><td>object</td><td>Object</td><td></td></tr><tr><td>_integer</td><td>int</td><td>int</td><td>Integer</td><td>map</td><td>Map</td><td></td></tr><tr><td>_double</td><td>double</td><td>integer</td><td>Integer</td><td>hashmap</td><td>HashMap</td><td></td></tr><tr><td>_float</td><td>float</td><td>double</td><td>Double</td><td>list</td><td>List</td><td></td></tr><tr><td>_boolean</td><td>boolean</td><td>float</td><td>Float</td><td>arraylist</td><td>ArrayList</td><td></td></tr><tr><td>-</td><td>-</td><td>boolean</td><td>Boolean</td><td>collection</td><td>Collection</td><td></td></tr><tr><td>-</td><td>-</td><td>-</td><td>-</td><td>iterator</td><td>Iterator</td><td></td></tr></tbody></table><p><a href="src/main/resources/c02/mybatis-config3.xml">mybatis-config3.xml</a></p><h2 id="10-全局配置文件-typeHandlers-类型处理器简介"><a href="#10-全局配置文件-typeHandlers-类型处理器简介" class="headerlink" title="10.全局配置文件-typeHandlers-类型处理器简介"></a>10.全局配置文件-typeHandlers-类型处理器简介</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">官方文档</a></p><p>无论是 MyBatis 在预处理语句（ PreparedStatement）中设置一个参数时，还是从结果集中取出一个值时，都会用类型处理器将获取的值以合适的方式转换成 Java 类型。</p><table><thead><tr><th>类型处理器</th><th>Java 类型</th><th>JDBC 类型</th></tr></thead><tbody><tr><td>BooleanTypeHandler</td><td>java.lang.Boolean, boolean</td><td>数据库兼容的 BOOLEAN</td></tr><tr><td>ByteTypeHandler</td><td>java.lang.Byte, byte</td><td>数据库兼容的 NUMERIC 或 BYTE</td></tr><tr><td>ShortTypeHandler</td><td>java.lang.Short, short</td><td>数据库兼容的 NUMERIC 或 SHORT INTEGER</td></tr><tr><td>IntegerTypeHandler</td><td>java.lang.Integer, int</td><td>数据库兼容的 NUMERIC 或 INTEGER</td></tr><tr><td>LongTypeHandler</td><td>java.lang.Long, long</td><td>数据库兼容的 NUMERIC 或 LONG INTEGER</td></tr><tr><td>FloatTypeHandler</td><td>java.lang.Float, float</td><td>数据库兼容的 NUMERIC 或 FLOAT</td></tr><tr><td>DoubleTypeHandler</td><td>java.lang.Double, double</td><td>数据库兼容的 NUMERIC 或 DOUBLE</td></tr><tr><td>BigDecimalTypeHandler</td><td>java.math.BigDecimal</td><td>数据库兼容的 NUMERIC 或 DECIMAL</td></tr><tr><td>StringTypeHandler</td><td>java.lang.String</td><td>CHAR, VARCHAR</td></tr></tbody></table><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">more</a></p><h3 id="日期类型的处理"><a href="#日期类型的处理" class="headerlink" title="日期类型的处理"></a>日期类型的处理</h3><ul><li>日期和时间的处理， JDK1.8以前一直是个头疼的问题。我们通常使用JSR310规范领导者Stephen Colebourne创建的Joda-Time来操作。 1.8已经实现全部的JSR310规范了。</li><li>日期时间处理上，我们可以使用MyBatis基于JSR310（ Date and Time API）编写的各种日期时间类型处理器。</li><li>MyBatis3.4以前的版本需要我们手动注册这些处理器，以后的版本都是自动注册的</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.InstantTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.LocalDateTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.LocalDateTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.LocalTime TypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.0ffsetDateTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.OffsetTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.ZonedDateTimeTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.YearTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.MonthTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.YearMonthTypeHandler&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.JapaneseDateTypeHandler&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="自定义类型处理器"><a href="#自定义类型处理器" class="headerlink" title="自定义类型处理器"></a>自定义类型处理器</h3><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#typeHandlers">自定义类型处理器示例</a></p><p>我们可以重写类型处理器或创建自己的类型处理器来处理不支持的或非标准的类型。</p><p>步骤：</p><ol><li>实现<code>org.apache.ibatis.type.TypeHandler</code>接口或者继承<code>org.apache.ibatis.type.BaseTypeHandler</code></li><li>指定其映射某个JDBC类型（可选操作）</li><li>在mybatis全局配置文件中注册</li></ol><h2 id="11-全局配置文件-plugins-插件简介"><a href="#11-全局配置文件-plugins-插件简介" class="headerlink" title="11.全局配置文件-plugins-插件简介"></a>11.全局配置文件-plugins-插件简介</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#plugins">官方文档</a></p><p>插件是MyBatis提供的一个非常强大的机制，我们可以通过插件来修改MyBatis的一些核心行为。 插件通过动态代理机制，可以介入四大对象的任何一个方法的执行。</p><p>了解mybatis运行原理才能更好开发插件。</p><ul><li><code>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</code></li><li><code>ParameterHandler (getParameterObject, setParameters)</code></li><li><code>ResultSetHandler (handleResultSets, handleOutputParameters)</code></li><li><code>StatementHandler (prepare, parameterize, batch, update, query)</code></li></ul><h2 id="12-全局配置文件-enviroments-运行环境"><a href="#12-全局配置文件-enviroments-运行环境" class="headerlink" title="12.全局配置文件-enviroments-运行环境"></a>12.全局配置文件-enviroments-运行环境</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#environments">enviroments - 官方文档</a></p><ul><li>MyBatis可以配置多种环境，比如开发、测试和生产环境需要有不同的配置。</li><li>每种环境使用一个environment标签进行配置并指定唯一标识符</li><li>可以通过environments标签中的default属性指定一个环境的标识符来快速的切换环境</li></ul><h3 id="environment-指定具体环境"><a href="#environment-指定具体环境" class="headerlink" title="environment-指定具体环境"></a>environment-指定具体环境</h3><ul><li>id：指定当前环境的唯一标识</li><li>transactionManager、和dataSource都必须有</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;dev_mysql&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h4 id="transactionManager"><a href="#transactionManager" class="headerlink" title="transactionManager"></a>transactionManager</h4><ul><li>type： JDBC | MANAGED | 自定义<ul><li>JDBC：使用了 JDBC 的提交和回滚设置，依赖于从数据源得到的连接来管理事务范围。JdbcTransactionFactory</li><li>MANAGED：不提交或回滚一个连接、让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 ManagedTransactionFactory</li><li>自定义：实现TransactionFactory接口， type&#x3D;全类名&#x2F;别名</li></ul></li></ul><h4 id="dataSource"><a href="#dataSource" class="headerlink" title="dataSource"></a>dataSource</h4><ul><li>type： UNPOOLED | POOLED | JNDI | 自定义<ul><li>UNPOOLED：不使用连接池，<br>UnpooledDataSourceFactory</li><li>POOLED：使用连接池， PooledDataSourceFactory</li><li>JNDI： 在EJB 或应用服务器这类容器中查找指定的数据源</li><li>自定义：实现DataSourceFactory接口，定义数据源的获取方式。</li></ul></li></ul><p><strong>实际开发中我们使用Spring管理数据源，并进行事务控制的配置来覆盖上述配置</strong>。</p><h2 id="13-全局配置文件-databaseIdProvider-多数据库支持"><a href="#13-全局配置文件-databaseIdProvider-多数据库支持" class="headerlink" title="13.全局配置文件-databaseIdProvider-多数据库支持"></a>13.全局配置文件-databaseIdProvider-多数据库支持</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#databaseIdProvider">databaseIdProvider - 官方文档</a></p><ul><li>MyBatis 可以根据不同的数据库厂商执行不同的语句。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;SQL Server&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlserver&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;DB2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>Type： DB_VENDOR 使用MyBatis提供的VendorDatabaseIdProvider解析数据库厂商标识。也可以实现DatabaseIdProvider接口来自定义。</li><li>Property-name：数据库厂商标识</li><li>Property-value：为标识起一个别名，方便SQL语句使用databaseId属性引用</li></ul><p>DB_VENDOR - 会通过 DatabaseMetaData#getDatabaseProductName() 返回的字符串进行设置。由于通常情况下这个字符串都非常长而且相同产品的不同版本会返回不同的值，所以<strong>最好通过设置属性别名来使其变短</strong></p><ul><li>databaseId属性在映射xml使用</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">databaseId</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">	select * from employee where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">	select e.* from employee e where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>通过<code>&lt;environments default=&quot;mysql&quot;&gt;</code>切换数据库，便能切换SQL</li></ul><p>MyBatis匹配规则如下：</p><ol><li>如果没有配置databaseIdProvider标签，那么databaseId&#x3D;null</li><li>如果配置了databaseIdProvider标签，使用标签配置的name去匹配数据库信息，匹配上设置databaseId&#x3D;配置指定的值，否则依旧为null</li><li>如果databaseId不为null，他只会找到配置databaseId的sql语句</li><li>MyBatis 会加载不带 databaseId 属性和带有匹配当前数据库 databaseId 属性的所有语句。如果同时找到带有 databaseId 和不带 databaseId 的相同语句， 则后者会被舍弃。</li></ol><h2 id="14-全局配置文件-mappers-sql映射注册"><a href="#14-全局配置文件-mappers-sql映射注册" class="headerlink" title="14.全局配置文件-mappers-sql映射注册"></a>14.全局配置文件-mappers-sql映射注册</h2><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要来定义 SQL 映射语句了。 但首先，我们需要告诉 MyBatis 到哪里去找到这些语句。 在自动查找资源方面，Java 并没有提供一个很好的解决方案，所以<strong>最好的办法是直接告诉 MyBatis 到哪里去找映射文件</strong>。 你可以使用相对于类路径的资源引用，或完全限定资源定位符（包括 file:&#x2F;&#x2F;&#x2F; 形式的 URL），或类名和包名等。例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用完全限定资源定位符（URL） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">注册接口</span></span><br><span class="line"><span class="comment">class：引用（注册）接口，</span></span><br><span class="line"><span class="comment">	1、有sql映射文件，映射文件名必须和接口同名，并且放在与接口同一目录下；</span></span><br><span class="line"><span class="comment">	2、没有sql映射文件，所有的sql都是利用注解写在接口上;</span></span><br><span class="line"><span class="comment">	推荐：</span></span><br><span class="line"><span class="comment">		比较重要的，复杂的Dao接口我们来写sql映射文件</span></span><br><span class="line"><span class="comment">		不重要，简单的Dao接口为了开发快速可以使用注解；</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.BlogMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.PostMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这些配置会告诉 MyBatis 去哪里找映射文件</p><h2 id="15-小结-2"><a href="#15-小结-2" class="headerlink" title="15.小结(2)"></a>15.小结(2)</h2><p>注意mybatis全局配置文件中的标签顺序，需要按以下顺序排列，否则抛异常</p><ul><li>configuration 配置<ul><li>properties 属性</li><li>settings 设置</li><li>typeAliases 类型命名</li><li>typeHandlers 类型处理器</li><li>objectFactory 对象工厂</li><li>plugins 插件</li><li>environments 环境<ul><li>environment 环境变量<ul><li>transactionManager 事务管理器</li><li>dataSource 数据源</li></ul></li></ul></li><li>databaseIdProvider 数据库厂商标识</li><li>mappers 映射器</li></ul></li></ul><h2 id="16-映射文件-增删改查"><a href="#16-映射文件-增删改查" class="headerlink" title="16.映射文件-增删改查"></a>16.映射文件-增删改查</h2><p>映射文件指导着MyBatis如何进行数据库增删改查，有着非常重要的意义；</p><ul><li>cache –命名空间的二级缓存配置</li><li>cache-ref – 其他命名空间缓存配置的引用。</li><li>resultMap – 自定义结果集映射</li><li>parameterMap – <strong>已废弃</strong>！老式风格的参数映射</li><li>sql –抽取可重用语句块。</li><li>insert – 映射插入语句</li><li>update – 映射更新语句</li><li>delete – 映射删除语句</li><li>select – 映射查询语句</li></ul><h3 id="CRUD初体验"><a href="#CRUD初体验" class="headerlink" title="CRUD初体验"></a>CRUD初体验</h3><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Long <span class="title function_">addEmp</span><span class="params">(Employee employee)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateEmp</span><span class="params">(Employee employee)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public void addEmp(Employee employee); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">		insert into employee(last_name,email,gender) </span><br><span class="line">		values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void updateEmp(Employee employee);  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmp&quot;</span>&gt;</span></span><br><span class="line">		update employee </span><br><span class="line">		set last_name=#&#123;lastName&#125;,email=#&#123;email&#125;,gender=#&#123;gender&#125;</span><br><span class="line">		where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- public void deleteEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteEmpById&quot;</span>&gt;</span></span><br><span class="line">		delete from employee where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCrud</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">newEmployee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="literal">null</span>,<span class="string">&quot;kuang&quot;</span>,<span class="string">&quot;kuang@163.com&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//增</span></span><br><span class="line">			<span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> mapper.addEmp(newEmployee);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//查</span></span><br><span class="line">			System.out.println(<span class="string">&quot;After creating : &quot;</span> + mapper.getEmpById(newEmployee.getId()));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//改</span></span><br><span class="line">			newEmployee.setGender(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">			mapper.updateEmp(newEmployee);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//查</span></span><br><span class="line">			System.out.println(<span class="string">&quot;After updating : &quot;</span> + mapper.getEmpById(newEmployee.getId()));</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//删</span></span><br><span class="line">			mapper.deleteEmpById(newEmployee.getId());</span><br><span class="line">			System.out.println(<span class="string">&quot;After deleting : &quot;</span> + mapper.getEmpById(newEmployee.getId()));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="另外"><a href="#另外" class="headerlink" title="另外"></a>另外</h3><ol><li>mybatis允许增删改直接定义以下类型返回值<ul><li>Integer、Long、Boolean、void</li></ul></li><li>我们需要手动提交数据<ul><li>sqlSessionFactory.openSession();&#x3D;&#x3D;&#x3D;》手动提交</li><li>sqlSessionFactory.openSession(true);&#x3D;&#x3D;&#x3D;》自动提交</li></ul></li></ol><h2 id="17-映射文件-insert-获取自增主键的值"><a href="#17-映射文件-insert-获取自增主键的值" class="headerlink" title="17.映射文件-insert-获取自增主键的值"></a>17.映射文件-insert-获取自增主键的值</h2><ul><li>parameterType：参数类型，可以省略，</li><li>获取自增主键的值：<ul><li>mysql支持自增主键，自增主键值的获取，mybatis也是利用statement.getGenreatedKeys()；</li><li>useGeneratedKeys&#x3D;”true”；使用自增主键获取主键值策略</li><li>keyProperty；指定对应的主键属性，也就是mybatis获取到主键值以后，将这个值封装给javaBean的哪个属性</li></ul></li></ul><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- public void addEmp(Employee employee); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">	insert into employee(last_name,email,gender) </span><br><span class="line">	values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="18-映射文件-insert-Oracle使用序列生成主键演示"><a href="#18-映射文件-insert-Oracle使用序列生成主键演示" class="headerlink" title="18.映射文件-insert-Oracle使用序列生成主键演示"></a>18.映射文件-insert-Oracle使用序列生成主键演示</h2><ul><li>Oracle不支持自增；Oracle使用序列来模拟自增；</li><li>每次插入的数据的主键是从序列中拿到的值；如何获取到这个值；</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#从序列获取新主键值</span><br><span class="line"><span class="keyword">select</span> employee_seq.nextval <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><h2 id="19-oracle使用）映射文件-insert-获取非自增主键的值-selectKey"><a href="#19-oracle使用）映射文件-insert-获取非自增主键的值-selectKey" class="headerlink" title="19.(oracle使用）映射文件-insert-获取非自增主键的值-selectKey"></a>19.(oracle使用）映射文件-insert-获取非自增主键的值-selectKey</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	keyProperty:查出的主键值封装给javaBean的哪个属性</span></span><br><span class="line"><span class="comment">	order=&quot;BEFORE&quot;:当前sql在插入sql之前运行</span></span><br><span class="line"><span class="comment">		   AFTER：当前sql在插入sql之后运行</span></span><br><span class="line"><span class="comment">	resultType:查出的数据的返回值类型</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	BEFORE运行顺序：</span></span><br><span class="line"><span class="comment">		先运行selectKey查询id的sql；查出id值封装给javaBean的id属性</span></span><br><span class="line"><span class="comment">		在运行插入的sql；就可以取出id属性对应的值</span></span><br><span class="line"><span class="comment">	AFTER运行顺序：</span></span><br><span class="line"><span class="comment">		先运行插入的sql（从序列中取出新值作为id）；</span></span><br><span class="line"><span class="comment">		再运行selectKey查询id的sql；</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;BEFORE&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Integer&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 编写查询主键的sql语句 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- BEFORE--&gt;</span></span><br><span class="line">		select EMPLOYEES_SEQ.nextval from dual </span><br><span class="line">		<span class="comment">&lt;!-- AFTER：</span></span><br><span class="line"><span class="comment">		 select EMPLOYEES_SEQ.currval from dual --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 插入时的主键是从序列中拿到的 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- BEFORE:--&gt;</span></span><br><span class="line">	insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span><br><span class="line">	values(#&#123;id&#125;,#&#123;lastName&#125;,#&#123;email<span class="comment">&lt;!-- ,jdbcType=NULL --&gt;</span>&#125;) </span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- AFTER：</span></span><br><span class="line"><span class="comment">	insert into employees(EMPLOYEE_ID,LAST_NAME,EMAIL) </span></span><br><span class="line"><span class="comment">	values(employees_seq.nextval,#&#123;lastName&#125;,#&#123;email&#125;) --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>selectKey 元素的属性</strong></p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>keyProperty</td><td>selectKey 语句结果应该被设置到的目标属性。如果生成列不止一个，可以用逗号分隔多个属性名称。</td></tr><tr><td>keyColumn</td><td>返回结果集中生成列属性的列名。如果生成列不止一个，可以用逗号分隔多个属性名称。</td></tr><tr><td>resultType</td><td>结果的类型。通常 MyBatis 可以推断出来，但是为了更加准确，写上也不会有什么问题。MyBatis 允许将任何简单类型用作主键的类型，包括字符串。如果生成列不止一个，则可以使用包含期望属性的 Object 或 Map。</td></tr><tr><td>order</td><td>可以设置为 BEFORE 或 AFTER。如果设置为 BEFORE，那么它首先会生成主键，设置 keyProperty 再执行插入语句。如果设置为 AFTER，那么先执行插入语句，然后是 selectKey 中的语句 - 这和 Oracle 数据库的行为相似，在插入语句内部可能有嵌入索引调用。</td></tr><tr><td>statementType</td><td>和前面一样，MyBatis 支持 STATEMENT，PREPARED 和 CALLABLE 类型的映射语句，分别代表 Statement, PreparedStatement 和 CallableStatement 类型。</td></tr></tbody></table><h2 id="20-映射文件-参数处理-单个参数-amp-多个参数-amp-命名参数"><a href="#20-映射文件-参数处理-单个参数-amp-多个参数-amp-命名参数" class="headerlink" title="20.映射文件-参数处理-单个参数&amp;多个参数&amp;命名参数"></a>20.映射文件-参数处理-单个参数&amp;多个参数&amp;命名参数</h2><ul><li>单个参数：mybatis不会做特殊处理，<ul><li><code>#&#123;参数名/任意名&#125;</code>：取出参数值。</li></ul></li><li>多个参数：mybatis会做特殊处理。<ul><li>通常操作：<ul><li>方法：public Employee getEmpByIdAndLastName(Integer id,String lastName);</li><li>取值：<code>#&#123;id&#125;</code>,<code>#&#123;lastName&#125;</code></li></ul></li><li>上述操作会抛出异常：<code>org.apache.ibatis.binding.BindingException: Parameter &#39;id&#39; not found. Available parameters are [1, 0, param1, param2]</code></li><li>多个参数会被封装成 一个map，<ul><li>key：param1…paramN,或者参数的索引也可以</li><li>value：传入的参数值</li></ul></li><li><code>#&#123;&#125;</code>就是从map中获取指定的key的值；</li></ul></li><li>【命名参数】：明确指定封装参数时map的key；@Param(“id”)<ul><li>多个参数会被封装成 一个map，<ul><li>key：使用@Param注解指定的值</li><li>value：参数值</li></ul></li><li><code>#&#123;指定的key&#125;</code>取出对应的参数值</li></ul></li></ul><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParameters</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1. </span></span><br><span class="line">		<span class="comment">//单个参数：mybatis不会做特殊处理</span></span><br><span class="line">		System.out.println(mapper.getEmpById2(<span class="number">1</span>));</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2.</span></span><br><span class="line">		<span class="comment">//多个参数，未作处理 ，mapper直用#&#123;id&#125;,#&#123;lastName&#125;会抛异常 </span></span><br><span class="line">		<span class="keyword">try</span> &#123;				</span><br><span class="line">			System.out.println(mapper.getEmpByIdAndLastName(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">			<span class="comment">//org.apache.ibatis.exceptions.PersistenceException: </span></span><br><span class="line">			<span class="comment">//### Error querying database.  Cause: org.apache.ibatis.binding.BindingException: Parameter &#x27;id&#x27; not found. Available parameters are [0, 1, param1, param2]</span></span><br><span class="line">			<span class="comment">//### Cause: org.apache.ibatis.binding.BindingException: Parameter &#x27;id&#x27; not found. Available parameters are [0, 1, param1, param2]</span></span><br><span class="line">		&#125;<span class="keyword">catch</span>(PersistenceException ex) &#123;</span><br><span class="line">			System.err.println(ex);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//多个参数会被封装成 一个map</span></span><br><span class="line">		<span class="comment">//key：param1...paramN,或者参数的索引0, 1..也可以(这种方法的可读性较差)</span></span><br><span class="line">		<span class="comment">//value：传入的参数值</span></span><br><span class="line">		System.out.println(mapper.getEmpByIdAndLastName2(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">		System.out.println(mapper.getEmpByIdAndLastName3(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3. </span></span><br><span class="line">		<span class="comment">//【命名参数】：明确指定封装参数时map的key；@Param(&quot;id&quot;)</span></span><br><span class="line">		System.out.println(mapper.getEmpByIdAndLastName4(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>));</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 多个参数，不能直写id或lastName，否则抛出 org.apache.ibatis.binding.BindingException: Parameter &#x27;id&#x27; not found. Available parameters are [1, 0, param1, param2]--&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from tbl_employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;0&#125; and last_name=#&#123;1&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName3&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;param1&#125; and last_name=#&#123;param2&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdAndLastName4&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName</span><span class="params">(Integer id, String name)</span>;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName2</span><span class="params">(Integer id, String name)</span>;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName3</span><span class="params">(Integer id, String name)</span>;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdAndLastName4</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id,// </span></span><br><span class="line"><span class="params">										<span class="meta">@Param(&quot;lastName&quot;)</span>String name)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="21-映射文件-参数处理-POJO-amp-Map-amp-TO"><a href="#21-映射文件-参数处理-POJO-amp-Map-amp-TO" class="headerlink" title="21.映射文件-参数处理-POJO&amp;Map&amp;TO"></a>21.映射文件-参数处理-POJO&amp;Map&amp;TO</h2><ul><li>POJO：如果多个参数正好是我们业务逻辑的数据模型，我们就可以直接传入pojo；<ul><li><code>#&#123;属性名&#125;</code>：取出传入的pojo的属性值</li></ul></li><li>Map：如果多个参数不是业务模型中的数据，没有对应的pojo，不经常使用，为了方便，我们也可以传入map<ul><li><code>#&#123;key&#125;</code>：取出map中对应的值</li></ul></li><li>TO：如果多个参数不是业务模型中的数据，但是经常要使用，推荐来编写一个TO（Transfer Object）数据传输对象，如：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Page&#123;</span><br><span class="line">	<span class="type">int</span> index;</span><br><span class="line">	<span class="type">int</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParameters</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		...</span><br><span class="line">		<span class="comment">//4.</span></span><br><span class="line">		<span class="comment">//传入map</span></span><br><span class="line">		Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">		map.put(<span class="string">&quot;lastName&quot;</span>, <span class="string">&quot;jallen&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;4. &quot;</span> + mapper.getEmpByMap(map));</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- map 作参输入 --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id = #&#123;id&#125; and last_name=#&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="22-映射文件-参数处理-参数封装扩展思考"><a href="#22-映射文件-参数处理-参数封装扩展思考" class="headerlink" title="22.映射文件-参数处理-参数封装扩展思考"></a>22.映射文件-参数处理-参数封装扩展思考</h2><p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;思考&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p><ul><li><p><code>public Employee getEmp(@Param(&quot;id&quot;)Integer id,String lastName);</code></p><ul><li>取值：id&#x3D;&#x3D;&gt;#{id&#x2F;param1} lastName&#x3D;&#x3D;&gt;#{param2}</li></ul></li><li><p><code>public Employee getEmp(Integer id,@Param(&quot;e&quot;)Employee emp);</code></p><ul><li>取值：id&#x3D;&#x3D;&gt;#{param1} lastName&#x3D;&#x3D;&#x3D;&gt;#{param2.lastName&#x2F;e.lastName}</li></ul></li><li><p><strong>特别注意</strong>：如果是Collection（List、Set）类型或者是数组，</p><ul><li>也会特殊处理。也是把传入的list或者数组封装在map中。</li><li>key：Collection（collection）,如果是List还可以使用这个key(list)</li><li><code>public Employee getEmpById(List&lt;Integer&gt; ids);</code><ul><li>取值：取出第一个id的值： #{list[0]}</li></ul></li></ul></li></ul><h2 id="23-源码分析-参数处理-参数封装map的过程"><a href="#23-源码分析-参数处理-参数封装map的过程" class="headerlink" title="23.源码分析-参数处理-参数封装map的过程"></a>23.源码分析-参数处理-参数封装map的过程</h2><p><strong>结合源码，mybatis怎么处理参数</strong></p><ul><li>(@Param(“id”)Integer id,@Param(“lastName”)String lastName);</li><li>ParamNameResolver解析参数封装map的；</li><li>names：{0&#x3D;id, 1&#x3D;lastName}；构造器的时候就确定好了</li></ul><p>确定流程：<br>1.获取每个标了param注解的参数的@Param的值：id，lastName； 赋值给name;<br>2.每次解析一个参数给map中保存信息：（key：参数索引，value：name的值）<br>name的值：<br>标注了param注解：注解的值<br>没有标注：<br>1.全局配置：useActualParamName（jdk1.8）：name&#x3D;参数名<br>2.name&#x3D;map.size()；相当于当前元素的索引<br>{0&#x3D;id, 1&#x3D;lastName,2&#x3D;2}</p><p>args【1，”Tom”,’hello’】:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getNamedParams</span><span class="params">(Object[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">paramCount</span> <span class="operator">=</span> names.size();</span><br><span class="line">    <span class="comment">//1、参数为null直接返回</span></span><br><span class="line">    <span class="keyword">if</span> (args == <span class="literal">null</span> || paramCount == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">//2、如果只有一个元素，并且没有Param注解；args[0]：单个参数直接返回</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hasParamAnnotation &amp;&amp; paramCount == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> args[names.firstKey()];</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//3、多个元素或者有Param标注</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> Map&lt;String, Object&gt; param = <span class="keyword">new</span> <span class="title class_">ParamMap</span>&lt;Object&gt;();</span><br><span class="line">      <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//4、遍历names集合；&#123;0=id, 1=lastName,2=2&#125;</span></span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : names.entrySet()) &#123;</span><br><span class="line">      </span><br><span class="line">      	<span class="comment">//names集合的value作为key;  names集合的key又作为取值的参考args[0]:args【1，&quot;Tom&quot;】:</span></span><br><span class="line">      	<span class="comment">//eg:&#123;id=args[0]:1,lastName=args[1]:Tom,2=args[2]&#125;</span></span><br><span class="line">        param.put(entry.getValue(), args[entry.getKey()]);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// add generic param names (param1, param2, ...)param</span></span><br><span class="line">        <span class="comment">//额外的将每一个参数也保存到map中，使用新的key：param1...paramN</span></span><br><span class="line">        <span class="comment">//效果：有Param注解可以#&#123;指定的key&#125;，或者#&#123;param1&#125;</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">genericParamName</span> <span class="operator">=</span> GENERIC_NAME_PREFIX + String.valueOf(i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// ensure not to overwrite parameter named with @Param</span></span><br><span class="line">        <span class="keyword">if</span> (!names.containsValue(genericParamName)) &#123;</span><br><span class="line">          param.put(genericParamName, args[entry.getKey()]);</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> param;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>总结</strong>：参数多时会封装map，为了不混乱，我们可以使用@Param来指定封装时使用的key；#{key}就可以取出map中的值；</p><h2 id="24-映射文件-参数处理-与-取值区别"><a href="#24-映射文件-参数处理-与-取值区别" class="headerlink" title="24.映射文件-参数处理-#与$取值区别"></a>24.映射文件-参数处理-#与$取值区别</h2><p><code>#&#123;&#125;</code>和<code>$&#123;&#125;</code>都可以获取map中的值或者pojo对象属性的值；</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_employee <span class="keyword">where</span> id<span class="operator">=</span>$&#123;id&#125; <span class="keyword">and</span> last_name<span class="operator">=</span>#&#123;lastName&#125;</span><br><span class="line">#Preparing:</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_employee <span class="keyword">where</span> id<span class="operator">=</span><span class="number">2</span> <span class="keyword">and</span> last_name<span class="operator">=</span>?</span><br></pre></td></tr></table></figure><p><strong>区别</strong>：</p><ul><li><code>#&#123;&#125;</code> : 是以预编译的形式，将参数设置到sql语句中；PreparedStatement；防止sql注入</li><li><code>$&#123;&#125;</code> : 取出的值<strong>直接拼装</strong>在sql语句中；会有安全问题；</li></ul><p>大多情况下，我们去参数的值都应该去使用<code>#&#123;&#125;</code>。</p><p>原生jdbc不支持占位符的地方我们就可以使用<code>$&#123;&#125;</code>进行取值，比如分表、排序。。。；按照年份分表拆分</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> $&#123;<span class="keyword">year</span>&#125;_salary <span class="keyword">where</span> xxx;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_employee <span class="keyword">order</span> <span class="keyword">by</span> $&#123;f_name&#125; $&#123;<span class="keyword">order</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="25-映射文件-参数处理-取值时指定参数相关规则"><a href="#25-映射文件-参数处理-取值时指定参数相关规则" class="headerlink" title="25.映射文件-参数处理-#取值时指定参数相关规则"></a>25.映射文件-参数处理-#取值时指定参数相关规则</h2><p><code>#&#123;&#125;</code>:更丰富的用法：</p><p>规定参数的一些规则：</p><ul><li>javaType、</li><li>jdbcType、</li><li>mode（存储过程）、</li><li>numericScale、</li><li>resultMap、</li><li>typeHandler、</li><li>jdbcTypeName、</li><li>expression（未来准备支持的功能）；</li></ul><p>例如：jdbcType</p><p>jdbcType通常需要在某种特定的条件下被设置：</p><ul><li>在我们数据为null的时候，有些数据库可能不能识别mybatis对null的默认处理。比如Oracle DB（报错）；</li><li>JdbcType OTHER：无效的类型；因为mybatis对所有的null都映射的是原生Jdbc的OTHER类型，Oracle DB不能正确处理;</li></ul><p>由于全局配置中：jdbcTypeForNull&#x3D;OTHER，Oracle DB不支持，两种解决方法：</p><ol><li>在mapper文件中写<code>#&#123;email,jdbcType=NULL&#125;</code>;</li><li>在全局配置文件<code>&lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;NULL&quot;/&gt;</code></li></ol><h2 id="26-映射文件-select-返回List"><a href="#26-映射文件-select-返回List" class="headerlink" title="26.映射文件-select-返回List"></a>26.映射文件-select-返回List</h2><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByLastNameLike(String lastName); --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--resultType：如果返回的是一个集合，要写集合中元素的类型  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByLastNameLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where last_name like #&#123;lastName&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line"><span class="comment">//// return Collection</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByLastNameLike</span><span class="params">(String str)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		List&lt;Employee&gt; result = em.getEmpsByLastNameLike(<span class="string">&quot;%a%&quot;</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line"></span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="27-映射文件-select-记录封装map"><a href="#27-映射文件-select-记录封装map" class="headerlink" title="27.映射文件-select-记录封装map"></a>27.映射文件-select-记录封装map</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//多条记录封装一个map：Map&lt;Integer,Employee&gt;:键是这条记录的主键，值是记录封装后的javaBean</span></span><br><span class="line">	<span class="comment">//@MapKey:告诉mybatis封装这个map的时候使用哪个属性作为map的key</span></span><br><span class="line">	<span class="meta">@MapKey(&quot;lastName&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, Employee&gt; <span class="title function_">getEmpByLastNameLikeReturnMap</span><span class="params">(String lastName)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//返回一条记录的map；key就是列名，值就是对应的值</span></span><br><span class="line">	<span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getEmpByIdReturnMap</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="comment">&lt;!--public Map&lt;Integer, Employee&gt; getEmpByLastNameLikeReturnMap(String lastName);  --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByLastNameLikeReturnMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where last_name like #&#123;lastName&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 	<span class="comment">&lt;!--public Map&lt;String, Object&gt; getEmpByIdReturnMap(Integer id);  --&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdReturnMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line"> 		select * from employee where id=#&#123;id&#125;</span><br><span class="line"> 	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">MapperTest</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMap</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		Map&lt;String, Object&gt; result = em.getEmpByIdReturnMap(<span class="number">1</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;---&quot;</span>);</span><br><span class="line">		Map&lt;String, Employee&gt; result2 = em.getEmpByLastNameLikeReturnMap(<span class="string">&quot;%a%&quot;</span>);</span><br><span class="line">		System.out.println(result2);</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="28-映射文件-select-resultMap-自定义结果映射规则"><a href="#28-映射文件-select-resultMap-自定义结果映射规则" class="headerlink" title="28.映射文件-select-resultMap-自定义结果映射规则"></a>28.映射文件-select-resultMap-自定义结果映射规则</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//自定义结果映射规则</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdWithResultMap</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--自定义某个javaBean的封装规则</span></span><br><span class="line"><span class="comment">	type：自定义规则的Java类型</span></span><br><span class="line"><span class="comment">	id:唯一id方便引用</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--指定主键列的封装规则</span></span><br><span class="line"><span class="comment">		id定义主键会底层有优化；</span></span><br><span class="line"><span class="comment">		column：指定哪一列</span></span><br><span class="line"><span class="comment">		property：指定对应的javaBean属性</span></span><br><span class="line"><span class="comment">		  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 定义普通列封装规则 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 其他不指定的列会自动封装：我们只要写resultMap就把全部的映射规则都写上。 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- resultMap:自定义结果集映射规则；  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Employee getEmpById(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdWithResultMap&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;MySimpleEmp&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMap</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpByIdWithResultMap(<span class="number">1</span>));</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="29-映射文件-select-resultMap-关联查询-环境搭建"><a href="#29-映射文件-select-resultMap-关联查询-环境搭建" class="headerlink" title="29.映射文件-select-resultMap-关联查询-环境搭建"></a>29.映射文件-select-resultMap-关联查询-环境搭建</h2><p>新建类<a href="src/main/java/com/lun/c01/helloworld/bean/Department.java">Department.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String departmentName;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; emps;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//getter and setter and toString()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p>修改类<a href="src/main/java/com/lun/c01/helloworld/bean/Employee.java">Employee.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">private</span> Department department;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//add department&#x27;s getter and setter</span></span><br></pre></td></tr></table></figure><hr><p>创建数据库表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> department(</span><br><span class="line">	id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">	department_name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> department_id <span class="type">int</span>(<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_employee_department </span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(department_id) <span class="keyword">REFERENCES</span> department(id);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> department(department_name) <span class="keyword">values</span> (<span class="string">&#x27;开发部&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> department(department_name) <span class="keyword">values</span> (<span class="string">&#x27;测试部&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="30-映射文件-select-resultMap-关联查询-级联属性封装结果"><a href="#30-映射文件-select-resultMap-关联查询-级联属性封装结果" class="headerlink" title="30.映射文件-select-resultMap-关联查询-级联属性封装结果"></a>30.映射文件-select-resultMap-关联查询-级联属性封装结果</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//联合查询：级联属性封装结果集</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpAndDept</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 联合查询：级联属性封装结果集</span></span><br><span class="line"><span class="comment">	  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDifEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;department.id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;department.departmentName&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  public Employee getEmpAndDept(Integer id);--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDifEmp&quot;</span>&gt;</span></span><br><span class="line">		SELECT</span><br><span class="line">			e.id id,e.last_name last_name,e.gender gender,</span><br><span class="line">			e.department_id department_id, d.department_name department_name </span><br><span class="line">		FROM employee e, department d</span><br><span class="line">		WHERE e.department_id=d.id AND e.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMapAssociation</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpAndDept(<span class="number">1</span>));</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="31-映射文件-select-resultMap-关联查询-association定义关联对象封装规则"><a href="#31-映射文件-select-resultMap-关联查询-association定义关联对象封装规则" class="headerlink" title="31.映射文件-select-resultMap-关联查询-association定义关联对象封装规则"></a>31.映射文件-select-resultMap-关联查询-association定义关联对象封装规则</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//联合查询：级联属性封装结果集</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpAndDept2</span><span class="params">(Integer id)</span>;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><font>注意：使用该方法不写的column和property不会自动封装，因此必须写全，不能偷懒！</font></p><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  association可以指定联合的javaBean对象 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDifEmp2&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--  association可以指定联合的javaBean对象</span></span><br><span class="line"><span class="comment">		property=&quot;dept&quot;：指定哪个属性是联合的对象</span></span><br><span class="line"><span class="comment">		javaType:指定这个属性对象的类型[不能省略]</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  public Employee getEmpAndDept2(Integer id);--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDept2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDifEmp2&quot;</span>&gt;</span></span><br><span class="line">		SELECT</span><br><span class="line">			e.id id,e.last_name last_name,e.gender gender,</span><br><span class="line">			e.department_id department_id, d.department_name department_name </span><br><span class="line">		FROM employee e, department d</span><br><span class="line">		WHERE e.department_id=d.id AND e.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMapAssociation2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpAndDept2(<span class="number">1</span>));</span><br><span class="line">		System.out.println(em.getEmpAndDept2(<span class="number">1</span>).getDepartment());</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="32-映射文件-select-resultMap-关联查询-association分步查询"><a href="#32-映射文件-select-resultMap-关联查询-association分步查询" class="headerlink" title="32.映射文件-select-resultMap-关联查询-association分步查询"></a>32.映射文件-select-resultMap-关联查询-association分步查询</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/DepartmentMapper.java">DepartmentMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Department <span class="title function_">getDeptById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--public Department getDeptById(Integer id);  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span>&gt;</span></span><br><span class="line">		select id,department_name departmentName from department where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;c03/EmployeeMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;c03/DepartmentMapper.xml&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//association分步查询</span></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpByIdStep</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- association分步查询  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 使用association进行分步查询：</span></span><br><span class="line"><span class="comment">		1、先按照员工id查询员工信息</span></span><br><span class="line"><span class="comment">		2、根据查询员工信息中的department_id值去部门表查出部门信息</span></span><br><span class="line"><span class="comment">		3、部门设置到员工中；</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--  id  last_name  email   gender    d_id   --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmpByStep&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- association定义关联对象的封装规则</span></span><br><span class="line"><span class="comment">	 		select:表明当前属性是调用select指定的方法查出的结果</span></span><br><span class="line"><span class="comment">	 		column:指定将哪一列的值传给这个方法</span></span><br><span class="line"><span class="comment">	 		</span></span><br><span class="line"><span class="comment">	 		流程：使用select指定的方法（传入column指定的这列参数的值）查出对象，并封装给property指定的属性</span></span><br><span class="line"><span class="comment">	 	 --&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> </span></span><br><span class="line"><span class="tag">	 		<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">	 		<span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--  public Employee getEmpByIdStep(Integer id);--&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyEmpByStep&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee where id=#&#123;id&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testResultMapAssociation3</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpByIdStep(<span class="number">1</span>));</span><br><span class="line">		System.out.println(em.getEmpByIdStep(<span class="number">1</span>).getDepartment());</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="33-映射文件-select-resultMap-关联查询-分步查询-amp-延迟加载"><a href="#33-映射文件-select-resultMap-关联查询-分步查询-amp-延迟加载" class="headerlink" title="33.映射文件-select-resultMap-关联查询-分步查询&amp;延迟加载"></a>33.映射文件-select-resultMap-关联查询-分步查询&amp;延迟加载</h2><p>我们每次查询Employee对象的时候，都将一起查询出来。部门信息在我们使用的时候再去查询；分段查询的基础之上加上两个配置：</p><p>在全局配置文件中配置，实现<strong>懒加载</strong></p><p><a href="src/main/resources/c03/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		...</span><br><span class="line">		<span class="comment">&lt;!--显示的指定每个我们需要更改的配置的值，即使他是默认的。防止版本更新带来的问题  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>Setting</th><th>Description</th><th>Valid Values</th><th>Default</th></tr></thead><tbody><tr><td>lazyLoadingEnabled</td><td>Globally enables or disables lazy loading. When enabled, all relations will be lazily loaded. This value can be superseded for an specific relation by using the fetchType attribute on it.</td><td>true&#x2F;false</td><td>false</td></tr><tr><td>aggressiveLazyLoading</td><td>When enabled, an object with lazy loaded properties will be loaded entirely upon a call to any of the lazy properties. Otherwise, each property is loaded on demand.</td><td>true&#x2F;false</td><td>true</td></tr></tbody></table><blockquote><p>aggressive<br>英 [əˈɡresɪv] 美 [əˈɡresɪv]<br>adj.<br>好斗的;挑衅的;侵略的;富于攻击性的;气势汹汹的;声势浩大的;志在必得的</p></blockquote><p>PS. 个人认为aggressiveLazyLoading 可防止<strong>懒加载对象链</strong>情况出现。TODO: 待验证</p><h2 id="34-映射文件-select-resultMap-关联查询-collection定义关联集合封装规则"><a href="#34-映射文件-select-resultMap-关联查询-collection定义关联集合封装规则" class="headerlink" title="34.映射文件-select-resultMap-关联查询-collection定义关联集合封装规则"></a>34.映射文件-select-resultMap-关联查询-collection定义关联集合封装规则</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/DepartmentMapper.java">DepartmentMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Department <span class="title function_">getDeptByIdPlus</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	public class Department &#123;</span></span><br><span class="line"><span class="comment">			private Integer id;</span></span><br><span class="line"><span class="comment">			private String departmentName;</span></span><br><span class="line"><span class="comment">			private List&lt;Employee&gt; emps;</span></span><br><span class="line"><span class="comment">	  did  dept_name  ||  eid  last_name  email   gender  </span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	<span class="comment">&lt;!--嵌套结果集的方式，使用collection标签定义关联的集合类型的属性封装规则  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDept&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;did&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			collection定义关联集合类型的属性的封装规则 </span></span><br><span class="line"><span class="comment">			ofType:指定集合里面元素的类型</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 定义这个集合中元素的封装规则 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Department getDeptByIdPlus(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdPlus&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDept&quot;</span>&gt;</span></span><br><span class="line">		SELECT d.id did,d.department_name department_name,</span><br><span class="line">				e.id eid,e.last_name last_name,</span><br><span class="line">				e.email email,e.gender gender</span><br><span class="line">		FROM department d LEFT JOIN employee e ON d.id=e.department_id</span><br><span class="line">		WHERE d.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/DepartmentMapperTest.java">DepartmentMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptByIdPlus</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm</span> <span class="operator">=</span> session.getMapper(DepartmentMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Department</span> <span class="variable">department</span> <span class="operator">=</span> dm.getDeptByIdPlus(<span class="number">1</span>);</span><br><span class="line">			</span><br><span class="line">			System.out.println(department);</span><br><span class="line">			System.out.println(department.getEmps());</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="35-映射文件-select-resultMap-关联查询-collection分步查询-amp-延迟加载"><a href="#35-映射文件-select-resultMap-关联查询-collection分步查询-amp-延迟加载" class="headerlink" title="35.映射文件-select-resultMap-关联查询-collection分步查询&amp;延迟加载"></a>35.映射文件-select-resultMap-关联查询-collection分步查询&amp;延迟加载</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpsByDeptId</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--  public Employee getEmpsByDeptId(Integer departmentId);--&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByDeptId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee where department_id=#&#123;department_id&#125;</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c03/mapper/dao/DepartmentMapper.java">DepartmentMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DepartmentMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Department <span class="title function_">getDeptByIdStep</span><span class="params">(Integer id)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- collection：分段查询 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper.getEmpsByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">		select id,department_name from department where id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/DepartmentMapperTest.java">DepartmentMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptByIdStep</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm</span> <span class="operator">=</span> session.getMapper(DepartmentMapper.class);</span><br><span class="line">			<span class="type">Department</span> <span class="variable">department</span> <span class="operator">=</span> dm.getDeptByIdStep(<span class="number">1</span>);</span><br><span class="line">			</span><br><span class="line">			System.out.println(department);</span><br><span class="line">			System.out.println(department.getEmps());</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="36-映射文件-select-resultMap-分步查询传递多列值-amp-fetchType"><a href="#36-映射文件-select-resultMap-分步查询传递多列值-amp-fetchType" class="headerlink" title="36.映射文件-select-resultMap-分步查询传递多列值&amp;fetchType"></a>36.映射文件-select-resultMap-分步查询传递多列值&amp;fetchType</h2><p>扩展：</p><ul><li>多列的值传递过去：<ul><li>将多列的值封装map传递；<code>column=&quot;&#123;key1=column1,key2=column2&#125;&quot;</code></li></ul></li><li>fetchType&#x3D;”lazy”：表示使用延迟加载；<ul><li>lazy：延迟</li><li>eager：立即</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Department&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;department_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;departmentName&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> </span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper.getEmpsByDeptId&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">column</span>=<span class="string">&quot;&#123;deptId=id&#125;&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- public Department getDeptByIdStep(Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptByIdStep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyDeptStep&quot;</span>&gt;</span></span><br><span class="line">	select id,department_name from department where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="37-映射文件-select-resultMap-discriminator鉴别器"><a href="#37-映射文件-select-resultMap-discriminator鉴别器" class="headerlink" title="37.映射文件-select-resultMap-discriminator鉴别器"></a>37.映射文件-select-resultMap-discriminator鉴别器</h2><p><a href="src/main/java/com/lun/c03/mapper/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//带有鉴别器的</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsWithDiscriminator</span><span class="params">()</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c03/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- =======================鉴别器============================ --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;discriminator javaType=&quot;&quot;&gt;&lt;/discriminator&gt;</span></span><br><span class="line"><span class="comment">		鉴别器：mybatis可以使用discriminator判断某列的值，然后根据某列的值改变封装行为</span></span><br><span class="line"><span class="comment">		封装Employee：</span></span><br><span class="line"><span class="comment">			如果查出的是女生：就把部门信息查询出来，否则不查询；</span></span><br><span class="line"><span class="comment">			如果是男生，把last_name这一列的值赋值给email;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmpDis&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	 		column：指定判定的列名</span></span><br><span class="line"><span class="comment">	 		javaType：列值对应的java类型  --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!--女生  resultType:指定封装的结果类型；不能缺少。/resultMap--&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span> </span></span><br><span class="line"><span class="tag">			 		<span class="attr">select</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">			 		<span class="attr">column</span>=<span class="string">&quot;department_id&quot;</span> <span class="attr">fetchType</span>=<span class="string">&quot;eager&quot;</span> &gt;</span></span><br><span class="line">		 		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!--男生 ;如果是男生，把last_name这一列的值赋值给email; --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		 		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">			 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">			 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">			 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--  public Employee getEmpByIdStep(Integer id);--&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsWithDiscriminator&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;MyEmpDis&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee limit 10</span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c03/mapper/EmployeeMapperTest.java">EmployeeMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsWithDiscriminator</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">		</span><br><span class="line">		System.out.println(em.getEmpsWithDiscriminator());</span><br><span class="line">		</span><br><span class="line">		session.commit();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="38-动态sql-简介-amp-环境搭建"><a href="#38-动态sql-简介-amp-环境搭建" class="headerlink" title="38.动态sql-简介&amp;环境搭建"></a>38.动态sql-简介&amp;环境搭建</h2><ul><li>动态SQL是MyBatis强大特性之一。极大的简化我们拼装SQL的操作。</li><li>动态SQL元素和使用 JSTL 或其他类似基于 XML 的文本处理器相似。</li><li>MyBatis采用功能强大的基于 OGNL 的表达式来简化操作。<ul><li>if</li><li>choose (when, otherwise)</li><li>trim (where, set)</li><li>foreach</li></ul></li></ul><h2 id="39-动态sql-if-判断-amp-OGNL"><a href="#39-动态sql-if-判断-amp-OGNL" class="headerlink" title="39.动态sql-if-判断&amp;OGNL"></a>39.动态sql-if-判断&amp;OGNL</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	<span class="comment">//携带了哪个字段查询条件就带上这个字段的值</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionIf</span><span class="params">(Employee employee)</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- 查询员工，要求，携带了哪个字段查询条件就带上这个字段的值 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionIf(Employee employee); --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee where</span><br><span class="line">	 	<span class="comment">&lt;!-- test：判断表达式（OGNL）</span></span><br><span class="line"><span class="comment">	 	OGNL参照PPT或者官方文档。</span></span><br><span class="line"><span class="comment">	 	  	 c:if  test</span></span><br><span class="line"><span class="comment">	 	从参数中取值进行判断</span></span><br><span class="line"><span class="comment">	 	</span></span><br><span class="line"><span class="comment">	 	遇见特殊符号应该去写转义字符：</span></span><br><span class="line"><span class="comment">	 	&amp;&amp;：</span></span><br><span class="line"><span class="comment">	 	--&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">	 		id=#&#123;id&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">	 		and last_name like #&#123;lastName&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">	 		and email=#&#123;email&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">	 	<span class="comment">&lt;!-- ognl会进行字符串与数字的转换判断  &quot;0&quot;==0 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">	 	 	and gender=#&#123;gender&#125;</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionIf</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionIf(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="OGNL"><a href="#OGNL" class="headerlink" title="OGNL"></a>OGNL</h3><p><a target="_blank" rel="noopener" href="http://commons.apache.org/proper/commons-ognl/language-guide.html">OGNL官方文档</a></p><p>OGNL（ Object Graph Navigation Language ）对象图导航语言， 这是一种强大的表达式语言，通过它可以非常方便的来操作对象属性。 类似于我们的EL， SpEL等。</p><ul><li>访问对象属性： person.name</li><li>调用方法： person.getName()</li><li>调用静态属性&#x2F;方法： @java.lang.Math@PI、@java.util.UUID@randomUUID()</li><li>调用构造方法： new com.lun.Person(‘admin’).name</li><li>运算符： +, -*, &#x2F;, %</li><li>逻辑运算符： in, not in, &gt;, &gt;&#x3D;, &lt;, &lt;&#x3D;, &#x3D;&#x3D;, !&#x3D;</li></ul><p><strong>注意</strong>： xml中特殊符号如”,&gt;,&lt;等这些都需要使用转义字符</p><p>访问集合伪属性：</p><table><thead><tr><th>类型</th><th>伪属性</th><th>伪属性对应的 Java 方法</th></tr></thead><tbody><tr><td>List、 Set、 Map</td><td>size、 isEmpty</td><td>List&#x2F;Set&#x2F;Map.size(),List&#x2F;Set&#x2F;Map.isEmpty()</td></tr><tr><td>List、 Set</td><td>iterator</td><td>List.iterator()、 Set.iterator()</td></tr><tr><td>Map</td><td>keys、 values</td><td>Map.keySet()、 Map.values()</td></tr><tr><td>Iterator</td><td>next、 hasNext</td><td>Iterator.next()、 Iterator.hasNext()</td></tr></tbody></table><h2 id="40-动态sql-where-查询条件"><a href="#40-动态sql-where-查询条件" class="headerlink" title="40.动态sql-where-查询条件"></a>40.动态sql-where-查询条件</h2><p>查询的时候如果某些条件没带可能sql拼装会有问题</p><ol><li>给where后面加上1&#x3D;1，以后的条件都and xxx。</li><li>mybatis使用where标签来将所有的查询条件包括在内。mybatis就会将where标签中拼装的sql，多出来的and或者or去掉（where只会去掉第一个多出来的and或者or，<strong>但最后一个多出来的and或者or则不会去掉</strong>）。</li></ol><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionIfWithWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee</span><br><span class="line">	 	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">		 		id=#&#123;id&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		and last_name like #&#123;lastName&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		and email=#&#123;email&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">		 	<span class="comment">&lt;!-- ognl会进行字符串与数字的转换判断  &quot;0&quot;==0 --&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">		 	 	and gender=#&#123;gender&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionIfWithWhere</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionIfWithWhere</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="literal">null</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionIfWithWhere(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="41-动态sql-trim-自定义字符串截取"><a href="#41-动态sql-trim-自定义字符串截取" class="headerlink" title="41.动态sql-trim-自定义字符串截取"></a>41.动态sql-trim-自定义字符串截取</h2><p>后面多出的and或者or where标签不能解决</p><ul><li>prefix&#x3D;””:前缀：trim标签体中是整个字符串拼串后的结果。<ul><li>prefix给拼串后的整个字符串加一个前缀</li></ul></li><li>prefixOverrides&#x3D;””:<ul><li>前缀覆盖： 去掉整个字符串前面多余的字符</li></ul></li><li>suffix&#x3D;””:后缀<ul><li>suffix给拼串后的整个字符串加一个后缀</li></ul></li><li>suffixOverrides&#x3D;””<ul><li>后缀覆盖：去掉整个字符串后面多余的字符</li></ul></li></ul><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionTrim</span><span class="params">(Employee employee)</span>;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsByConditionTrim(Employee employee);  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionTrim&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee</span><br><span class="line">	 	<span class="comment">&lt;!-- 自定义字符串的截取规则 --&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">		 		id=#&#123;id&#125; and</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null <span class="symbol">&amp;amp;</span><span class="symbol">&amp;amp;</span> lastName!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		last_name like #&#123;lastName&#125; and</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null and email.trim()!=<span class="symbol">&amp;quot;</span><span class="symbol">&amp;quot;</span>&quot;</span>&gt;</span></span><br><span class="line">		 		email=#&#123;email&#125; and</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">		 	<span class="comment">&lt;!-- ognl会进行字符串与数字的转换判断  &quot;0&quot;==0 --&gt;</span></span><br><span class="line">		 	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender==0 or gender==1&quot;</span>&gt;</span></span><br><span class="line">		 	 	gender=#&#123;gender&#125;</span><br><span class="line">		 	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		 <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionTrim</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionTrim(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="42-动态sql-choose-分支选择"><a href="#42-动态sql-choose-分支选择" class="headerlink" title="42.动态sql-choose-分支选择"></a>42.动态sql-choose-分支选择</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionChoose</span><span class="params">(Employee employee)</span>;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!-- public List&lt;Employee&gt; getEmpsByConditionChoose(Employee employee); --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsByConditionChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">	 	select * from employee </span><br><span class="line">	 	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">	 		<span class="comment">&lt;!-- 如果带了id就用id查，如果带了lastName就用lastName查;只会进入其中一个 --&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id!=null&quot;</span>&gt;</span></span><br><span class="line">	 				id=#&#123;id&#125;</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null&quot;</span>&gt;</span></span><br><span class="line">	 				last_name like #&#123;lastName&#125;</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span></span><br><span class="line">	 				email = #&#123;email&#125;</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">	 			<span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">	 				gender = 0</span><br><span class="line">	 			<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">	 		<span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionChoose</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionChoose(employee));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="43-动态sql-set-与if结合的动态更新"><a href="#43-动态sql-set-与if结合的动态更新" class="headerlink" title="43.动态sql-set-与if结合的动态更新"></a>43.动态sql-set-与if结合的动态更新</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateEmp</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!--public void updateEmp(Employee employee);  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateEmp&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="comment">&lt;!-- Set标签的使用 --&gt;</span></span><br><span class="line">	 	update employee </span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;lastName!=null&quot;</span>&gt;</span></span><br><span class="line">				last_name=#&#123;lastName&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email!=null&quot;</span>&gt;</span></span><br><span class="line">				email=#&#123;email&#125;,</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender!=null&quot;</span>&gt;</span></span><br><span class="line">				gender=#&#123;gender&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">		where id=#&#123;id&#125; </span><br><span class="line">	<span class="comment">&lt;!-- 		</span></span><br><span class="line"><span class="comment">		Trim：更新拼串</span></span><br><span class="line"><span class="comment">		update tbl_employee </span></span><br><span class="line"><span class="comment">		&lt;trim prefix=&quot;set&quot; suffixOverrides=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="comment">			&lt;if test=&quot;lastName!=null&quot;&gt;</span></span><br><span class="line"><span class="comment">				last_name=#&#123;lastName&#125;,</span></span><br><span class="line"><span class="comment">			&lt;/if&gt;</span></span><br><span class="line"><span class="comment">			&lt;if test=&quot;email!=null&quot;&gt;</span></span><br><span class="line"><span class="comment">				email=#&#123;email&#125;,</span></span><br><span class="line"><span class="comment">			&lt;/if&gt;</span></span><br><span class="line"><span class="comment">			&lt;if test=&quot;gender!=null&quot;&gt;</span></span><br><span class="line"><span class="comment">				gender=#&#123;gender&#125;</span></span><br><span class="line"><span class="comment">			&lt;/if&gt;</span></span><br><span class="line"><span class="comment">		&lt;/trim&gt;</span></span><br><span class="line"><span class="comment">		where id=#&#123;id&#125;  --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateEmp</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>, <span class="string">&quot;jallen2&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">			dsm.updateEmp(employee);</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="44-动态sql-foreach-遍历集合"><a href="#44-动态sql-foreach-遍历集合" class="headerlink" title="44.动态sql-foreach-遍历集合"></a>44.动态sql-foreach-遍历集合</h2><ul><li><p>collection：指定要遍历的集合：</p><ul><li>list类型的参数会特殊处理封装在map中，map的key就叫list</li></ul></li><li><p>item：将当前遍历出的元素赋值给指定的变量</p></li><li><p>separator:每个元素之间的分隔符</p></li><li><p>open：遍历出所有结果拼接一个开始的字符</p></li><li><p>close:遍历出所有结果拼接一个结束的字符</p></li><li><p>index:索引。遍历list的时候是index就是索引，item就是当前值</p><ul><li>遍历map的时候index表示的就是map的key，item就是map的值</li></ul></li><li><p><code>#&#123;变量名&#125;</code>就能取出变量的值也就是当前遍历出的元素</p></li></ul><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionForeach</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span>List&lt;Integer&gt; ids)</span>;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">	 &lt;!--<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmpsByConditionForeach</span><span class="params">(List&lt;Integer&gt; ids)</span>;  --&gt;</span><br><span class="line">	 &lt;select id=<span class="string">&quot;getEmpsByConditionForeach&quot;</span> resultType=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span><br><span class="line">	 	select * from employee</span><br><span class="line">	 	&lt;foreach collection=<span class="string">&quot;ids&quot;</span> item=<span class="string">&quot;item_id&quot;</span> separator=<span class="string">&quot;,&quot;</span></span><br><span class="line">	 		open=<span class="string">&quot;where id in(&quot;</span> close=<span class="string">&quot;)&quot;</span>&gt;</span><br><span class="line">	 		#&#123;item_id&#125;</span><br><span class="line">	 	&lt;/foreach&gt;</span><br><span class="line">	 &lt;/select&gt;</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSQLMapperTest</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpsByConditionForeach</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c04/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DynamicSQLMapper</span> <span class="variable">dsm</span> <span class="operator">=</span> session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			</span><br><span class="line">			System.out.println(dsm.getEmpsByConditionForeach(Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="45-动态sql-foreach-mysql下foreach批量插入的两种方式"><a href="#45-动态sql-foreach-mysql下foreach批量插入的两种方式" class="headerlink" title="45.动态sql-foreach-mysql下foreach批量插入的两种方式"></a>45.动态sql-foreach-mysql下foreach批量插入的两种方式</h2><p><a href="src/main/java/com/lun/c04/dynamicsql/DynamicSQLMapper.java">DynamicSQLMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DynamicSQLMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEmps</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span>List&lt;Employee&gt; emps)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEmps2</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span>List&lt;Employee&gt; emps)</span>;</span><br><span class="line">	</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c04/DynamicSQLMapper.xml">DynamicSQLMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c04.dynamicsql.DynamicSQLMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	 <span class="comment">&lt;!-- 批量保存 --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--public void addEmps(@Param(&quot;emps&quot;)List&lt;Employee&gt; emps);  --&gt;</span></span><br><span class="line">	 <span class="comment">&lt;!--MySQL下批量保存：可以foreach遍历   mysql支持values(),(),()语法--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span>&gt;</span></span><br><span class="line">	 	insert into employee(last_name,email,gender,department_id) </span><br><span class="line">		values</span><br><span class="line">		<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">			(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.department.id&#125;)</span><br><span class="line">		<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span><span class="comment">&lt;!--   --&gt;</span></span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">&lt;!-- 这种方式需要数据库连接属性allowMultiQueries=true；</span></span><br><span class="line"><span class="comment">	 	这种分号分隔多个sql可以用于其他的批量操作（删除，修改） --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps2&quot;</span>&gt;</span></span><br><span class="line">	 	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;;&quot;</span>&gt;</span></span><br><span class="line">	 		insert into employee(last_name,email,gender,department_id)</span><br><span class="line">	 		values(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.department.id&#125;)</span><br><span class="line">	 	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>注意</strong>，MySQL数据库连接属性allowMultiQueries&#x3D;true，才能批量删除，修改数据。（在连接MySQL的URL后添加参数）。</p><hr><p><a href="src/test/java/com/lun/c04/dynamicsql/DynamicSQLMapperTest.java">DynamicSQLMapperTest.java</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class DynamicSQLMapperTest &#123;</span><br><span class="line">	</span><br><span class="line">	@Test</span><br><span class="line">	public void testAddEmps2() throws IOException &#123;</span><br><span class="line">		SqlSessionFactory ssf = Tools.getSqlSessionFactory(&quot;c04/mybatis-config.xml&quot;);</span><br><span class="line">		SqlSession session = ssf.openSession();</span><br><span class="line">		try &#123;</span><br><span class="line">			DynamicSQLMapper dsm = session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			</span><br><span class="line">			dsm.addEmps2(Arrays.asList(new Employee(null, &quot;abc&quot;, null, null),</span><br><span class="line">					new Employee(null, &quot;cba&quot;,null, null)));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@Test</span><br><span class="line">	public void testAddEmps() throws IOException &#123;</span><br><span class="line">		SqlSessionFactory ssf = Tools.getSqlSessionFactory(&quot;c04/mybatis-config.xml&quot;);</span><br><span class="line">		SqlSession session = ssf.openSession();</span><br><span class="line">		try &#123;</span><br><span class="line">			DynamicSQLMapper dsm = session.getMapper(DynamicSQLMapper.class);</span><br><span class="line">			dsm.addEmps(Arrays.asList(new Employee(null, &quot;abc&quot;, null, null),</span><br><span class="line">					new Employee(null, &quot;cba&quot;,null, null)));</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; finally &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><h2 id="46-动态sql-foreach-oracle下批量插入的两种方式"><a href="#46-动态sql-foreach-oracle下批量插入的两种方式" class="headerlink" title="46.动态sql-foreach-oracle下批量插入的两种方式"></a>46.动态sql-foreach-oracle下批量插入的两种方式</h2><p>Oracle数据库批量保存：</p><ul><li>Oracle不支持values(),(),()</li></ul><p>Oracle支持的批量方式:</p><ol><li>多个insert放在begin - end里面</li><li>利用中间表</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 多个<span class="keyword">insert</span>放在<span class="keyword">begin</span> <span class="operator">-</span> <span class="keyword">end</span>里面</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> employees(employee_id,last_name,email) </span><br><span class="line">    <span class="keyword">values</span>(employees_seq.nextval,<span class="string">&#x27;test_001&#x27;</span>,<span class="string">&#x27;test_001@atguigu.com&#x27;</span>);</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> employees(employee_id,last_name,email) </span><br><span class="line">    <span class="keyword">values</span>(employees_seq.nextval,<span class="string">&#x27;test_002&#x27;</span>,<span class="string">&#x27;test_002@atguigu.com&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"># 利用中间表</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employees(employee_id,last_name,email)</span><br><span class="line">   <span class="keyword">select</span> employees_seq.nextval,lastName,email <span class="keyword">from</span>(</span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;test_a_01&#x27;</span> lastName,<span class="string">&#x27;test_a_e01&#x27;</span> email <span class="keyword">from</span> dual</span><br><span class="line">          <span class="keyword">union</span></span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;test_a_02&#x27;</span> lastName,<span class="string">&#x27;test_a_e02&#x27;</span> email <span class="keyword">from</span> dual</span><br><span class="line">          <span class="keyword">union</span></span><br><span class="line">          <span class="keyword">select</span> <span class="string">&#x27;test_a_03&#x27;</span> lastName,<span class="string">&#x27;test_a_e03&#x27;</span> email <span class="keyword">from</span> dual</span><br><span class="line">   );</span><br></pre></td></tr></table></figure><h2 id="47-动态sql-foreach-oracle下foreach批量保存两种方式"><a href="#47-动态sql-foreach-oracle下foreach批量保存两种方式" class="headerlink" title="47.动态sql-foreach-oracle下foreach批量保存两种方式"></a>47.动态sql-foreach-oracle下foreach批量保存两种方式</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmps&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- oracle第一种批量方式 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	&lt;foreach collection=&quot;emps&quot; item=&quot;emp&quot; open=&quot;begin&quot; close=&quot;end;&quot;&gt;</span></span><br><span class="line"><span class="comment">		insert into employees(employee_id,last_name,email) </span></span><br><span class="line"><span class="comment">	    values(employees_seq.nextval,#&#123;emp.lastName&#125;,#&#123;emp.email&#125;);</span></span><br><span class="line"><span class="comment">	&lt;/foreach&gt; </span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- oracle第二种批量方式  --&gt;</span></span><br><span class="line">	insert into employees(employee_id,last_name,email)</span><br><span class="line">	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;union&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">open</span>=<span class="string">&quot;select employees_seq.nextval,lastName,email from(&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">		select #&#123;emp.lastName&#125; lastName,#&#123;emp.email&#125; email from dual</span><br><span class="line">	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="48-动态sql-内置参数-parameter-amp-databaseId"><a href="#48-动态sql-内置参数-parameter-amp-databaseId" class="headerlink" title="48.动态sql-内置参数 _parameter &amp; _databaseId"></a>48.动态sql-内置参数 _parameter &amp; _databaseId</h2><p>不只是方法传递过来的参数可以被用来判断，</p><p>mybatis默认还有<strong>两个内置参数</strong>：</p><ol><li><strong>_parameter</strong>:代表整个参数<ul><li>单个参数：_parameter就是这个参数</li><li>多个参数：参数会被封装为一个map；_parameter就是代表这个map</li></ul></li><li><strong>_databaseId</strong>:如果配置了databaseIdProvider标签。<ul><li>_databaseId就是代表当前数据库的别名oracle</li></ul></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee);  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsTestInnerParameter&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">		select * from tbl_employee</span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">			where last_name like #&#123;_parameter.lastName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span></span><br><span class="line">		select * from employees</span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">			where last_name like #&#123;_parameter.lastName&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="49-动态sql-bind-绑定（不常用）"><a href="#49-动态sql-bind-绑定（不常用）" class="headerlink" title="49.动态sql-bind-绑定（不常用）"></a>49.动态sql-bind-绑定（不常用）</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--public List&lt;Employee&gt; getEmpsTestInnerParameter(Employee employee);  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpsTestInnerParameter&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.atguigu.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- bind：可以将OGNL表达式的值绑定到一个变量中，方便后来引用这个变量的值 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+lastName+&#x27;%&#x27;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">			select * from tbl_employee</span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">				where last_name like #&#123;lastName&#125;<span class="comment">&lt;!-- 这里使用到lastName --&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId==&#x27;oracle&#x27;&quot;</span>&gt;</span></span><br><span class="line">			select * from employees</span><br><span class="line">			<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_parameter!=null&quot;</span>&gt;</span></span><br><span class="line">				where last_name like #&#123;_parameter.lastName&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="50-动态sql-sql-抽取可重用的sql片段"><a href="#50-动态sql-sql-抽取可重用的sql片段" class="headerlink" title="50.动态sql-sql-抽取可重用的sql片段"></a>50.动态sql-sql-抽取可重用的sql片段</h2><p>抽取可重用的sql片段。方便后面引用：</p><ol><li>sql抽取：经常将要查询的列名，或者插入用的列名抽取出来方便引用</li><li>include来引用已经抽取的sql：</li><li>include还可以自定义一些property，sql标签内部就能使用自定义的属性<ul><li>include-property：取值的正确方式${prop},</li><li>不能使用<code>#&#123;&#125;</code>，而使用<code>$&#123;&#125;</code></li></ul></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">sql</span> id<span class="operator">=</span>&quot;userColumns&quot;<span class="operator">&gt;</span> $&#123;alias&#125;.id,$&#123;alias&#125;.username,$&#123;alias&#125;.password <span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">select</span> id<span class="operator">=</span>&quot;selectUsers&quot; resultType<span class="operator">=</span>&quot;map&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">select</span></span><br><span class="line">		<span class="operator">&lt;</span>include refid<span class="operator">=</span>&quot;userColumns&quot;<span class="operator">&gt;</span><span class="operator">&lt;</span>property name<span class="operator">=</span>&quot;alias&quot; <span class="keyword">value</span><span class="operator">=</span>&quot;t1&quot;<span class="operator">/</span><span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>include<span class="operator">&gt;</span>,</span><br><span class="line">		<span class="operator">&lt;</span>include refid<span class="operator">=</span>&quot;userColumns&quot;<span class="operator">&gt;</span><span class="operator">&lt;</span>property name<span class="operator">=</span>&quot;alias&quot; <span class="keyword">value</span><span class="operator">=</span>&quot;t2&quot;<span class="operator">/</span><span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>include<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">from</span> some_table t1</span><br><span class="line">		<span class="keyword">cross</span> <span class="keyword">join</span> some_table t2</span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">select</span><span class="operator">&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span><span class="keyword">sql</span> id<span class="operator">=</span>&quot;insertColumn&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;_databaseId==&#x27;oracle&#x27;&quot;<span class="operator">&gt;</span></span><br><span class="line">		employee_id,last_name,email</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line">	<span class="operator">&lt;</span>if test<span class="operator">=</span>&quot;_databaseId==&#x27;mysql&#x27;&quot;<span class="operator">&gt;</span></span><br><span class="line">		last_name,email,gender,d_id</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>if<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">sql</span><span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;</span><span class="keyword">insert</span> id<span class="operator">=</span>&quot;addEmps&quot;<span class="operator">&gt;</span></span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> tbl_employee(</span><br><span class="line">		<span class="operator">&lt;</span>include refid<span class="operator">=</span>&quot;insertColumn&quot;<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>include<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">!</span><span class="comment">-- 使用地方 --&gt;</span></span><br><span class="line">	) </span><br><span class="line">	<span class="keyword">values</span></span><br><span class="line">	<span class="operator">&lt;</span>foreach collection<span class="operator">=</span>&quot;emps&quot; item<span class="operator">=</span>&quot;emp&quot; separator<span class="operator">=</span>&quot;,&quot;<span class="operator">&gt;</span></span><br><span class="line">		(#&#123;emp.lastName&#125;,#&#123;emp.email&#125;,#&#123;emp.gender&#125;,#&#123;emp.dept.id&#125;)</span><br><span class="line">	<span class="operator">&lt;</span><span class="operator">/</span>foreach<span class="operator">&gt;</span></span><br><span class="line"> <span class="operator">&lt;</span><span class="operator">/</span><span class="keyword">insert</span><span class="operator">&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="51-缓存-缓存介绍"><a href="#51-缓存-缓存介绍" class="headerlink" title="51.缓存-缓存介绍"></a>51.缓存-缓存介绍</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#cache">MyBatis官方文档</a></p><p>MyBatis 包含一个非常强大的查询缓存特性，它可以非常方便地配置和定制。缓存可以极大的提升查询效率。</p><p>MyBatis系统中默认定义了两级缓存，一级缓存和二级缓存。</p><ol><li>默认情况下，只有一级缓存（ SqlSession级别的缓存，也称为本地缓存）开启。</li><li>二级缓存需要手动开启和配置，他是基于namespace级别的缓存。</li><li>为了提高扩展性。 MyBatis定义了缓存接口Cache。我们可以通过实现Cache接口来自定义二级缓存</li></ol><h2 id="52-缓存-一级缓存体验"><a href="#52-缓存-一级缓存体验" class="headerlink" title="52.缓存-一级缓存体验"></a>52.缓存-一级缓存体验</h2><h3 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h3><ul><li>一级缓存(local cache)，即本地缓存，作用域默认为sqlSession。当 Session flush 或 close 后, 该Session 中的所有 Cache 将被清空。</li><li>本地缓存不能被关闭, 但可以调用 clearCache() 来清空本地缓存, 或者改变缓存的作用域.</li><li>在mybatis3.1之后, 可以配置本地缓存的作用域. 在 mybatis.xml 中配置</li></ul><table><thead><tr><th>-</th><th>-</th><th>-</th><th>-</th></tr></thead><tbody><tr><td>localCacheScope</td><td>MyBatis uses local cache to prevent circular references and speed up repeated nested queries. By default (SESSION) all queries executed during a session are cached. If localCacheScope&#x3D;STATEMENT local session will be used just for statement execution, no data will be shared between two different calls to the same SqlSession.</td><td>SESSION&#x2F;STATEMENT</td><td>SESSION</td></tr></tbody></table><h3 id="一级缓存体验"><a href="#一级缓存体验" class="headerlink" title="一级缓存体验"></a>一级缓存体验</h3><p><a href="src/test/java/com/lun/c05/cache/CacheTest.java">CacheTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFirstCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c03/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e1</span> <span class="operator">=</span> em.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e1);</span><br><span class="line">			</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e2</span> <span class="operator">=</span> em.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e2);</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">&quot;e1 == e2 : &quot;</span> + (e1 == e2));</span><br><span class="line">			</span><br><span class="line">			session.commit();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DEBUG 08-02 22:50:35,092 ==&gt;  Preparing: select * from employee where id = ?   (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-02 22:50:35,192 ==&gt; Parameters: 1(Integer)  (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-02 22:50:35,260 &lt;==      Total: 1  (BaseJdbcLogger.java:145) </span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">e1 == e2 : true &lt;-------------e1和e2指向相同的对象</span><br></pre></td></tr></table></figure><h2 id="53-缓存-一级缓存失效的四种情况"><a href="#53-缓存-一级缓存失效的四种情况" class="headerlink" title="53.缓存-一级缓存失效的四种情况"></a>53.缓存-一级缓存失效的四种情况</h2><p>同一次会话期间只要查询过的数据都会保存在当前SqlSession的一个Map中</p><ul><li>key &#x3D; hashCode + 查询的SqlId + 编写的sql查询语句 + 参数</li></ul><p>一级缓存失效的四种情况：</p><ol><li>不同的SqlSession对应不同的一级缓存</li><li>同一个SqlSession但是查询条件不同</li><li>同一个SqlSession两次查询期间执行了任何一次<strong>增删改</strong>操作</li><li>同一个SqlSession两次查询期间手动清空了缓存</li></ol><h2 id="54-缓存-二级缓存介绍"><a href="#54-缓存-二级缓存介绍" class="headerlink" title="54.缓存-二级缓存介绍"></a>54.缓存-二级缓存介绍</h2><ul><li>二级缓存(second level cache)，全局作用域缓存</li><li>二级缓存默认不开启，需要手动配置</li><li>MyBatis提供二级缓存的接口以及实现，缓存实现要求 POJO实现Serializable接口</li><li>二级缓存在 SqlSession 关闭或提交之后才会生效</li><li>使用步骤<ol><li>全局配置文件中开启二级缓存<ul><li><code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code></li></ul></li><li>需要使用二级缓存的映射文件处使用cache配置缓存<ul><li><code>&lt;cache /&gt;</code></li></ul></li><li><strong>注意</strong>： POJO需要实现Serializable接口</li></ol></li></ul><p>cache标签的属性：</p><ul><li>eviction:缓存的回收策略：<ul><li>LRU – 最近最少使用的：移除最长时间不被使用的对象。</li><li>FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</li><li>SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</li><li>WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</li><li>默认的是 LRU。</li></ul></li><li>flushInterval：缓存刷新间隔<ul><li>缓存多长时间清空一次，默认不清空，设置一个毫秒值</li></ul></li><li>readOnly:是否只读：<ul><li>true：只读；mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改数据。mybatis为了加快获取速度，直接就会将数据在缓存中的引用交给用户。不安全，速度快</li><li>false：非只读：mybatis觉得获取的数据可能会被修改。mybatis会利用序列化&amp;反序列的技术克隆一份新的数据给你。安全，速度慢</li></ul></li><li>size：缓存存放多少元素；</li><li>type&#x3D;””：指定自定义缓存的全类名；<ul><li>实现Cache接口即可；</li></ul></li></ul><h2 id="55-缓存-二级缓存使用-amp-细节"><a href="#55-缓存-二级缓存使用-amp-细节" class="headerlink" title="55.缓存-二级缓存使用&amp;细节"></a>55.缓存-二级缓存使用&amp;细节</h2><p>使用步骤:</p><ol><li>全局配置文件中开启二级缓存<ul><li><code>&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</code></li></ul></li><li>需要使用二级缓存的映射文件处使用cache配置缓存<ul><li><code>&lt;cache /&gt;</code></li></ul></li><li><strong>注意</strong>： POJO需要实现Serializable接口</li></ol><p><a href="src/main/resources/c05/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;settings&gt;</span><br><span class="line">		&lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c01/helloworld/bean/Employee.java">Employee.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">7390587151857533202L</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c05/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;60000&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;false&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1024&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c05/cache/CacheTest.java">CacheTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSecondCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c05/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session2</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">em</span> <span class="operator">=</span> session.getMapper(EmployeeMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e1</span> <span class="operator">=</span> em.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e1);</span><br><span class="line">			session.close();</span><br><span class="line">			</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">em2</span> <span class="operator">=</span> session2.getMapper(EmployeeMapper.class);</span><br><span class="line">			<span class="type">Employee</span> <span class="variable">e2</span> <span class="operator">=</span> em2.getEmpById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(e2);</span><br><span class="line">			</span><br><span class="line">			System.out.println(<span class="string">&quot;e1 == e2 : &quot;</span> + (e1 == e2));</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session2.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEBUG 08-03 01:13:02,575 Cache Hit Ratio [com.lun.c03.mapper.dao.EmployeeMapper]: 0.0  (LoggingCache.java:62) </span><br><span class="line">DEBUG 08-03 01:13:03,945 ==&gt;  Preparing: select * from employee where id = ?   (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-03 01:13:04,081 ==&gt; Parameters: 1(Integer)  (BaseJdbcLogger.java:145) </span><br><span class="line">DEBUG 08-03 01:13:04,186 &lt;==      Total: 1  (BaseJdbcLogger.java:145) </span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">DEBUG 08-03 01:13:04,218 Cache Hit Ratio [com.lun.c03.mapper.dao.EmployeeMapper]: 0.5  (LoggingCache.java:62) </span><br><span class="line">Employee [id=1, lastName=jallen2, email=jallen@good.com, gender=1, department=null]</span><br><span class="line">e1 == e2 : false</span><br></pre></td></tr></table></figure><h2 id="56-缓存-缓存有关的设置以及属性"><a href="#56-缓存-缓存有关的设置以及属性" class="headerlink" title="56.缓存-缓存有关的设置以及属性"></a>56.缓存-缓存有关的设置以及属性</h2><ol><li>全局setting的cacheEnable：<br>– 配置二级缓存的开关。一级缓存一直是打开的。</li><li>select标签的useCache属性：<br>– 配置这个select是否使用二级缓存。一级缓存一直是使用的</li><li>每个增删改标签的flushCache属性：<br>– 增删改默认flushCache&#x3D;true。sql执行以后，会同时清空一级和二级缓存。查询默认flushCache&#x3D;false。</li><li>sqlSession.clearCache()：<br>– 只是用来清除一级缓存。</li><li>全局setting的localCacheScope：本地缓存作用域：（一级缓存SESSION），当前会话的所有数据保存在会话缓存中；STATEMENT：可以禁用一级缓存。</li></ol><h2 id="57-缓存-缓存原理图示"><a href="#57-缓存-缓存原理图示" class="headerlink" title="57.缓存-缓存原理图示"></a>57.缓存-缓存原理图示</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/04.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/image-20220217184558739.png" alt="image-20220217184558739"></p><h2 id="58-缓存-第三方缓存整合原理-amp-ehcache适配包下载"><a href="#58-缓存-第三方缓存整合原理-amp-ehcache适配包下载" class="headerlink" title="58.缓存-第三方缓存整合原理&amp;ehcache适配包下载"></a>58.缓存-第三方缓存整合原理&amp;ehcache适配包下载</h2><ul><li>EhCache 是一个纯Java的进程内缓存框架，具有快速、精干等特点，是Hibernate中默认的CacheProvider。</li><li>MyBatis定义了Cache接口方便我们进行自定义扩展。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.ibatis.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line"></span><br><span class="line">  String <span class="title function_">getId</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span>;</span><br><span class="line"></span><br><span class="line">  Object <span class="title function_">getObject</span><span class="params">(Object key)</span>;</span><br><span class="line"></span><br><span class="line">  Object <span class="title function_">removeObject</span><span class="params">(Object key)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line">  </span><br><span class="line">  ReadWriteLock <span class="title function_">getReadWriteLock</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="59-缓存-MyBatis整合ehcache-amp-总结"><a href="#59-缓存-MyBatis整合ehcache-amp-总结" class="headerlink" title="59.缓存-MyBatis整合ehcache&amp;总结"></a>59.缓存-MyBatis整合ehcache&amp;总结</h2><p>步骤：</p><ul><li>加入mybatis-ehcache依赖</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>编写<a href="src/main/resources/ehcache.xml">ehcache.xml</a>配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;../config/ehcache.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- 磁盘保存路径 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;C:\\ehcache&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">defaultCache</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;10000&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">maxElementsOnDisk</span>=<span class="string">&quot;10000000&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span> </span></span><br><span class="line"><span class="tag">   <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">属性说明：</span></span><br><span class="line"><span class="comment">l diskStore：指定数据在磁盘中的存储位置。</span></span><br><span class="line"><span class="comment">l defaultCache：当借助CacheManager.add(&quot;demoCache&quot;)创建Cache时，EhCache便会采用&lt;defalutCache/&gt;指定的的管理策略</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下属性是必须的：</span></span><br><span class="line"><span class="comment">l maxElementsInMemory - 在内存中缓存的element的最大数目 </span></span><br><span class="line"><span class="comment">l maxElementsOnDisk - 在磁盘上缓存的element的最大数目，若是0表示无穷大</span></span><br><span class="line"><span class="comment">l eternal - 设定缓存的elements是否永远不过期。如果为true，则缓存的数据始终有效，如果为false那么还要根据timeToIdleSeconds，timeToLiveSeconds判断</span></span><br><span class="line"><span class="comment">l overflowToDisk - 设定当内存缓存溢出的时候是否将过期的element缓存到磁盘上</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment">以下属性是可选的：</span></span><br><span class="line"><span class="comment">l timeToIdleSeconds - 当缓存在EhCache中的数据前后两次访问的时间超过timeToIdleSeconds的属性取值时，这些数据便会删除，默认值是0,也就是可闲置时间无穷大</span></span><br><span class="line"><span class="comment">l timeToLiveSeconds - 缓存element的有效生命期，默认是0.,也就是element存活时间无穷大</span></span><br><span class="line"><span class="comment"> diskSpoolBufferSizeMB 这个参数设置DiskStore(磁盘缓存)的缓存区大小.默认是30MB.每个Cache都应该有自己的一个缓冲区.</span></span><br><span class="line"><span class="comment">l diskPersistent - 在VM重启的时候是否启用磁盘保存EhCache中的数据，默认是false。</span></span><br><span class="line"><span class="comment">l diskExpiryThreadIntervalSeconds - 磁盘缓存的清理线程运行间隔，默认是120秒。每个120s，相应的线程会进行一次EhCache中数据的清理工作</span></span><br><span class="line"><span class="comment">l memoryStoreEvictionPolicy - 当内存缓存达到最大，有新的element加入的时候， 移除缓存中element的策略。默认是LRU（最近最少使用），可选的有LFU（最不常使用）和FIFO（先进先出）</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br></pre></td></tr></table></figure><ul><li>配置cache标签<code>&lt;cache type=&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;&gt;&lt;/cache&gt;</code></li></ul><hr><p>演示：</p><p><a href="src/main/resources/c05/DepartmentMapper.xml">DepartmentMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c03.mapper.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br><span class="line">	</span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c05/cache/CacheTest.java">CacheTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEhcache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c05/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">session2</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm</span> <span class="operator">=</span> session.getMapper(DepartmentMapper.class);</span><br><span class="line">			<span class="type">Department</span> <span class="variable">dp</span> <span class="operator">=</span> dm.getDeptById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(dp);</span><br><span class="line">			session.close();</span><br><span class="line">			</span><br><span class="line">			<span class="type">DepartmentMapper</span> <span class="variable">dm2</span> <span class="operator">=</span> session2.getMapper(DepartmentMapper.class);</span><br><span class="line">			<span class="type">Department</span> <span class="variable">dp2</span> <span class="operator">=</span> dm2.getDeptById(<span class="number">1</span>);</span><br><span class="line">			System.out.println(dp2);</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			session2.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure><p><strong>另外</strong>：</p><p>参照缓存： 若想在命名空间中共享相同的缓存配置和实例。可以使用 cache-ref 元素来引用另外一个缓存。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.mybatis.dao.DepartmentMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引用缓存：namespace：指定和哪个名称空间下的缓存一样 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.mybatis.dao.EmployeeMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h2 id="60-整合Spring-整合适配包下载"><a href="#60-整合Spring-整合适配包下载" class="headerlink" title="60.整合Spring-整合适配包下载"></a>60.整合Spring-整合适配包下载</h2><p>MyBatis-Spring 会帮助你将 MyBatis 代码无缝地整合到 Spring 中。它将允许 MyBatis 参与到 Spring 的事务管理之中，创建映射器 mapper 和 SqlSession 并注入到 bean 中，以及将 Mybatis 的异常转换为 Spring 的 DataAccessException。最终，可以做到应用代码不依赖于 MyBatis，Spring 或 MyBatis-Spring。</p><p><a target="_blank" rel="noopener" href="http://mybatis.org/spring/zh/index.html">官方文档</a></p><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/spring">源码仓库</a></p><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/jpetstore-6">官方整合示例</a></p><h2 id="61-整合Spring-所有需要的jar包导入"><a href="#61-整合Spring-所有需要的jar包导入" class="headerlink" title="61.整合Spring-所有需要的jar包导入"></a>61.整合Spring-所有需要的jar包导入</h2><p><a href="pom.xml">pom.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- DB连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- JSP --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 用于整合Spring --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="62-整合Spring-引入MyBatis之前的配置"><a href="#62-整合Spring-引入MyBatis之前的配置" class="headerlink" title="62.整合Spring-引入MyBatis之前的配置"></a>62.整合Spring-引入MyBatis之前的配置</h2><p><a href="src/main/resources/c06/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--显示的指定每个我们需要更改的配置的值，即使他是默认的。防止版本更新带来的问题  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c06/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.c06.spring.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"> 	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmps&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c01.helloworld.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select * from employee</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c06/spring/EmployeeMapper.java">EmployeeMapper</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> Employee <span class="title function_">getEmpById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmps</span><span class="params">()</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="63-整合Spring-SpringMVC配置文件编写"><a href="#63-整合Spring-SpringMVC配置文件编写" class="headerlink" title="63.整合Spring-SpringMVC配置文件编写"></a>63.整合Spring-SpringMVC配置文件编写</h2><p><a href="src/main/webapp/WEB-INF/web.xml">web.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--Spring配置： needed for ContextLoaderListener --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Bootstraps the root web application context before servlet initialization --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- SpringMVC配置 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/webapp/WEB-INF/spring-servlet.xml">spring-servlet.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">...</span>&quot;&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--SpringMVC只是控制网站跳转逻辑  --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 只扫描控制器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lun.c06&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="64-整合Spring-Spring配置文件编写"><a href="#64-整合Spring-Spring配置文件编写" class="headerlink" title="64.整合Spring-Spring配置文件编写"></a>64.整合Spring-Spring配置文件编写</h2><p><a href="src/main/resources/c06/applicationContext.xml">applicationContext.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">...</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- Spring希望管理所有的业务逻辑组件，等。。。 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lun.c06&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span></span></span><br><span class="line"><span class="tag">			<span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 引入数据库的配置文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:c04/dbconfig.properties&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Spring用来控制业务逻辑。数据源、事务控制、aop --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- spring事务管理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 开启基于注解的事务 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span></span><br><span class="line">	...</span><br></pre></td></tr></table></figure><h2 id="65-整合Spring-Spring整合MyBatis关键配置"><a href="#65-整合Spring-Spring整合MyBatis关键配置" class="headerlink" title="65.整合Spring-Spring整合MyBatis关键配置"></a>65.整合Spring-Spring整合MyBatis关键配置</h2><p><a href="src/main/resources/c06/applicationContext.xml">applicationContext.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	整合mybatis </span></span><br><span class="line"><span class="comment">		目的：1、spring管理所有组件。mapper的实现类。</span></span><br><span class="line"><span class="comment">				service==&gt;Dao   @Autowired:自动注入mapper；</span></span><br><span class="line"><span class="comment">			2、spring用来管理事务，spring声明式事务</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--创建出SqlSessionFactory对象  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- configLocation指定全局配置文件的位置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:c06/mybatis-config.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--mapperLocations: 指定mapper文件的位置--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:c06/*Mapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--配置一个可以进行批量执行的sqlSession  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 扫描所有的mapper接口的实现，让这些mapper能够自动注入；</span></span><br><span class="line"><span class="comment">	base-package：指定mapper接口的包名</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mybatis-spring:scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lun.c06&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</span></span><br><span class="line"><span class="comment">		&lt;property name=&quot;basePackage&quot; value=&quot;com.lun.dao&quot;&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;/bean&gt; --&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="66-整合Spring-整合测试"><a href="#66-整合Spring-整合测试" class="headerlink" title="66.整合Spring-整合测试"></a>66.整合Spring-整合测试</h2><p><a href="src/main/java/com/lun/c06/spring/EmployeeController.java">EmployeeController.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">5415910268862124882L</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	EmployeeService employeeService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/getemps&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">emps</span><span class="params">(Map&lt;String,Object&gt; map)</span>&#123;</span><br><span class="line">		List&lt;Employee&gt; emps = employeeService.getEmps();</span><br><span class="line">		map.put(<span class="string">&quot;allEmps&quot;</span>, emps);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c06/spring/EmployeeService.java">EmployeeService.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper employeeMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getEmps</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">		<span class="comment">//EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);</span></span><br><span class="line">		<span class="keyword">return</span> employeeMapper.getEmps();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/webapp/WEB-INF/pages/list.jsp">list.jsp</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>员工列表<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>lastName<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>email<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;allEmps&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;emp&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.lastName&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.email&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.gender&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p>最后，在浏览器输入<code>http://localhost:8080/LearnMybatis/getemps</code>进行测试</p><h2 id="MyBatis-代码生成器"><a href="#MyBatis-代码生成器" class="headerlink" title="MyBatis-代码生成器"></a>MyBatis-代码生成器</h2><p>MyBatis Generator：</p><p>简称MBG，是一个专门为MyBatis框架使用者定制的代码生成器，可以快速的根据表生成对应的映射文件，接口，以及bean类。支持基本的增删改查，以及QBC风格的条件查询。但是表连接、存储过程等这些复杂sql的定义需要我们手工编写</p><p><a target="_blank" rel="noopener" href="http://www.mybatis.org/generator/">官方文档地址</a></p><p><a target="_blank" rel="noopener" href="https://github.com/mybatis/generator/releases">官方工程地址</a></p><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><ul><li>使用步骤：<ol><li>编写MBG的配置文件（重要几处配置）<ol><li>jdbcConnection配置数据库连接信息</li><li>javaModelGenerator配置javaBean的生成策略</li><li>sqlMapGenerator 配置sql映射文件生成策略</li><li>javaClientGenerator配置Mapper接口的生成策略</li><li>table 配置要逆向解析的数据表<ul><li>tableName：表名</li><li>domainObjectName：对应的javaBean名</li></ul></li></ol></li><li>运行代码生成器生成代码</li></ol></li><li>注意：<ul><li>Context标签<ul><li>targetRuntime&#x3D;“MyBatis3“可以生成带条件的增删改查</li><li>targetRuntime&#x3D;“MyBatis3Simple“可以生成基本的增删改查</li></ul></li><li>如果再次生成，建议将之前生成的数据删除，避免xml向后追加内容出现的问题。</li></ul></li></ul><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p><a href="src/main/resources/c07/mbg.xml">mbg.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		targetRuntime=&quot;MyBatis3Simple&quot;:生成简单版的CRUD</span></span><br><span class="line"><span class="comment">		&quot;MyBatis3&quot;:豪华版</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;c04/dbconfig.properties&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">&lt;!-- jdbcConnection：指定如何连接到目标数据库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">connectionURL</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">userId</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">password</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaTypeResolver</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- javaModelGenerator：指定javaBean的生成策略 </span></span><br><span class="line"><span class="comment">	targetPackage=&quot;test.model&quot;：目标包名</span></span><br><span class="line"><span class="comment">	targetProject=&quot;\MBGTestProject\src&quot;：目标工程</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.lun.bean&quot;</span> </span></span><br><span class="line"><span class="tag">    		<span class="attr">targetProject</span>=<span class="string">&quot;C:\\src&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- sqlMapGenerator：sql映射生成策略： --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.lun.dao&quot;</span>  </span></span><br><span class="line"><span class="tag">    	<span class="attr">targetProject</span>=<span class="string">&quot;C:\\src&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- javaClientGenerator:指定mapper接口所在的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.lun.dao&quot;</span>  </span></span><br><span class="line"><span class="tag">    	<span class="attr">targetProject</span>=<span class="string">&quot;C:\\src&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 指定要逆向分析哪些表：根据表要创建javaBean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;department&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Department&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;employee&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="生成器代码"><a href="#生成器代码" class="headerlink" title="生成器代码"></a>生成器代码</h3><p><a href="src/main/java/com/lun/c07/generator/GenerateCode.java">GenerateCode.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenerateCode</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">			<span class="type">boolean</span> <span class="variable">overwrite</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="type">File</span> <span class="variable">configFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(GenerateCode.class.getClassLoader().getResource(<span class="string">&quot;c07/mbg.xml&quot;</span>).getFile());</span><br><span class="line">			<span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);</span><br><span class="line">			<span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(configFile);</span><br><span class="line">			<span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overwrite);</span><br><span class="line">			<span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config, callback, warnings);</span><br><span class="line">			myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="QBC风格的带条件查询"><a href="#QBC风格的带条件查询" class="headerlink" title="QBC风格的带条件查询"></a>QBC风格的带条件查询</h3><p>生成器会QBC风格代码</p><blockquote><p>QBC(Query By Criteria) API提供了检索对象的另一种方式，它主要由Criteria接口、Criterion接口和Expresson类组成，它支持在运行时动态生成查询语句。</p><p>From <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/QBC/1529451">https://baike.baidu.com/item/QBC/1529451</a></p></blockquote><p>QBC风格代码使用实例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> build.openSession();</span><br><span class="line">	<span class="type">DeptMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(DeptMapper.class);</span><br><span class="line">	<span class="type">DeptExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeptExample</span>();</span><br><span class="line">	<span class="comment">//所有的条件都在example中封装</span></span><br><span class="line">	<span class="type">Criteria</span> <span class="variable">criteria</span> <span class="operator">=</span> example.createCriteria();</span><br><span class="line">	<span class="comment">//select id, deptName, locAdd from tbl_dept WHERE</span></span><br><span class="line">	<span class="comment">//( deptName like ? and id &gt; ? )</span></span><br><span class="line">	criteria.andDeptnameLike(<span class="string">&quot;%部%&quot;</span>);</span><br><span class="line">	criteria.andIdGreaterThan(<span class="number">2</span>);</span><br><span class="line">	List&lt;Dept&gt; list = mapper.selectByExample(example);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (Dept dept : list) &#123;</span><br><span class="line">		System.out.println(dept);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="MyBatis-工作原理"><a href="#MyBatis-工作原理" class="headerlink" title="MyBatis-工作原理"></a>MyBatis-工作原理</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/05.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/07.png"></p><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/08.png" alt="根据配置文件创建SQLSessionFactory"></p><ul><li>Configuration封装了所有配置文件的详细信息</li><li>总结：把配置文件的信息解析并保存在Configuration对象中，返回包含了Configuration的DefaultSqlSession对象。</li></ul><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/09.png" alt="openSession获取sqlSession对象"></p><ul><li>返回SqlSession的实现类DefaultSqlSession对象。他里面包含了Executor和Configuration</li><li>Executor会在这一步被创建</li></ul><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/10.png" alt="getMapper返回接口的代理对象包含了SqlSession对象"></p><hr><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/11.png" alt="查询流程"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/12.png" alt="查询流程总结"></p><ul><li>StatementHandler：处理sql语句预编译，设置参数等相关工作；</li><li>ParameterHandler：设置预编译参数用的</li><li>ResultHandler：处理结果集</li><li>TypeHandler：在整个过程中，进行数据库类型和javaBean类型的映射</li></ul><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ol><li>根据配置文件（全局，sql映射）初始化出Configuration对象</li><li>创建一个DefaultSqlSession对象，它里面包含Configuration以及Executor（根据全局配置文件中的defaultExecutorType创建出对应的Executor）</li><li>DefaultSqlSession.getMapper（）：拿到Mapper接口对应的MapperProxy；</li><li>MapperProxy里面有（DefaultSqlSession）；</li><li>执行增删改查方法：<ol><li>调用DefaultSqlSession的增删改查（Executor）；</li><li>会创建一个StatementHandler对象。同时也会创建出ParameterHandler和ResultSetHandler）</li><li>调用StatementHandler预编译参数以及设置参数值，使用ParameterHandler来给sql设置参数</li><li>调用StatementHandler的增删改查方法；</li><li>ResultSetHandler封装结果</li></ol></li></ol><p><strong>注意</strong>：四大对象(Executor、ParameterHandler、ResultSetHandler)每个创建的时候都有一个interceptorChain.pluginAll(parameterHandler);</p><h2 id="MyBatis-插件开发"><a href="#MyBatis-插件开发" class="headerlink" title="MyBatis-插件开发"></a>MyBatis-插件开发</h2><p>在四大对象创建的时候</p><ol><li>每个创建出来的对象不是直接返回的，而是interceptorChain.pluginAll(parameterHandler);</li><li>获取到所有的Interceptor（拦截器）（插件需要实现的接口）；调用interceptor.plugin(target);返回target包装后的对象</li><li>插件机制，我们可以使用插件为目标对象创建一个代理对象；AOP（面向切面）我们的插件可以为四大对象创建出代理对象；代理对象就可以拦截到四大对象的每一个执行；</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">pluginAll</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Interceptor interceptor : interceptors) &#123;</span><br><span class="line">      target = interceptor.plugin(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>默认情况下，MyBatis 允许使用插件来拦截的方法调用包括：</p><ul><li>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li><li>ParameterHandler (getParameterObject, setParameters)</li><li>ResultSetHandler (handleResultSets, handleOutputParameters)</li><li>StatementHandler (prepare, parameterize, batch, update, query)</li></ul><h3 id="插件开发"><a href="#插件开发" class="headerlink" title="插件开发"></a>插件开发</h3><p>插件开发步骤：</p><ol><li>编写插件实现Interceptor接口，并使用 @Intercepts注解完成插件签名</li><li>在全局配置文件中注册插件</li></ol><p><a href="src/main/java/com/lun/c08/interceptor/MyFirstPlugin.java">MyFirstPlugin.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//完成插件签名，用于拦截哪个对象的哪个方法</span></span><br><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type=StatementHandler.class,method=&quot;parameterize&quot;,args=java.sql.Statement.class)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * intercept:拦截</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">&quot;myfirstplugin...intercept：&quot;</span> + invocation.getMethod());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> invocation.getTarget();</span><br><span class="line">        System.out.println(<span class="string">&quot;当前拦截到的对象：&quot;</span>+target);</span><br><span class="line">        <span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> SystemMetaObject.forObject(target);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;parameterHandler.parameterObject&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;sql语句中的参数是：&quot;</span>+value);</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;parameterHandler.parameterObject&quot;</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">//执行目标方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">        <span class="comment">//返回执行后的返回值</span></span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//包装目标对象，为目标对象创建一个代理对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--&gt;myfirstplugin...plugin，将要包装的对象：&quot;</span>+target);</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">wrap</span> <span class="operator">=</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">        <span class="comment">//返回为当前target创建的动态代理</span></span><br><span class="line">        <span class="keyword">return</span> wrap;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将插件注册时的property属性设置进来</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(<span class="string">&quot;插件配置的信息：&quot;</span>+properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="src/main/resources/c08/mybatis-config.xml">mybatis-config.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.lun.c08.interceptor.MyFirstPlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 可实现多个插件 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.lun.c08.interceptor.MySecondPlugin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="插件原理"><a href="#插件原理" class="headerlink" title="插件原理"></a>插件原理</h3><ul><li>按照插件注解声明，按照插件配置顺序调用插件plugin方法，生成被拦截对象的动态代理</li><li>多个插件依次生成目标对象的代理对象，层层包裹，先声明的先包裹；形成代理链</li><li>目标方法执行时依次从外到内执行插件的intercept方法。</li><li>多个插件情况下，我们往往需要在某个插件中分离出目标对象。可以借助MyBatis提供的SystemMetaObject类来进行获取最后一层的h以及target属性的值</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/06.png"></p><h3 id="Interceptor接口"><a href="#Interceptor接口" class="headerlink" title="Interceptor接口"></a>Interceptor接口</h3><ul><li>Intercept：拦截目标方法执行</li><li>plugin：生成动态代理对象，可以使用MyBatis提供的Plugin类的wrap方法</li><li>setProperties：注入插件配置时设置的属性</li></ul><h3 id="常用代码"><a href="#常用代码" class="headerlink" title="常用代码"></a>常用代码</h3><p>从代理链中分离真实被代理对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、分离代理对象。由于会形成多次代理，所以需要通过一个</span></span><br><span class="line"><span class="keyword">while</span> 循环分离出最终被代理对象，从而方便提取信息</span><br><span class="line"><span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> SystemMetaObject.forObject(target);</span><br><span class="line"><span class="keyword">while</span> (metaObject.hasGetter(<span class="string">&quot;h&quot;</span>)) &#123;</span><br><span class="line">	<span class="type">Object</span> <span class="variable">h</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">	metaObject = SystemMetaObject.forObject(h);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2、获取到代理对象中包含的被代理的真实对象</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;target&quot;</span>);</span><br><span class="line"><span class="comment">//3、获取被代理对象的MetaObject方便进行信息提取</span></span><br><span class="line"><span class="type">MetaObject</span> <span class="variable">forObject</span> <span class="operator">=</span> SystemMetaObject.forObject(obj);</span><br></pre></td></tr></table></figure><h2 id="扩展-MyBatis实用场景-PageHelper插件进行分页"><a href="#扩展-MyBatis实用场景-PageHelper插件进行分页" class="headerlink" title="扩展-MyBatis实用场景-PageHelper插件进行分页"></a>扩展-MyBatis实用场景-PageHelper插件进行分页</h2><p><a target="_blank" rel="noopener" href="https://github.com/pagehelper/Mybatis-PageHelper">PageHelper插件官网</a></p><p><a href="pom.xml">pom.xml</a>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分页插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c09/mybatis-config.xml">MyBatis全局配置文件</a>注册插件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c09/other/PageHelperTest.java">使用示例</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageHelperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="comment">// 1、获取sqlSessionFactory对象</span></span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c09/mybatis-config.xml&quot;</span>);</span><br><span class="line">		<span class="comment">// 2、获取sqlSession对象</span></span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">			Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">5</span>, <span class="number">1</span>);<span class="comment">//&lt;---------------------</span></span><br><span class="line">			</span><br><span class="line">			List&lt;Employee&gt; emps = mapper.getEmps();</span><br><span class="line">			<span class="comment">//传入要连续显示多少页</span></span><br><span class="line">			PageInfo&lt;Employee&gt; info = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(emps, <span class="number">5</span>);<span class="comment">//&lt;---------------------</span></span><br><span class="line">			<span class="keyword">for</span> (Employee employee : emps) &#123;</span><br><span class="line">				System.out.println(employee);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/*System.out.println(&quot;当前页码：&quot;+page.getPageNum());</span></span><br><span class="line"><span class="comment">			System.out.println(&quot;总记录数：&quot;+page.getTotal());</span></span><br><span class="line"><span class="comment">			System.out.println(&quot;每页的记录数：&quot;+page.getPageSize());</span></span><br><span class="line"><span class="comment">			System.out.println(&quot;总页码：&quot;+page.getPages());*/</span></span><br><span class="line">			<span class="comment">///xxx</span></span><br><span class="line">			System.out.println(<span class="string">&quot;当前页码：&quot;</span>+info.getPageNum());</span><br><span class="line">			System.out.println(<span class="string">&quot;总记录数：&quot;</span>+info.getTotal());</span><br><span class="line">			System.out.println(<span class="string">&quot;每页的记录数：&quot;</span>+info.getPageSize());</span><br><span class="line">			System.out.println(<span class="string">&quot;总页码：&quot;</span>+info.getPages());</span><br><span class="line">			System.out.println(<span class="string">&quot;是否第一页：&quot;</span>+info.isIsFirstPage());</span><br><span class="line">			System.out.println(<span class="string">&quot;连续显示的页码：&quot;</span>);</span><br><span class="line">			<span class="type">int</span>[] nums = info.getNavigatepageNums();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">				System.out.println(nums[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//xxxx</span></span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="扩展-MyBatis实用场景-批量操作"><a href="#扩展-MyBatis实用场景-批量操作" class="headerlink" title="扩展-MyBatis实用场景-批量操作"></a>扩展-MyBatis实用场景-批量操作</h2><ul><li>默认的 openSession() 方法没有参数,它会创建有如下特性的<ul><li>会开启一个事务(也就是不自动提交)</li><li>连接对象会从由活动环境配置的数据源实例得到。</li><li>事务隔离级别将会使用驱动或数据源的默认设置。</li><li>预处理语句不会被复用,也不会批量处理更新。</li></ul></li><li>openSession 方法的 ExecutorType 类型的参数，枚举类型:<ul><li>ExecutorType.SIMPLE: 这个执行器类型不做特殊的事情（这是默认装配的）。它为每个语句的执行创建一个新的预处理语句。</li><li>ExecutorType.REUSE: 这个执行器类型会复用预处理语句。</li><li>ExecutorType.BATCH: 这个执行器会批量执行所有更新语句</li></ul></li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/twintea/pic-notes1/img/13.png"></p><p>批量操作我们是使用MyBatis提供的BatchExecutor进行的，它的底层就是通过jdbc攒sql的方式进行的。我们可以让他攒够一定数量后发给数据库一次。</p><p><a href="src/test/java/com/lun/c09/other/BatchTest.java">BatchTest.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c09/mybatis-config.xml&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//可以执行批量操作的sqlSession</span></span><br><span class="line">		<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">		<span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">				mapper.addEmp(<span class="keyword">new</span> <span class="title class_">Employee</span>(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>), <span class="string">&quot;b&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">			&#125;</span><br><span class="line">			openSession.commit();</span><br><span class="line">			<span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">			<span class="comment">//批量：（预编译sql一次==&gt;设置参数===&gt;10000次===&gt;执行（1次））</span></span><br><span class="line">			<span class="comment">//Parameters: 616c1(String), b(String), 1(String)==&gt;4598</span></span><br><span class="line">			<span class="comment">//非批量：（预编译sql=设置参数=执行）==》10000    10200</span></span><br><span class="line">			System.out.println(<span class="string">&quot;执行时长：&quot;</span>+(end-start));</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			openSession.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>与Spring整合中，我们推荐，额外的配置一个可以专门用来执行批量操作的SqlSession</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置一个可以进行批量执行的sqlSession  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>需要用到批量操作的时候，我们可以注入配置的这个批量SqlSession。通过他获取到mapper映射器进行操作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SqlSession sqlSession;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p><ol><li>批量操作是在session.commit()以后才发送sql语句给数据库进行执行的</li><li>如果我们想让其提前执行，以方便后续可能的查询操作获取数据，我们可以使用sqlSession.flushStatements()方法，让其直接冲刷到数据库进行执行。</li></ol><h2 id="扩展-MyBatis实用场景-存储过程"><a href="#扩展-MyBatis实用场景-存储过程" class="headerlink" title="扩展-MyBatis实用场景-存储过程"></a>扩展-MyBatis实用场景-存储过程</h2><p>实际开发中，我们通常也会写一些存储过程，MyBatis也支持对存储过程的调用</p><p>一个最简单的存储过程：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">create procedure test()</span><br><span class="line">begin</span><br><span class="line">select &#x27;hello&#x27;;</span><br><span class="line">end $$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure><p>存储过程的调用：</p><ol><li>select标签中statementType&#x3D;“CALLABLE”</li><li>标签体中调用语法：<code>&#123;call procedure_name(#&#123;param1_info&#125;,#&#123;param2_info&#125;)&#125;</code></li></ol><p>MyBatis对存储过程的游标提供了一个JdbcType&#x3D;CURSOR的支持，可以智能的把游标读取到的数据，映射到我们声明的结果集中</p><p>oracle存储过程</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span></span><br><span class="line">	hello_ test(</span><br><span class="line">		p_start <span class="keyword">in</span> <span class="type">int</span>,p_end <span class="keyword">in</span> <span class="type">int</span>,p_count <span class="keyword">out</span> <span class="type">int</span>,p_emps <span class="keyword">out</span> sys_refcursor)</span><br><span class="line">	) <span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">into</span> p_count <span class="keyword">from</span> employees;</span><br><span class="line">	<span class="keyword">open</span> p_emps <span class="keyword">for</span></span><br><span class="line">		<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> rownum rn,e.<span class="operator">*</span> <span class="keyword">from</span> employees e <span class="keyword">where</span> rownum<span class="operator">&lt;=</span>p_end )</span><br><span class="line">			<span class="keyword">where</span> rn<span class="operator">&gt;=</span>p_start;</span><br><span class="line"><span class="keyword">end</span> hello_test;</span><br></pre></td></tr></table></figure><p>mapper.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.lun.dao.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- public void getPageByProcedure(); </span></span><br><span class="line"><span class="comment">	1、使用select标签定义调用存储过程</span></span><br><span class="line"><span class="comment">	2、statementType=&quot;CALLABLE&quot;:表示要调用存储过程</span></span><br><span class="line"><span class="comment">	3、&#123;call procedure_name(params)&#125;</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getPageByProcedure&quot;</span> <span class="attr">statementType</span>=<span class="string">&quot;CALLABLE&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line">		&#123;call hello_test(</span><br><span class="line">			#&#123;start,mode=IN,jdbcType=INTEGER&#125;,</span><br><span class="line">			#&#123;end,mode=IN,jdbcType=INTEGER&#125;,</span><br><span class="line">			#&#123;count,mode=OUT,jdbcType=INTEGER&#125;,</span><br><span class="line">			#&#123;emps,mode=OUT,jdbcType=CURSOR,javaType=ResultSet,resultMap=PageEmp&#125;</span><br><span class="line">		)&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;PageEmp&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;EMPLOYEE_ID&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;LAST_NAME&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;EMAIL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p>全局配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * oracle分页：</span></span><br><span class="line"><span class="comment"> * 		借助rownum：行号；子查询；</span></span><br><span class="line"><span class="comment"> * 存储过程包装分页逻辑</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProcedure</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">		<span class="type">OraclePage</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OraclePage</span>();</span><br><span class="line">		page.setStart(<span class="number">1</span>);</span><br><span class="line">		page.setEnd(<span class="number">5</span>);</span><br><span class="line">		mapper.getPageByProcedure(page);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;总记录数：&quot;</span>+page.getCount());</span><br><span class="line">		System.out.println(<span class="string">&quot;查出的数据：&quot;</span>+page.getEmps().size());</span><br><span class="line">		System.out.println(<span class="string">&quot;查出的数据：&quot;</span>+page.getEmps());</span><br><span class="line">	&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OraclePage</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> start;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> end;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Employee&gt; emps;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//setter and getter</span></span><br></pre></td></tr></table></figure><h2 id="扩展-MyBatis实用场景-typeHandler处理枚举"><a href="#扩展-MyBatis实用场景-typeHandler处理枚举" class="headerlink" title="扩展-MyBatis实用场景-typeHandler处理枚举"></a>扩展-MyBatis实用场景-typeHandler处理枚举</h2><h3 id="热身"><a href="#热身" class="headerlink" title="热身"></a>热身</h3><p>新建一个枚举类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EmpStatus</span> &#123;</span><br><span class="line">	LOGIN,LOGOUT,REMOVE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>枚举的相关属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEnumUse</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">EmpStatus</span> <span class="variable">login</span> <span class="operator">=</span> EmpStatus.LOGIN;</span><br><span class="line">	System.out.println(<span class="string">&quot;枚举的索引：&quot;</span> + login.ordinal());</span><br><span class="line">	System.out.println(<span class="string">&quot;枚举的名字：&quot;</span> + login.name());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">枚举的索引：0</span><br><span class="line">枚举的名字：LOGIN</span><br></pre></td></tr></table></figure><hr><p>若存入枚举属性到数据库，数据库表会呈现怎样的值？</p><p><a href="src/main/java/com/lun/c09/other/bean/Employee.java">Employee类</a>添加一个枚举属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">EmpStatus</span> <span class="variable">empStatus</span> <span class="operator">=</span> EmpStatus.LOGOUT;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>修改表结构</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> EmpStatus <span class="type">VARCHAR</span>(<span class="number">255</span>);</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c09/other/dao/EmployeeMapper.java">EmployeeMapper.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addEmp2</span><span class="params">(com.lun.c09.other.bean.Employee em)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> com.lun.c09.other.bean.Employee <span class="title function_">getEmpById2</span><span class="params">(Integer id)</span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p><a href="src/main/resources/c09/EmployeeMapper.xml">EmployeeMapper.xml</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.lun.c09.other.bean.Employee&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> &gt;</span></span><br><span class="line">		insert into employee(last_name,email,gender,empStatus) </span><br><span class="line">		values(#&#123;lastName&#125;,#&#123;email&#125;,#&#123;gender&#125;,#&#123;empStatus&#125;)</span><br><span class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById2&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.lun.c09.other.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">		select id,last_name lastName,email,gender,empStatus from employee where id = #&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/test/java/com/lun/c09/other/EnumTest.java">测试方法</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认mybatis在处理枚举对象的时候保存的是枚举的名字：EnumTypeHandler</span></span><br><span class="line"><span class="comment"> * 改变使用：EnumOrdinalTypeHandler：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEnum</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">	<span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> Tools.getSqlSessionFactory(<span class="string">&quot;c09/mybatis-config.xml&quot;</span>);</span><br><span class="line">	<span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">	<span class="keyword">try</span>&#123;</span><br><span class="line">		<span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">		<span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;test_enum&quot;</span>, <span class="string">&quot;enum@abc.com&quot;</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">		mapper.addEmp2(employee);</span><br><span class="line">		<span class="comment">//System.out.println(&quot;保存成功&quot;+employee.getId());</span></span><br><span class="line">		<span class="comment">//openSession.commit();</span></span><br><span class="line">		<span class="type">Employee</span> <span class="variable">empById</span> <span class="operator">=</span> mapper.getEmpById2(employee.getId());</span><br><span class="line">		System.out.println(empById.getEmpStatus());</span><br><span class="line">	&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">		openSession.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果是存入<code>LOGOUT</code>到数据库表。</p><p>因此，默认mybatis在处理枚举对象的时候保存的是枚举的名字：EnumTypeHandler</p><p>将想<strong>存数值</strong>到数据库表，改用EnumOrdinalTypeHandler</p><p>在<a href="src/main/resources/c09/mybatis-config.xml">MyBatis存储文件</a>注册</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;org.apache.ibatis.type.EnumOrdinalTypeHandler&quot;</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">javaType</span>=<span class="string">&quot;com.lun.c09.other.bean.EmpStatus&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="自定义TypeHandler"><a href="#自定义TypeHandler" class="headerlink" title="自定义TypeHandler"></a>自定义TypeHandler</h3><p>我们可以通过自定义TypeHandler的形式来在设置参数或者取出结果集的时候自定义参数封装策略。</p><p>步骤：</p><ol><li>实现TypeHandler接口或者继承BaseTypeHandler</li><li>使用@MappedTypes定义处理的java类型，使用@MappedJdbcTypes定义jdbcType类型</li><li>在自定义结果集标签或者参数处理的时候声明使用自定义TypeHandler进行处理或者在全局配置TypeHandler要处理的javaType。</li></ol><hr><p>示例：希望数据库保存的是100,200这些状态码，而不是默认0,1或者枚举的名字</p><p><a href="src/main/java/com/lun/c09/other/bean/EmpStatus.java">EmpStatus.java</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EmpStatus</span> &#123;</span><br><span class="line">	LOGIN(<span class="number">100</span>,<span class="string">&quot;用户登录&quot;</span>),LOGOUT(<span class="number">200</span>,<span class="string">&quot;用户登出&quot;</span>),REMOVE(<span class="number">300</span>,<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Integer code;</span><br><span class="line">	<span class="keyword">private</span> String msg;</span><br><span class="line">	<span class="keyword">private</span> <span class="title function_">EmpStatus</span><span class="params">(Integer code,String msg)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.code = code;</span><br><span class="line">		<span class="built_in">this</span>.msg = msg;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//按照状态码返回枚举对象</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> EmpStatus <span class="title function_">getEmpStatusByCode</span><span class="params">(Integer code)</span>&#123;</span><br><span class="line">		<span class="keyword">switch</span> (code) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">100</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGIN;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">200</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGOUT;	</span><br><span class="line">			<span class="keyword">case</span> <span class="number">300</span>:</span><br><span class="line">				<span class="keyword">return</span> REMOVE;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="keyword">return</span> LOGOUT;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p><a href="src/main/java/com/lun/c09/other/typehandler/MyEnumEmpStatusTypeHandler.java">自定义Handler</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyEnumEmpStatusTypeHandler</span> <span class="keyword">implements</span> <span class="title class_">TypeHandler</span>&lt;EmpStatus&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义当前数据如何保存到数据库中</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setParameter</span><span class="params">(PreparedStatement ps, <span class="type">int</span> i, EmpStatus parameter,</span></span><br><span class="line"><span class="params">			JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		System.out.println(<span class="string">&quot;要保存的状态码：&quot;</span>+parameter.getCode());</span><br><span class="line">		ps.setString(i, parameter.getCode().toString());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> EmpStatus <span class="title function_">getResult</span><span class="params">(ResultSet rs, String columnName)</span></span><br><span class="line">			<span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//需要根据从数据库中拿到的枚举的状态码返回一个枚举对象</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> rs.getInt(columnName);</span><br><span class="line">		System.out.println(<span class="string">&quot;从数据库中获取的状态码：&quot;</span>+code);</span><br><span class="line">		<span class="type">EmpStatus</span> <span class="variable">status</span> <span class="operator">=</span> EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> EmpStatus <span class="title function_">getResult</span><span class="params">(ResultSet rs, <span class="type">int</span> columnIndex)</span></span><br><span class="line">			<span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> rs.getInt(columnIndex);</span><br><span class="line">		System.out.println(<span class="string">&quot;从数据库中获取的状态码：&quot;</span>+code);</span><br><span class="line">		<span class="type">EmpStatus</span> <span class="variable">status</span> <span class="operator">=</span> EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> EmpStatus <span class="title function_">getResult</span><span class="params">(CallableStatement cs, <span class="type">int</span> columnIndex)</span></span><br><span class="line">			<span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> cs.getInt(columnIndex);</span><br><span class="line">		System.out.println(<span class="string">&quot;从数据库中获取的状态码：&quot;</span>+code);</span><br><span class="line">		<span class="type">EmpStatus</span> <span class="variable">status</span> <span class="operator">=</span> EmpStatus.getEmpStatusByCode(code);</span><br><span class="line">		<span class="keyword">return</span> status;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>注册自定义TypeHandler：</p><p>1.<a href="src/main/resources/c09/mybatis-config.xml">MyBatis全局配置文件</a>中注册</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.lun.c09.other.typehandler.MyEnumEmpStatusTypeHandler&quot;</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">javaType</span>=<span class="string">&quot;com.lun.c09.other.bean.EmpStatus&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>也可以在处理某个字段的时候告诉MyBatis用什么类型处理器</li></ol><ul><li>保存：<code>#&#123;empStatus,typeHandler=xxxx&#125;</code></li><li>查询：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.lun.bean.Employee&quot;</span> <span class="attr">id</span>=<span class="string">&quot;MyEmp&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;empStatus&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empStatus&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;xxxxx&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：如果在参数位置修改TypeHandler，应该保证保存数据和查询数据用的TypeHandler是一样的。</p></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>MyBatis笔记</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://blog.twintea.top/posts/93fcac00.html">https://blog.twintea.top/posts/93fcac00.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>🐤twintea🐥</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2022-01-28</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2023-03-12</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mybatis/">Mybatis</a></div><div class="post_share"><div class="social-share" data-image="https://static-bed.twintea.top/wallpaper/壁纸电脑7.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/9e256e89.html" title="POM文件帮助文档"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/66952939_0.jpeg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">POM文件帮助文档</div></div></a></div><div class="next-post pull-right"><a href="/posts/e545fed0.html" title="SpringMVC笔记"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/wallhaven-p9ozm9.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SpringMVC笔记</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"></div><div class="author_top is-center"><div class="card-info-avatar"></div><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/avatar.jfif" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">🐤twintea🐥</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/twintea"><i class="fab fa-github"></i><span>🐱‍🏍Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/twintea" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:beyond2galaxy@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">Welcome to my Blog🥂</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">MyBatis笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.1.</span> <span class="toc-text">MyBatis是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis%E5%8E%86%E5%8F%B2"><span class="toc-number">1.1.2.</span> <span class="toc-text">MyBatis历史</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8MyBatis%EF%BC%9F"><span class="toc-number">1.1.3.</span> <span class="toc-text">为什么要使用MyBatis？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.2.</span> <span class="toc-text">2.下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-HelloWorld"><span class="toc-number">1.3.</span> <span class="toc-text">3.HelloWorld</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%8E%A5%E5%8F%A3%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">4.接口式编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%B0%8F%E7%BB%93-1"><span class="toc-number">1.5.</span> <span class="toc-text">5.小结(1)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-%E5%BC%95%E5%85%A5dtd%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.</span> <span class="toc-text">6.全局配置文件-引入dtd约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.1.</span> <span class="toc-text">MyBatis-全局配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5dtd%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.6.2.</span> <span class="toc-text">引入dtd约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-properties-%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.7.</span> <span class="toc-text">7.全局配置文件-properties-引入外部配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-settings-%E8%BF%90%E8%A1%8C%E6%97%B6%E8%A1%8C%E4%B8%BA%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.8.</span> <span class="toc-text">8.全局配置文件-settings-运行时行为设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-typeAliases-%E5%88%AB%E5%90%8D"><span class="toc-number">1.9.</span> <span class="toc-text">9.全局配置文件-typeAliases-别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-typeHandlers-%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">1.10.</span> <span class="toc-text">10.全局配置文件-typeHandlers-类型处理器简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%A4%84%E7%90%86"><span class="toc-number">1.10.1.</span> <span class="toc-text">日期类型的处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">1.10.2.</span> <span class="toc-text">自定义类型处理器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-plugins-%E6%8F%92%E4%BB%B6%E7%AE%80%E4%BB%8B"><span class="toc-number">1.11.</span> <span class="toc-text">11.全局配置文件-plugins-插件简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-enviroments-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.12.</span> <span class="toc-text">12.全局配置文件-enviroments-运行环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#environment-%E6%8C%87%E5%AE%9A%E5%85%B7%E4%BD%93%E7%8E%AF%E5%A2%83"><span class="toc-number">1.12.1.</span> <span class="toc-text">environment-指定具体环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#transactionManager"><span class="toc-number">1.12.1.1.</span> <span class="toc-text">transactionManager</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dataSource"><span class="toc-number">1.12.1.2.</span> <span class="toc-text">dataSource</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-databaseIdProvider-%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81"><span class="toc-number">1.13.</span> <span class="toc-text">13.全局配置文件-databaseIdProvider-多数据库支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-mappers-sql%E6%98%A0%E5%B0%84%E6%B3%A8%E5%86%8C"><span class="toc-number">1.14.</span> <span class="toc-text">14.全局配置文件-mappers-sql映射注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-%E5%B0%8F%E7%BB%93-2"><span class="toc-number">1.15.</span> <span class="toc-text">15.小结(2)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">1.16.</span> <span class="toc-text">16.映射文件-增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CRUD%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-number">1.16.1.</span> <span class="toc-text">CRUD初体验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A6%E5%A4%96"><span class="toc-number">1.16.2.</span> <span class="toc-text">另外</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-insert-%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC"><span class="toc-number">1.17.</span> <span class="toc-text">17.映射文件-insert-获取自增主键的值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-insert-Oracle%E4%BD%BF%E7%94%A8%E5%BA%8F%E5%88%97%E7%94%9F%E6%88%90%E4%B8%BB%E9%94%AE%E6%BC%94%E7%A4%BA"><span class="toc-number">1.18.</span> <span class="toc-text">18.映射文件-insert-Oracle使用序列生成主键演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-oracle%E4%BD%BF%E7%94%A8%EF%BC%89%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-insert-%E8%8E%B7%E5%8F%96%E9%9D%9E%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC-selectKey"><span class="toc-number">1.19.</span> <span class="toc-text">19.(oracle使用）映射文件-insert-获取非自增主键的值-selectKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8D%95%E4%B8%AA%E5%8F%82%E6%95%B0-amp-%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0-amp-%E5%91%BD%E5%90%8D%E5%8F%82%E6%95%B0"><span class="toc-number">1.20.</span> <span class="toc-text">20.映射文件-参数处理-单个参数&amp;多个参数&amp;命名参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-POJO-amp-Map-amp-TO"><span class="toc-number">1.21.</span> <span class="toc-text">21.映射文件-参数处理-POJO&amp;Map&amp;TO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8F%82%E6%95%B0%E5%B0%81%E8%A3%85%E6%89%A9%E5%B1%95%E6%80%9D%E8%80%83"><span class="toc-number">1.22.</span> <span class="toc-text">22.映射文件-参数处理-参数封装扩展思考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8F%82%E6%95%B0%E5%B0%81%E8%A3%85map%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">1.23.</span> <span class="toc-text">23.源码分析-参数处理-参数封装map的过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E4%B8%8E-%E5%8F%96%E5%80%BC%E5%8C%BA%E5%88%AB"><span class="toc-number">1.24.</span> <span class="toc-text">24.映射文件-参数处理-#与$取值区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86-%E5%8F%96%E5%80%BC%E6%97%B6%E6%8C%87%E5%AE%9A%E5%8F%82%E6%95%B0%E7%9B%B8%E5%85%B3%E8%A7%84%E5%88%99"><span class="toc-number">1.25.</span> <span class="toc-text">25.映射文件-参数处理-#取值时指定参数相关规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-%E8%BF%94%E5%9B%9EList"><span class="toc-number">1.26.</span> <span class="toc-text">26.映射文件-select-返回List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-%E8%AE%B0%E5%BD%95%E5%B0%81%E8%A3%85map"><span class="toc-number">1.27.</span> <span class="toc-text">27.映射文件-select-记录封装map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-number">1.28.</span> <span class="toc-text">28.映射文件-select-resultMap-自定义结果映射规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.29.</span> <span class="toc-text">29.映射文件-select-resultMap-关联查询-环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7%E5%B0%81%E8%A3%85%E7%BB%93%E6%9E%9C"><span class="toc-number">1.30.</span> <span class="toc-text">30.映射文件-select-resultMap-关联查询-级联属性封装结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-association%E5%AE%9A%E4%B9%89%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1%E5%B0%81%E8%A3%85%E8%A7%84%E5%88%99"><span class="toc-number">1.31.</span> <span class="toc-text">31.映射文件-select-resultMap-关联查询-association定义关联对象封装规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-association%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.32.</span> <span class="toc-text">32.映射文件-select-resultMap-关联查询-association分步查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2-amp-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.33.</span> <span class="toc-text">33.映射文件-select-resultMap-关联查询-分步查询&amp;延迟加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-collection%E5%AE%9A%E4%B9%89%E5%85%B3%E8%81%94%E9%9B%86%E5%90%88%E5%B0%81%E8%A3%85%E8%A7%84%E5%88%99"><span class="toc-number">1.34.</span> <span class="toc-text">34.映射文件-select-resultMap-关联查询-collection定义关联集合封装规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2-collection%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2-amp-%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.35.</span> <span class="toc-text">35.映射文件-select-resultMap-关联查询-collection分步查询&amp;延迟加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E4%BC%A0%E9%80%92%E5%A4%9A%E5%88%97%E5%80%BC-amp-fetchType"><span class="toc-number">1.36.</span> <span class="toc-text">36.映射文件-select-resultMap-分步查询传递多列值&amp;fetchType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-select-resultMap-discriminator%E9%89%B4%E5%88%AB%E5%99%A8"><span class="toc-number">1.37.</span> <span class="toc-text">37.映射文件-select-resultMap-discriminator鉴别器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#38-%E5%8A%A8%E6%80%81sql-%E7%AE%80%E4%BB%8B-amp-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.38.</span> <span class="toc-text">38.动态sql-简介&amp;环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#39-%E5%8A%A8%E6%80%81sql-if-%E5%88%A4%E6%96%AD-amp-OGNL"><span class="toc-number">1.39.</span> <span class="toc-text">39.动态sql-if-判断&amp;OGNL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OGNL"><span class="toc-number">1.39.1.</span> <span class="toc-text">OGNL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40-%E5%8A%A8%E6%80%81sql-where-%E6%9F%A5%E8%AF%A2%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.40.</span> <span class="toc-text">40.动态sql-where-查询条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#41-%E5%8A%A8%E6%80%81sql-trim-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96"><span class="toc-number">1.41.</span> <span class="toc-text">41.动态sql-trim-自定义字符串截取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-%E5%8A%A8%E6%80%81sql-choose-%E5%88%86%E6%94%AF%E9%80%89%E6%8B%A9"><span class="toc-number">1.42.</span> <span class="toc-text">42.动态sql-choose-分支选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-%E5%8A%A8%E6%80%81sql-set-%E4%B8%8Eif%E7%BB%93%E5%90%88%E7%9A%84%E5%8A%A8%E6%80%81%E6%9B%B4%E6%96%B0"><span class="toc-number">1.43.</span> <span class="toc-text">43.动态sql-set-与if结合的动态更新</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-%E5%8A%A8%E6%80%81sql-foreach-%E9%81%8D%E5%8E%86%E9%9B%86%E5%90%88"><span class="toc-number">1.44.</span> <span class="toc-text">44.动态sql-foreach-遍历集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-%E5%8A%A8%E6%80%81sql-foreach-mysql%E4%B8%8Bforeach%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.45.</span> <span class="toc-text">45.动态sql-foreach-mysql下foreach批量插入的两种方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-%E5%8A%A8%E6%80%81sql-foreach-oracle%E4%B8%8B%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.46.</span> <span class="toc-text">46.动态sql-foreach-oracle下批量插入的两种方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#47-%E5%8A%A8%E6%80%81sql-foreach-oracle%E4%B8%8Bforeach%E6%89%B9%E9%87%8F%E4%BF%9D%E5%AD%98%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.47.</span> <span class="toc-text">47.动态sql-foreach-oracle下foreach批量保存两种方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#48-%E5%8A%A8%E6%80%81sql-%E5%86%85%E7%BD%AE%E5%8F%82%E6%95%B0-parameter-amp-databaseId"><span class="toc-number">1.48.</span> <span class="toc-text">48.动态sql-内置参数 _parameter &amp; _databaseId</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#49-%E5%8A%A8%E6%80%81sql-bind-%E7%BB%91%E5%AE%9A%EF%BC%88%E4%B8%8D%E5%B8%B8%E7%94%A8%EF%BC%89"><span class="toc-number">1.49.</span> <span class="toc-text">49.动态sql-bind-绑定（不常用）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#50-%E5%8A%A8%E6%80%81sql-sql-%E6%8A%BD%E5%8F%96%E5%8F%AF%E9%87%8D%E7%94%A8%E7%9A%84sql%E7%89%87%E6%AE%B5"><span class="toc-number">1.50.</span> <span class="toc-text">50.动态sql-sql-抽取可重用的sql片段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51-%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.51.</span> <span class="toc-text">51.缓存-缓存介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-%E7%BC%93%E5%AD%98-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%93%E9%AA%8C"><span class="toc-number">1.52.</span> <span class="toc-text">52.缓存-一级缓存体验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.52.1.</span> <span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%93%E9%AA%8C"><span class="toc-number">1.52.2.</span> <span class="toc-text">一级缓存体验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E7%BC%93%E5%AD%98-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-number">1.53.</span> <span class="toc-text">53.缓存-一级缓存失效的四种情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-%E7%BC%93%E5%AD%98-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.54.</span> <span class="toc-text">54.缓存-二级缓存介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#55-%E7%BC%93%E5%AD%98-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8-amp-%E7%BB%86%E8%8A%82"><span class="toc-number">1.55.</span> <span class="toc-text">55.缓存-二级缓存使用&amp;细节</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#56-%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E6%9C%89%E5%85%B3%E7%9A%84%E8%AE%BE%E7%BD%AE%E4%BB%A5%E5%8F%8A%E5%B1%9E%E6%80%A7"><span class="toc-number">1.56.</span> <span class="toc-text">56.缓存-缓存有关的设置以及属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#57-%E7%BC%93%E5%AD%98-%E7%BC%93%E5%AD%98%E5%8E%9F%E7%90%86%E5%9B%BE%E7%A4%BA"><span class="toc-number">1.57.</span> <span class="toc-text">57.缓存-缓存原理图示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#58-%E7%BC%93%E5%AD%98-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%93%E5%AD%98%E6%95%B4%E5%90%88%E5%8E%9F%E7%90%86-amp-ehcache%E9%80%82%E9%85%8D%E5%8C%85%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.58.</span> <span class="toc-text">58.缓存-第三方缓存整合原理&amp;ehcache适配包下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#59-%E7%BC%93%E5%AD%98-MyBatis%E6%95%B4%E5%90%88ehcache-amp-%E6%80%BB%E7%BB%93"><span class="toc-number">1.59.</span> <span class="toc-text">59.缓存-MyBatis整合ehcache&amp;总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#60-%E6%95%B4%E5%90%88Spring-%E6%95%B4%E5%90%88%E9%80%82%E9%85%8D%E5%8C%85%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.60.</span> <span class="toc-text">60.整合Spring-整合适配包下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#61-%E6%95%B4%E5%90%88Spring-%E6%89%80%E6%9C%89%E9%9C%80%E8%A6%81%E7%9A%84jar%E5%8C%85%E5%AF%BC%E5%85%A5"><span class="toc-number">1.61.</span> <span class="toc-text">61.整合Spring-所有需要的jar包导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#62-%E6%95%B4%E5%90%88Spring-%E5%BC%95%E5%85%A5MyBatis%E4%B9%8B%E5%89%8D%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.62.</span> <span class="toc-text">62.整合Spring-引入MyBatis之前的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#63-%E6%95%B4%E5%90%88Spring-SpringMVC%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-number">1.63.</span> <span class="toc-text">63.整合Spring-SpringMVC配置文件编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#64-%E6%95%B4%E5%90%88Spring-Spring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99"><span class="toc-number">1.64.</span> <span class="toc-text">64.整合Spring-Spring配置文件编写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#65-%E6%95%B4%E5%90%88Spring-Spring%E6%95%B4%E5%90%88MyBatis%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">1.65.</span> <span class="toc-text">65.整合Spring-Spring整合MyBatis关键配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#66-%E6%95%B4%E5%90%88Spring-%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95"><span class="toc-number">1.66.</span> <span class="toc-text">66.整合Spring-整合测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">1.67.</span> <span class="toc-text">MyBatis-代码生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">1.67.1.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.67.2.</span> <span class="toc-text">使用说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.67.3.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.67.4.</span> <span class="toc-text">生成器代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QBC%E9%A3%8E%E6%A0%BC%E7%9A%84%E5%B8%A6%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.67.5.</span> <span class="toc-text">QBC风格的带条件查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.68.</span> <span class="toc-text">MyBatis-工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.68.1.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="toc-number">1.69.</span> <span class="toc-text">MyBatis-插件开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91"><span class="toc-number">1.69.1.</span> <span class="toc-text">插件开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%8E%9F%E7%90%86"><span class="toc-number">1.69.2.</span> <span class="toc-text">插件原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Interceptor%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.69.3.</span> <span class="toc-text">Interceptor接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81"><span class="toc-number">1.69.4.</span> <span class="toc-text">常用代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-PageHelper%E6%8F%92%E4%BB%B6%E8%BF%9B%E8%A1%8C%E5%88%86%E9%A1%B5"><span class="toc-number">1.70.</span> <span class="toc-text">扩展-MyBatis实用场景-PageHelper插件进行分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">1.71.</span> <span class="toc-text">扩展-MyBatis实用场景-批量操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.72.</span> <span class="toc-text">扩展-MyBatis实用场景-存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95-MyBatis%E5%AE%9E%E7%94%A8%E5%9C%BA%E6%99%AF-typeHandler%E5%A4%84%E7%90%86%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.73.</span> <span class="toc-text">扩展-MyBatis实用场景-typeHandler处理枚举</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E8%BA%AB"><span class="toc-number">1.73.1.</span> <span class="toc-text">热身</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89TypeHandler"><span class="toc-number">1.73.2.</span> <span class="toc-text">自定义TypeHandler</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c43bf339.html" title="Sky-User-Center项目介绍"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/电脑壁纸70.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Sky-User-Center项目介绍"></a><div class="content"><a class="title" href="/posts/c43bf339.html" title="Sky-User-Center项目介绍">Sky-User-Center项目介绍</a><time datetime="2023-03-08T22:00:00.000Z" title="发表于 2023-03-08 22:00:00">2023-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8036cfa7.html" title="Sky-User-Center开发笔记"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/TIM%E5%9B%BE%E7%89%8720181208144407.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Sky-User-Center开发笔记"></a><div class="content"><a class="title" href="/posts/8036cfa7.html" title="Sky-User-Center开发笔记">Sky-User-Center开发笔记</a><time datetime="2023-03-08T22:00:00.000Z" title="发表于 2023-03-08 22:00:00">2023-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/41803b43.html" title="重置数据库"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://static-bed.twintea.top/wallpaper/wallhaven-l3xk6q.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="重置数据库"></a><div class="content"><a class="title" href="/posts/41803b43.html" title="重置数据库">重置数据库</a><time datetime="2023-03-08T22:00:00.000Z" title="发表于 2023-03-08 22:00:00">2023-03-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"></div><div class="copyright"><span><b>&copy;2023 - 2024</b></span><span><b>&nbsp;&nbsp;By 🐤twintea🐥</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.3.0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.7.0"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px" title="本站已在桂进行备案"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E6%A1%82ICP%E5%A4%87-2022001032%E5%8F%B7-red?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAQjSURBVHjaVNNZbFRlGIDh95w525zpdGa6TVtbykBbyiICxQY0AhYTJUCiiYqGqEEiJhKQmBg0ESPeeCGRENEYb4jhBr0gNQrRlCBiSgyLaSlSaKEs3Wemy+xnzuqFYdD/6rt6ku/N9wue55EcPwWArCgIgkx5ZRuYVxsnJ801Z05f3jY1MRnb/HxHV+uSph9RKq4mhkdwbZVgdQ2SHkPTwgj/h1QUWWi8/tfg/hM/XN/Y2zfaZnkSnuRDtLMsXhBOvrJtya/LlrcdMs1Qb1lVRQmSAEDAsU1kxpgamXp3y+azu1esreK9dyRqs9PIjkW6OsLx7lTV1ld/237s8HRV57MbnvO8CA+e9GCQFTk6Mza+4/0P+t9a9VSEI3uyTH/eR27aB2Ed31Q/Hx1sI6BHOPT13c5Frd0HW9p3HPUQEwAigJW9RDp+bstrOy981nVGLN/7RpHUV70YfXnEAtjxFPasxPDBQXatjzNTdOQXtg983H/51AFFy1KCIg2bNIdC+8270NwmUmelsXqSqHkDK5PDl8iCW0QcnEW+lqCjvcjQuMZ4YnQRTkotQUZu4GkjcfZNv19G011kXw4vayNYNvqCCvSVTciOgABgeuhBGwhgz5zbkI2ff7HUqJiNR2QktbbSYnBYYqbMT/ilKI4SIbT/GcRylbnvLmJ2X8N7tJ7rR8OE/BbliqEYea81WIotmOs02WFpc55Lf0f5/mSI3dsamOgxSX7ZjaALuBmB6M6FnB+S+POCwmOLk1QFFAqZyQWl1YrpiRZJLvDkygyC5NJ1XCax7xYNiTQVEYVIuUulayIcGeLkpw6WK7GuPY/fb2CkhleXIFFe8XPGaKBj9QxLW1Ik0bg8EuT2zRCJYZvZIYepe0EGbvi4bQUJVZhs2phADFYj+df0lBqJUnaekS4SUHXe3jrOnoE2PhSewHfRpfZGgcryIvfHdQruQlLo7Ns6QizqkJ31CIUlqwQJXuWUpDXj6qOsW32HT3YNImll9FwJsb4jyaLmWQ4fa6a+2sQw0ry8YZSiHcPxxXBtMfCv4XkUCrfliWs/fTE31rtTVfv9vsIorvQIniMhqXM4popVcJFVMHMpfMEaLPdxR1Tnna1b1vl6tGntpAjgCTNWONZyIFBR8Ydtr6EgrCI3VySfzZPLBDHyIq5gkpmzcOUmTGMF+bh7M9LYulfWzMmHBzk7Fpq9deWEYxjrtaCMXjWfstp6BCGNXZzBdYqYhogWqkMum4+oBVD0YnP63u/fFqbv1D+M7VSlBbmmK5uYaLYLYwslfwFVAyXQiOfcx3XyyGIM8DDn0lgWyGokHogu/0UJxpL/+f2e569s/CZQZ53OpzJr0+NXludUfb5jVdf7VUGXJUPIZast1S9PeII6jFDT5xMjFwO1S4c8zwTgnwEAxufYSzA67PMAAAAASUVORK5CYII=" alt=""></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.1/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js").then((()=>{pangu.autoSpacingPage()}))}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><div class="js-pjax"><script>(()=>{const t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-vercel.twintea.top/",region:"",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))},o=()=>{"object"!=typeof twikoo?getScript("https://lib.baomitu.com/twikoo/1.6.10/twikoo.all.min.js").then(t):setTimeout(t,0)};btf.loadComment(document.getElementById("twikoo-wrap"),o)})()</script></div><script defer src="/js/kslink.js"></script><script defer src="/js/runtime.js"></script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script data-pjax defer src="/js/emoji.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/fireworks.min.js"></script><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="49" mobile="false" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/canvas-nest.min.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","750ms"),arr[i].setAttribute("data-wow-delay","600ms"),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html>